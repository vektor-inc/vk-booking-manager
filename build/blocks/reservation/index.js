(()=>{"use strict";var e,a={19(e,a,n){const t=window.wp.blocks,r=window.wp.blockEditor,o=window.wp.i18n,i=window.wp.components,s=window.wp.element,l=window.wp.apiFetch;var m=n.n(l);const c=window.wp.date,d=window.ReactJSXRuntime,_=[(0,o.__)("Sun","vk-booking-manager"),(0,o.__)("Mon","vk-booking-manager"),(0,o.__)("Tue","vk-booking-manager"),(0,o.__)("Wed","vk-booking-manager"),(0,o.__)("Thu","vk-booking-manager"),(0,o.__)("Fri","vk-booking-manager"),(0,o.__)("Sat","vk-booking-manager")],u=e=>e.toString().padStart(2,"0"),v=e=>[e.getFullYear(),u(e.getMonth()+1),u(e.getDate())].join("-"),b=(e,a,n)=>{const t=new Date(e,a-1,1),r=n||"en";if("string"==typeof r&&r.startsWith("ja"))return new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"numeric"}).format(t);const o="string"==typeof r?r.replace("_","-"):"en-US";return new Intl.DateTimeFormat(o,{year:"numeric",month:"long"}).format(t)},k=v(new Date),g=({year:e,month:a,dayMetaMap:n={},selectedDate:t,onSelectDate:r,onMonthChange:i,isLoading:l,locale:m})=>{const c=e=>{if(!e||"normal"===e)return"";switch(e){case"holiday":return(0,o.__)("Closed days","vk-booking-manager");case"special_open":return(0,o.__)("Special Opening","vk-booking-manager");case"special_close":return(0,o.__)("Temporary closure","vk-booking-manager");case"off":return(0,o.__)("private","vk-booking-manager");default:return e}},u=(0,s.useMemo)(()=>((e,a)=>{const n=[],t=new Date(e,a-1,1).getDay();let r=new Date(e,a-1,1-t);for(let e=0;e<6;e+=1){const e=[];for(let n=0;n<7;n+=1){const t=new Date(r);e.push({label:t.getDate(),date:t,iso:v(t),inMonth:t.getMonth()===a-1,weekday:n}),r.setDate(r.getDate()+1)}n.push(e)}return n})(e,a),[e,a]);return(0,d.jsxs)("div",{className:"vkbm-calendar",children:[(0,d.jsxs)("header",{className:"vkbm-calendar__header",children:[(0,d.jsx)("button",{type:"button",className:"vkbm-calendar__nav",onClick:()=>i(-1),"aria-label":(0,o.__)("previous month","vk-booking-manager"),children:"‹"}),(0,d.jsxs)("div",{className:"vkbm-calendar__current",children:[b(e,a,m),l&&(0,d.jsx)("span",{className:"vkbm-calendar__spinner","aria-live":"polite",children:(0,o.__)("Loading...","vk-booking-manager")})]}),(0,d.jsx)("button",{type:"button",className:"vkbm-calendar__nav",onClick:()=>i(1),"aria-label":(0,o.__)("next month","vk-booking-manager"),children:"›"})]}),(0,d.jsx)("div",{className:"vkbm-calendar__weekdays",children:_.map(e=>(0,d.jsx)("span",{children:e},e))}),(0,d.jsx)("div",{className:"vkbm-calendar__grid",children:u.map((e,a)=>(0,d.jsx)("div",{className:"vkbm-calendar__week",children:e.map(e=>{const a=n[e.iso]||{},o=t===e.iso,i=!e.inMonth||Boolean(a.is_disabled)||e.iso<k;return(0,d.jsxs)("button",{type:"button",className:["vkbm-calendar__day",!e.inMonth&&"vkbm-calendar__day--muted",o&&"vkbm-calendar__day--selected",a.available_slots>0&&"vkbm-calendar__day--available"].filter(Boolean).join(" "),onClick:()=>r(e.iso),disabled:i,children:[(0,d.jsx)("span",{className:"vkbm-calendar__day-label",children:e.label}),c(a.shift_status)&&(0,d.jsx)("span",{className:"vkbm-calendar__status",children:c(a.shift_status)})]},e.iso)})},`week-${a}`))})]})},f=e=>e?e.slice(11,16):"",h=({slots:e,selectedDate:a,onSelectSlot:n,selectedSlotId:t,isLoading:r,error:i,selectedStaffLabel:s="",showStaffLabel:l=!0})=>i?(0,d.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--alert",children:(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-alert--compact",role:"alert",children:i})}):a?r?(0,d.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--placeholder",children:(0,o.__)("Loading empty slots...","vk-booking-manager")}):e?.length?(0,d.jsx)("div",{className:"vkbm-slot-list",children:e.map(e=>(0,d.jsxs)("button",{type:"button",className:["vkbm-slot-list__item",t===e.slot_id&&"is-selected"].filter(Boolean).join(" "),onClick:()=>n(e),children:[(0,d.jsxs)("div",{className:"vkbm-slot-list__time",children:[f(e.start_at)," -"," ",f(e.service_end_at||e.end_at)]}),l&&(0,d.jsx)("div",{className:"vkbm-slot-list__staff",children:e.staff_label||e.staff?.name||s||(0,o.__)("No preference","vk-booking-manager")})]},e.slot_id))}):(0,d.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--placeholder",children:(0,o.__)("There are no available reservation times for the selected criteria.","vk-booking-manager")}):(0,d.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--alert",children:(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-alert--compact",role:"status",children:(0,o.__)("When you select a date from the calendar, reservation candidates will be displayed.","vk-booking-manager")})}),p=({label:e,options:a,value:n,onChange:t,disabled:r,placeholder:o})=>(0,d.jsxs)("label",{className:"vkbm-plan-summary__field",children:[(0,d.jsx)("span",{className:"vkbm-plan-summary__label",children:e}),(0,d.jsxs)("select",{value:n||"",onChange:e=>t(e.target.value),disabled:r,children:[(0,d.jsx)("option",{value:"",children:o}),a.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),y=({label:e,value:a,placeholder:n})=>(0,d.jsxs)("div",{className:"vkbm-plan-summary__field",children:[(0,d.jsx)("span",{className:"vkbm-plan-summary__label",children:e}),(0,d.jsx)("span",{className:"vkbm-plan-summary__value",children:a||n})]}),x=({menuId:e,staffId:a,menus:n,staffOptions:t,onMenuChange:r,onStaffChange:i,allowStaffSelection:s,showStaffField:l=!0,pricingRows:m=[],menuPreviewLoading:c=!1,menuPreviewError:_="",menuPreviewHtml:u="",resourceLabelSingular:v=(0,o.__)("Staff","vk-booking-manager"),lockStaffSelection:b=!1})=>{const k=(()=>{const e=(0,o.__)("Please select a menu.","vk-booking-manager");return e.includes("%s")?(0,o.sprintf)(e,(0,o.__)("Menu","vk-booking-manager")):e})(),g=[...n].sort((e,a)=>{var n,t,r,o,i,s;const l=e?.vkbm_menu_group||null,m=a?.vkbm_menu_group||null,c=Number.isFinite(l?.order)?l.order:Number.MAX_SAFE_INTEGER,d=Number.isFinite(m?.order)?m.order:Number.MAX_SAFE_INTEGER;if(c!==d)return c-d;const _=Boolean(l);if(_!==Boolean(m))return _?-1:1;const u=String(null!==(n=l?.name)&&void 0!==n?n:""),v=String(null!==(t=m?.name)&&void 0!==t?t:""),b=u.localeCompare(v);if(0!==b)return b;const k=Number.isFinite(e?.menu_order)?e.menu_order:0,g=Number.isFinite(a?.menu_order)?a.menu_order:0;if(k!==g)return k-g;const f=String(null!==(r=null!==(o=e?.title?.rendered)&&void 0!==o?o:e?.title)&&void 0!==r?r:""),h=String(null!==(i=null!==(s=a?.title?.rendered)&&void 0!==s?s:a?.title)&&void 0!==i?i:"");return f.localeCompare(h)}).map(e=>{var a;return{id:e.id,name:null!==(a=e.title?.rendered)&&void 0!==a?a:e.title}}),f=t.map(e=>{var a,n;return{id:e.id,name:null!==(a=null!==(n=e.title?.rendered)&&void 0!==n?n:e.name)&&void 0!==a?a:e.title}});return(0,d.jsxs)("div",{className:"vkbm-plan-summary",children:[(0,d.jsxs)("div",{className:"vkbm-plan-summary__selectors",children:[(0,d.jsx)(p,{label:(0,o.__)("Menu","vk-booking-manager"),options:g,value:e,onChange:e=>r(Number(e)||0),placeholder:(0,o.__)("Select menu","vk-booking-manager"),disabled:!g.length}),l&&(s?(0,d.jsx)(p,{label:v,options:f,value:a,onChange:e=>i(Number(e)||0),placeholder:(0,o.__)("No preference","vk-booking-manager"),disabled:!f.length||b}):(0,d.jsx)(y,{label:v,value:f.find(e=>e.id===a)?.name,placeholder:(0,o.__)("No preference","vk-booking-manager")}))]}),e?(0,d.jsxs)("div",{className:"vkbm-plan-summary__menu-preview vkbm-reservation__menu-preview",children:[c&&(0,d.jsx)("p",{className:"vkbm-reservation__menu-preview-notice",children:(0,o.__)("Loading menu information...","vk-booking-manager")}),!c&&_&&(0,d.jsx)("div",{className:"vkbm-reservation__error",children:_}),!c&&!_&&u&&(0,d.jsx)("div",{className:"vkbm-reservation__menu-preview-card",dangerouslySetInnerHTML:{__html:u}})]}):null,e?m?.length>0?(0,d.jsx)("div",{className:"vkbm-plan-summary__pricing",children:m.map(e=>{var a;return(0,d.jsxs)("div",{className:"vkbm-plan-summary__pricing-row",children:[(0,d.jsx)("span",{className:"vkbm-plan-summary__pricing-label",children:e.label}),(0,d.jsxs)("strong",{className:["vkbm-plan-summary__pricing-value",e.highlight&&"vkbm-plan-summary__pricing-value--accent"].filter(Boolean).join(" "),children:[(0,d.jsx)("span",{className:"vkbm-plan-summary__pricing-amount",children:null!==(a=e.value)&&void 0!==a?a:"—"}),e.taxLabel?(0,d.jsx)("span",{className:"vkbm-plan-summary__pricing-tax",children:e.taxLabel}):null]})]},e.key)})}):null:(0,d.jsx)("div",{className:"vkbm-plan-summary__pricing vkbm-plan-summary__pricing--alert",children:(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-alert--compact",role:"status",children:k})})]})},j=e=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e)&&e>=0)return e;if("string"==typeof e){const a=e.trim();if(""===a)return null;const n=Number(a);if(Number.isFinite(n)&&n>=0)return n}return null},N=(e,a=null)=>{const n=j(e);if(null===n)return"";let t;try{t=new Intl.NumberFormat(w())}catch(e){t=new Intl.NumberFormat("ja-JP")}const r=t.format(n),i="string"==typeof a?a.trim():"",s=""!==i?i:(()=>{if("undefined"==typeof window)return"$";const e=window?.vkbmCurrentUserBootstrap?.locale;return"string"==typeof e&&""!==e.trim()&&e.toLowerCase().startsWith("ja")?"¥":"$"})();return""!==s?`${s}${r}`:(0,o.sprintf)(/* translators: %s: price amount */ /* translators: %s: price amount */
(0,o.__)("$%s","vk-booking-manager"),r)},w=()=>{if("undefined"==typeof window)return"ja-JP";const e=window?.vkbmCurrentUserBootstrap?.locale;return"string"==typeof e&&""!==e.trim()?e.trim():"ja-JP"},S=(e="")=>"string"!=typeof e?"":e.toLowerCase().replace(/[^a-z0-9]/g,""),L=({booking:e,resourceLabel:a,emptyValue:n="",currencySymbol:t=null})=>{const r="string"==typeof a&&""!==a.trim()?a:(0,o.__)("Staff","vk-booking-manager"),i="string"==typeof e?.menu_name&&""!==e.menu_name.trim()?e.menu_name:n,s="string"==typeof e?.resource_name&&""!==e.resource_name.trim()?e.resource_name:n;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,d.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:(0,o.__)("Menu","vk-booking-manager")}),(0,d.jsx)("dd",{className:"vkbm-confirm__summary-item-value",children:i})]}),e?.is_staff_preferred&&(0,d.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,d.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:r}),(0,d.jsx)("dd",{className:"vkbm-confirm__summary-item-value",children:s})]}),(0,d.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,d.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:(0,o.__)("Total basic fee","vk-booking-manager")}),(0,d.jsx)("dd",{className:"vkbm-confirm__summary-item-value vkbm-confirm__summary-item-value--price",children:N(e?.total_price||0,t)})]}),"string"==typeof e?.other_conditions&&""!==e.other_conditions.trim()&&(0,d.jsxs)("dl",{className:"vkbm-confirm__summary-item vkbm-confirm__summary-item--other-conditions",children:[(0,d.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:(0,o.__)("Other conditions","vk-booking-manager")}),(0,d.jsx)("dd",{className:"vkbm-confirm__summary-value--multiline",children:e.other_conditions})]})]})},C=(e,a,n)=>{if(!e)return{date:"",time:""};const t=P(e,n,{includeTime:!1,includeDate:!0,includeWeekday:!0}),r=P(e,n,{includeTime:!0,includeDate:!1}),o=a?P(a,n,{includeTime:!0,includeDate:!1}):"";return{date:t,time:o?`${r} - ${o}`.trim():r}},P=(e,a,{includeTime:n=!0,includeDate:t=!0,includeWeekday:r=!1}={})=>{if(!e)return"";try{const o=new Date(e);if(Number.isNaN(o.getTime()))return e;let i;try{i="function"==typeof c.__experimentalGetSettings?(0,c.__experimentalGetSettings)():void 0}catch(e){i=void 0}const s=i?.formats?.date||"Y/m/d",l=i?.formats?.time||"H:i",m=a||i?.timezone?.string,d=t?(0,c.dateI18n)(s,o,m):"",_=n?(0,c.dateI18n)(l,o,m):"",u=r?(0,c.dateI18n)("D",o,m):"";return t&&n?r&&u?`${d}(${u}) ${_}`.trim():`${d} ${_}`.trim():t?r&&u?`${d}(${u})`.trim():d:_}catch(a){return e}},E=({label:e,value:a,valueClassName:n})=>(0,d.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,d.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:e}),(0,d.jsx)("dd",{className:["vkbm-confirm__summary-item-value",n].filter(Boolean).join(" "),children:a||"—"})]}),M=({redirectUrl:e,termsLabel:a,policyText:n,successMessage:t,reservationPageUrl:r=""})=>{const i=(0,s.useMemo)(()=>"undefined"==typeof window?null:window.vkbmCurrentUserBootstrap||null,[]),l=(0,s.useMemo)(()=>(e=>{if("undefined"==typeof window)return"";const a=new URLSearchParams(window.location.search).get(e)||"";return S(a)})("draft"),[]),[c,_]=(0,s.useState)(null),[u,v]=(0,s.useState)(null),[b,k]=(0,s.useState)(null),[g,f]=(0,s.useState)(!0),[h,p]=(0,s.useState)(""),[y,x]=(0,s.useState)(""),[w,P]=(0,s.useState)(!1),[M,I]=(0,s.useState)(!1),[U,B]=(0,s.useState)(!1),[R,T]=(0,s.useState)(""),[D,$]=(0,s.useState)(!1),[F,A]=(0,s.useState)(""),[O,z]=(0,s.useState)(""),[H,Y]=(0,s.useState)(""),[G,J]=(0,s.useState)(""),[V,W]=(0,s.useState)(Boolean(i?.canManageReservations)),[X,q]=(0,s.useState)(i?.logoutUrl||""),[K,Q]=(0,s.useState)(i?.shiftDashboardUrl||""),[Z,ee]=(0,s.useState)(""),[ae,ne]=(0,s.useState)(""),[te,re]=(0,s.useState)(""),[oe,ie]=(0,s.useState)(""),[se,le]=(0,s.useState)(""),[me,ce]=(0,s.useState)(!1),[de,_e]=(0,s.useState)(!1),[ue,ve]=(0,s.useState)(!0),[be,ke]=(0,s.useState)((0,o.__)("Staff","vk-booking-manager")),[ge,fe]=(0,s.useState)(r||""),[he,pe]=(0,s.useState)(""),[ye,xe]=(0,s.useState)(""),je="undefined"!=typeof document&&document.body.classList.contains("logged-in");(0,s.useEffect)(()=>{console.log("[DEBUG] BookingConfirmApp mounted"),console.log("[DEBUG] isLoggedIn:",je),console.log("[DEBUG] userBootstrap:",i),console.log("[DEBUG] document body class:","undefined"!=typeof document?document.body.className:"no document")},[je,i]);const Ne=(0,s.useMemo)(()=>(()=>{if("undefined"==typeof window)return{};try{const e=new URLSearchParams(window.location.search);return{auth:e.get("vkbm_auth")||"",draft:S(e.get("draft")||"")}}catch(e){return{}}})(),[]),[we,Se]=(0,s.useState)(Ne.auth||""),[Le,Ce]=(0,s.useState)(""),[Pe,Ee]=(0,s.useState)(!1),[Me,Ie]=(0,s.useState)(""),[Ue,Be]=(0,s.useState)(!1),[Re,Te]=(0,s.useState)(""),[De,$e]=(0,s.useState)([]),[Fe,Ae]=(0,s.useState)(0),Oe=c?.meta?.timezone||"",ze=(0,s.useMemo)(()=>{var e,a,n,t,r,o,i;const s=Boolean(c?.menu_price_tax_included),l=""!==he.trim()?he:"",m=e=>s&&l?`${e}${l}`:e,d=null!==(e=null!==(a=j(c?.menu_price))&&void 0!==a?a:j(c?.menu_price_base))&&void 0!==e?e:j(null!==(n=null!==(t=null!==(r=u?.meta?.vkbm_base_price)&&void 0!==r?r:u?.meta?._vkbm_base_price)&&void 0!==t?t:u?._vkbm_base_price)&&void 0!==n?n:u?.price),_=""!==ye.trim()?ye:null,v="string"==typeof c?.menu_price_formatted&&""!==c.menu_price_formatted.trim()?c.menu_price_formatted:null!==d?m(N(d,_)):"",b=ue&&null!==(o=j(c?.nomination_fee))&&void 0!==o?o:0,k="string"==typeof c?.nomination_fee_formatted&&""!==c.nomination_fee_formatted.trim()?c.nomination_fee_formatted:m(N(b,_)),g=null!==(i=j(c?.total_price))&&void 0!==i?i:null!==d?d+b:null;return{baseLabel:v,nominationLabel:k,totalLabel:"string"==typeof c?.total_price_formatted&&""!==c.total_price_formatted.trim()?c.total_price_formatted:null!==g?m(N(g,_)):""}},[c,u,ue,he,ye]);(0,s.useEffect)(()=>{if(!l)return p((0,o.__)("The URL does not include a temporary reservation data parameter. Please try again from the reservation page.","vk-booking-manager")),void f(!1);f(!0),p(""),m()({path:`/vkbm/v1/drafts/${l}`}).then(e=>{_(e),x(e?.memo||"");const a=Boolean(e?.agree_terms);P(void 0!==e?.agree_cancellation_policy?Boolean(e?.agree_cancellation_policy):a),I(void 0!==e?.agree_terms_of_service?Boolean(e?.agree_terms_of_service):a)}).catch(e=>{p(e?.message||(0,o.__)("Couldn't load temporary reservation data. Please try again from the reservation page.","vk-booking-manager"))}).finally(()=>f(!1))},[l]),(0,s.useEffect)(()=>{let e=!0;return m()({path:"/vkbm/v1/provider-settings"}).then(a=>{e&&("string"==typeof a?.resource_label_singular&&""!==a.resource_label_singular.trim()?ke(a.resource_label_singular):ke((0,o.__)("Staff","vk-booking-manager")),ee("string"==typeof a?.cancellation_policy?a.cancellation_policy:""),ne("string"==typeof a?.terms_of_service?a.terms_of_service:""),re("string"==typeof a?.payment_method?a.payment_method:""),ie("string"==typeof a?.provider_name?a.provider_name:""),le("string"==typeof a?.provider_logo_url?a.provider_logo_url:""),ce(Boolean(a?.reservation_show_provider_logo)),_e(Boolean(a?.reservation_show_provider_name)),ve(!1!==a?.staff_enabled),pe("string"==typeof a?.tax_label_text?a.tax_label_text:""),xe("string"==typeof a?.currency_symbol?a.currency_symbol:""),r||"string"!=typeof a?.reservation_page_url||fe(a.reservation_page_url))}).catch(()=>{}),()=>{e=!1}},[r]),(0,s.useEffect)(()=>{c?.menu_id?m()({path:`/wp/v2/vkbm_service_menu/${c.menu_id}?_fields=id,title,meta`}).then(e=>v(e)).catch(()=>v(null)):v(null)},[c?.menu_id]),(0,s.useEffect)(()=>{c?.resource_id&&ue?m()({path:`/wp/v2/vkbm_resource/${c.resource_id}?_fields=id,title,meta`}).then(e=>k(e)).catch(()=>k(null)):k(null)},[c?.resource_id,ue]),(0,s.useEffect)(()=>{let e=!0;if(!je)return W(!1),q(""),Q(""),()=>{e=!1};if(i&&"object"==typeof i&&"string"==typeof i.logoutUrl&&"string"==typeof i.shiftDashboardUrl)return W(Boolean(i.canManageReservations)),q(i.logoutUrl||""),Q(i.shiftDashboardUrl||""),()=>{e=!1};const a=((e,a={})=>{const n=new URLSearchParams;return Object.entries(a).forEach(([e,a])=>{null!=a&&""!==a&&n.append(e,a)}),`${e}?${n.toString()}`})("/vkbm/v1/current-user",{redirect:He()||void 0});return m()({path:a}).then(a=>{e&&(W(Boolean(a?.can_manage_reservations)),q(a?.logout_url||""),Q(a?.shift_dashboard_url||""))}).catch(()=>{e&&(W(!1),q(""),Q(""))}),()=>{e=!1}},[je]),(0,s.useEffect)(()=>{V&&("profile"!==we&&"bookings"!==we||Se(""))},[V,we]),(0,s.useEffect)(()=>{V||(z(""),Y(""),J(""))},[V]);const He=()=>"undefined"==typeof window?"":window.location.href,Ye=e=>{if("undefined"==typeof window)return"";const a=new URL(window.location.href);return e?a.searchParams.set("vkbm_auth",e):a.searchParams.delete("vkbm_auth"),a.toString()},Ge=(0,s.useCallback)(e=>{if("undefined"==typeof window)return"";const a=ge||r||"",n=a?new URL(a,window.location.origin):new URL(window.location.href);return e?n.searchParams.set("vkbm_auth",e):n.searchParams.delete("vkbm_auth"),n.searchParams.delete("draft"),n.toString()},[ge,r]),Je=(0,s.useCallback)(e=>{const a=e===we?"":e;if(Se(a),"undefined"==typeof window)return;const n=new URL(window.location.href);a?n.searchParams.set("vkbm_auth",a):n.searchParams.delete("vkbm_auth"),window.history.replaceState(null,"",n.toString())},[we]),Ve=(0,s.useCallback)(()=>{const e=Ge("bookings");e?window.location.href=e:Je("bookings")},[Ge,Je]),We=(0,s.useCallback)(()=>{const e=Ge("profile");e?window.location.href=e:Je("profile")},[Ge,Je]),Xe=(0,s.useCallback)(()=>{const e=Ge("");e?window.location.href=e:Je("")},[Ge,Je]);(0,s.useEffect)(()=>{if(!we)return void Ce("");if("bookings"===we)return void Ce("");const e="profile"===we||"bookings"===we;if(e&&!je)return void Ce("");if(!e&&je)return void Ce("");Ee(!0),Ie(""),Ce("");const a=new URLSearchParams;a.set("type",we);const n=He();n&&a.set("redirect",n),"login"===we?a.set("register_url",Ye("register")):"register"===we&&a.set("login_url",Ye("login")),m()({path:`/vkbm/v1/auth-form?${a.toString()}`,cache:"no-store",credentials:"same-origin"}).then(e=>{const a=e?.html||"",n=e?.message||"";Ce(a),!a&&"register"===we&&n&&Ie(n)}).catch(e=>{Ie(e?.message||(0,o.__)("The form could not be displayed.","vk-booking-manager"))}).finally(()=>Ee(!1))},[we,je]);const qe=(0,s.useCallback)(e=>{const a=Number(e)||0;a&&!Fe&&("undefined"==typeof window||window.confirm((0,o.__)("Do you want to cancel this reservation?","vk-booking-manager")))&&(Ae(a),Te(""),m()({path:`/vkbm/v1/my-bookings/${a}/cancel`,method:"POST"}).then(()=>{$e(e=>Array.isArray(e)?e.filter(e=>Number(e?.id)!==a):[])}).catch(e=>{Te(e?.message||(0,o.__)("I was unable to cancel my reservation.","vk-booking-manager"))}).finally(()=>{Ae(0)}))},[Fe]);if((0,s.useEffect)(()=>{je&&we&&"profile"!==we&&"bookings"!==we&&Se(""),je||"profile"!==we&&"bookings"!==we||Se("")},[je,we]),(0,s.useEffect)(()=>{let e=!0;return je&&"bookings"===we?(Be(!0),Te(""),m()({path:"/vkbm/v1/my-bookings"}).then(a=>{e&&$e(Array.isArray(a)?a:[])}).catch(()=>{e&&($e([]),Te((0,o.__)("The reservation list could not be loaded.","vk-booking-manager")))}).finally(()=>{e&&Be(!1)}),()=>{e=!1}):()=>{e=!1}},[we,je]),(0,s.useEffect)(()=>{if(!D||e)return;if("undefined"==typeof window)return;const a=new URL(window.location.href);a.searchParams.has("draft")&&(a.searchParams.delete("draft"),window.history.replaceState(null,"",a.toString()))},[D,e]),g)return(0,d.jsx)("div",{className:"vkbm-confirm",children:(0,d.jsx)("div",{className:"vkbm-alert vkbm-alert__info",role:"status",children:(0,o.__)("Loading temporary reservation data...","vk-booking-manager")})});if(h)return(0,d.jsx)("div",{className:"vkbm-confirm",children:(0,d.jsx)("div",{className:"vkbm-alert vkbm-alert__danger",role:"alert",children:h})});if(!c)return null;const Ke="pending"===F?(0,o.__)("Your tentative reservation has been completed.","vk-booking-manager"):t,Qe=c.menu_label||u?.title?.rendered||u?.title||u?.name||String(c.menu_id),Ze=c.staff_label||c.slot?.staff_label||c.slot?.staff?.name||b?.title?.rendered||b?.title||b?.name||(0,o.__)("No preference","vk-booking-manager"),ea=X||((e="")=>{if("undefined"==typeof window)return"/wp-login.php?action=logout";const a="string"==typeof e&&""!==e.trim()?e:window.location.href;return`/wp-login.php?action=logout&redirect_to=${encodeURIComponent(a)}`})(ge||r),aa=D&&!e,na="string"==typeof Z&&""!==Z.trim(),ta="string"==typeof ae&&""!==ae.trim(),ra="string"==typeof te&&""!==te.trim()?te:"",oa=je&&!U&&(V||!na||w)&&(V||!ta||M),ia=C(c?.slot?.start_at||"",c?.slot?.service_end_at||c?.slot?.end_at||"",Oe),sa=me&&"string"==typeof se&&""!==se.trim(),la=de&&"string"==typeof oe&&""!==oe.trim(),ma=sa||la,ca="string"==typeof ge?ge.trim():"",da=la?oe:(0,o.__)("Logo image","vk-booking-manager");return(0,d.jsxs)("div",{className:"vkbm-confirm",children:[ma?(0,d.jsxs)("div",{className:"vkbm-reservation-layout__header",children:[ca?(0,d.jsxs)("a",{className:"vkbm-reservation-layout__brand vkbm-reservation-layout__brand-link",href:ca,children:[sa&&(0,d.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:se,alt:da,loading:"lazy"}),la&&(0,d.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:oe})]}):(0,d.jsxs)("div",{className:"vkbm-reservation-layout__brand",children:[sa&&(0,d.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:se,alt:da,loading:"lazy"}),la&&(0,d.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:oe})]}),je&&V&&(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:K||"",children:(0,o.__)("Shift/reservation table","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,o.__)("Log out","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!V&&aa&&(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,d.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:Xe,children:(0,o.__)("Return","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!V&&!aa&&(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,d.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","bookings"===we&&"is-active"].filter(Boolean).join(" "),onClick:Ve,"aria-pressed":"bookings"===we,children:(0,o.__)("Confirm reservation","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","profile"===we&&"is-active"].filter(Boolean).join(" "),onClick:We,"aria-pressed":"profile"===we,children:(0,o.__)("Edit user information","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,o.__)("Log out","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]})]}):(0,d.jsxs)(d.Fragment,{children:[je&&V&&(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:K||"",children:(0,o.__)("Shift/reservation table","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,o.__)("Log out","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!V&&aa&&(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,d.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:Xe,children:(0,o.__)("Return","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!V&&!aa&&(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,d.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","bookings"===we&&"is-active"].filter(Boolean).join(" "),onClick:Ve,"aria-pressed":"bookings"===we,children:(0,o.__)("Confirm reservation","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","profile"===we&&"is-active"].filter(Boolean).join(" "),onClick:We,"aria-pressed":"profile"===we,children:(0,o.__)("Edit user information","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,o.__)("Log out","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]})]}),je&&"profile"===we&&(0,d.jsxs)("div",{className:"vkbm-confirm__auth-panel",children:[Pe&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,o.__)("Loading form...","vk-booking-manager")}),Me&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-confirm__auth-error",role:"alert",children:Me}),Le&&(0,d.jsx)("div",{className:"vkbm-confirm__auth-form",dangerouslySetInnerHTML:{__html:Le}})]}),je&&"bookings"===we&&(0,d.jsxs)("div",{className:"vkbm-confirm__auth-panel",children:[Ue&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,o.__)("Loading...","vk-booking-manager")}),Re&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-confirm__auth-error",role:"alert",children:Re}),!Ue&&!Re&&0===De.length&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,o.__)("There are no reservations to display.","vk-booking-manager")}),De.length>0&&(0,d.jsx)("div",{className:"vkbm-confirm",children:De.map(e=>{const a=C(e?.start_at||"",e?.end_at||"",Oe),n="cancelled"===String(e?.status||"").trim().toLowerCase();return(0,d.jsxs)("div",{className:["vkbm-confirm__summary",n&&"vkbm-confirm__summary--cancelled"].filter(Boolean).join(" "),children:[(a.date||a.time)&&(0,d.jsxs)("div",{className:"vkbm-confirm__summary-title",children:[(0,d.jsxs)("div",{className:"vkbm-confirm__datetime","aria-label":(0,o.__)("Reservation date and time","vk-booking-manager"),children:[n&&(0,d.jsx)("span",{className:"vkbm-confirm__status vkbm-confirm__status--cancelled",children:(0,o.__)("Cancelled","vk-booking-manager")}),a.date&&(0,d.jsx)("span",{className:"vkbm-confirm__date",children:a.date}),a.time&&(0,d.jsxs)("span",{className:"vkbm-confirm__time",children:[a.date?" ":"",a.time]})]}),e?.can_cancel&&(0,d.jsx)("button",{type:"button",className:"vkbm-button vkbm-button__sm vkbm-button__secondary vkbm-confirm__cancel-button",onClick:()=>qe(e?.id),disabled:Fe===Number(e?.id),children:Fe===Number(e?.id)?(0,o.__)("Processing...","vk-booking-manager"):(0,o.__)("Cancelled","vk-booking-manager")})]}),(0,d.jsx)(L,{booking:e,resourceLabel:be,emptyValue:"—",currencySymbol:""!==ye.trim()?ye:null})]},e?.id||a.date)})})]}),"bookings"!==we&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"vkbm-confirm__summary",children:[(ia.date||ia.time)&&(0,d.jsx)("div",{className:"vkbm-confirm__summary-title",children:(0,d.jsxs)("div",{className:"vkbm-confirm__datetime","aria-label":(0,o.__)("Reservation date and time","vk-booking-manager"),children:[ia.date&&(0,d.jsx)("span",{className:"vkbm-confirm__date",children:ia.date}),ia.time&&(0,d.jsxs)("span",{className:"vkbm-confirm__time",children:[ia.date?" ":"",ia.time]})]})}),(0,d.jsx)(E,{label:(0,o.__)("Menu","vk-booking-manager"),value:Qe}),ue&&(0,d.jsx)(E,{label:be,value:Ze}),(0,d.jsx)(E,{label:(0,o.__)("Service basic fee","vk-booking-manager"),value:ze.baseLabel}),ue&&(0,d.jsx)(E,{label:(0,o.__)("Nomination fee","vk-booking-manager"),value:ze.nominationLabel||N(0,""!==ye.trim()?ye:null)}),(0,d.jsx)(E,{label:(0,o.__)("Total basic fee","vk-booking-manager"),value:ze.totalLabel||ze.baseLabel,valueClassName:"vkbm-confirm__summary-item-value--price"})]}),!V&&!Z&&!ae&&n&&(0,d.jsx)("p",{className:"vkbm-confirm__policy",children:n}),!je&&(0,d.jsxs)("div",{className:"vkbm-confirm__auth",children:[(0,d.jsx)("p",{className:"vkbm-confirm__auth-label",children:(0,o.__)("You must log in to confirm your reservation.","vk-booking-manager")}),(0,d.jsxs)("div",{className:"vkbm-buttons vkbm-buttons__center",children:[(0,d.jsx)("button",{type:"button",className:["vkbm-button","vkbm-button__sm","vkbm-button__primary","login"===we&&"is-active"].filter(Boolean).join(" "),onClick:()=>Je("login"),children:(0,o.__)("Log in","vk-booking-manager")}),(0,d.jsx)("button",{type:"button",className:["vkbm-button","vkbm-button__sm","vkbm-button-outline","vkbm-button-outline__primary","register"===we&&"is-active"].filter(Boolean).join(" "),onClick:()=>Je("register"),children:(0,o.__)("Sign up","vk-booking-manager")})]}),we&&(0,d.jsxs)("div",{className:"vkbm-confirm__auth-panel",children:[Pe&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,o.__)("Loading form...","vk-booking-manager")}),Me&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-confirm__auth-error",role:"alert",children:Me}),Le&&(0,d.jsx)("div",{className:"vkbm-confirm__auth-form",dangerouslySetInnerHTML:{__html:Le}})]})]}),(0,d.jsxs)("div",{className:"vkbm-confirm__form",children:[(0,d.jsx)("label",{htmlFor:"vkbm-confirm-memo",children:(0,o.__)("Requests/Notes","vk-booking-manager")}),(()=>{const e=(0,d.jsx)("textarea",{id:"vkbm-confirm-memo",value:y,onChange:e=>x(e.target.value),placeholder:(0,o.__)("Please enter any contact information","vk-booking-manager")});return aa?(0,d.jsx)("textarea",{id:"vkbm-confirm-memo",value:y,readOnly:!0,placeholder:(0,o.__)("No entry","vk-booking-manager")}):e})()]}),V&&(0,d.jsxs)("div",{className:"vkbm-confirm__admin-fields",children:[(0,d.jsxs)("div",{className:"vkbm-confirm__admin-field",children:[(0,d.jsx)("label",{htmlFor:"vkbm-confirm-customer-name",children:(0,o.__)("Reserved name","vk-booking-manager")}),(0,d.jsx)("input",{type:"text",id:"vkbm-confirm-customer-name",value:O,onChange:e=>z(e.target.value),placeholder:(0,o.__)("Please enter customer name.","vk-booking-manager")})]}),(0,d.jsxs)("div",{className:"vkbm-confirm__admin-field",children:[(0,d.jsx)("label",{htmlFor:"vkbm-confirm-customer-phone",children:(0,o.__)("Telephone number","vk-booking-manager")}),(0,d.jsx)("input",{type:"tel",id:"vkbm-confirm-customer-phone",value:H,onChange:e=>Y(e.target.value),placeholder:(0,o.__)("Please enter your contact phone number.","vk-booking-manager")})]}),(0,d.jsxs)("div",{className:"vkbm-confirm__admin-field",children:[(0,d.jsx)("label",{htmlFor:"vkbm-confirm-provider-note",children:(0,o.__)("Management memo","vk-booking-manager")}),(0,d.jsx)("textarea",{id:"vkbm-confirm-provider-note",value:G,onChange:e=>J(e.target.value),placeholder:(0,o.__)("Please enter any internal notes.","vk-booking-manager")})]})]}),(()=>{if(aa||V)return null;const e="string"==typeof Z&&""!==Z.trim()?Z:"",t="string"==typeof ae&&""!==ae.trim()?ae:"",r=Boolean(e||t||ra);return(0,d.jsxs)(d.Fragment,{children:[r&&(0,d.jsxs)("div",{className:"vkbm-agreements",children:[e&&(0,d.jsxs)("div",{className:"vkbm-agreement",children:[(0,d.jsx)("h3",{className:"vkbm-agreement__title",children:(0,o.__)("Cancellation policy","vk-booking-manager")}),(0,d.jsx)("div",{className:"vkbm-agreement__body vkbm-agreement__body--full",children:e}),(0,d.jsxs)("div",{className:"vkbm-agreement__check",children:[(0,d.jsx)("input",{type:"checkbox",checked:w,onChange:e=>P(e.target.checked),id:"vkbm-confirm-cancellation-policy"}),(0,d.jsx)("label",{htmlFor:"vkbm-confirm-cancellation-policy",children:(0,o.__)("I agree to the cancellation policy","vk-booking-manager")})]})]}),t&&(0,d.jsxs)("div",{className:"vkbm-agreement",children:[(0,d.jsx)("h3",{className:"vkbm-agreement__title",children:(0,o.__)("System Terms of Use","vk-booking-manager")}),(0,d.jsx)("div",{className:"vkbm-agreement__body vkbm-agreement__body--scroll",children:t}),(0,d.jsxs)("div",{className:"vkbm-agreement__check",children:[(0,d.jsx)("input",{type:"checkbox",checked:M,onChange:e=>I(e.target.checked),id:"vkbm-confirm-terms"}),(0,d.jsx)("label",{htmlFor:"vkbm-confirm-terms",children:a})]})]}),ra&&(0,d.jsxs)("div",{className:"vkbm-agreement",children:[(0,d.jsx)("h3",{className:"vkbm-agreement__title",children:(0,o.__)("Payment method","vk-booking-manager")}),(0,d.jsx)("div",{className:"vkbm-agreement__body",children:ra})]})]}),!t&&n&&(0,d.jsx)("p",{className:"vkbm-confirm__policy",children:n})]})})(),(0,d.jsxs)("div",{className:"vkbm-confirm__actions",children:[!D&&(0,d.jsx)("button",{type:"button",className:"vkbm-confirm__button vkbm-button vkbm-button__md vkbm-button__primary",onClick:()=>{if(!l)return;const a="string"==typeof Z&&""!==Z.trim()?Z:"",n="string"==typeof ae&&""!==ae.trim()?ae:"",t=!V;if(t&&a&&!w)return void T((0,o.__)("You must agree to the cancellation policy.","vk-booking-manager"));if(t&&n&&!M)return void T((0,o.__)("You must agree to the terms of use.","vk-booking-manager"));const r=!t||(!a||w)&&(!n||M);B(!0),T("");const i={token:l,memo:y,agree_terms:r,agree_cancellation_policy:!t||w,agree_terms_of_service:!t||M};V&&(i.customer_name=O,i.customer_phone=H,i.internal_note=G),m()({path:"/vkbm/v1/bookings",method:"POST",data:i,parse:!1}).then(async a=>{const n=await a.text();let t;try{t=(e=>{const a=new Error((0,o.__)("The response is not a valid JSON response.","vk-booking-manager"));if("string"!=typeof e)throw a;const n=e.trim();if(!n)throw a;try{return JSON.parse(n)}catch(e){let t=n.indexOf("{"),r=n.lastIndexOf("}");if((-1===t||-1===r||r<t)&&(t=n.indexOf("["),r=n.lastIndexOf("]")),-1===t||-1===r||r<t)throw a;try{return JSON.parse(n.slice(t,r+1))}catch(e){throw a}}})(n)}catch(e){t=null}if(!a.ok){const e=(0,o.__)("A reservation for the same date and time already exists. Please change the date and time.","vk-booking-manager"),r="string"==typeof n&&(n.includes("booking_time_conflict")||n.includes("A reservation for the same date and time already exists.")),i=(409===a?.status||"booking_time_conflict"===t?.code||r?e:t?.message)||(t?.code?`${t.code} (HTTP ${a.status})`:`HTTP ${a.status}`)||(0,o.__)("Confirmation of reservation failed. Please try again later.","vk-booking-manager");throw new Error(i)}if(A(t?.status||""),$(!0),e){const a=new URL(e,"undefined"!=typeof window?window.location.origin:void 0);t?.booking_id&&a.searchParams.set("booking_id",String(t.booking_id)),window.location.href=a.toString()}}).catch(e=>{const a=(0,o.__)("A reservation for the same date and time already exists. Please change the date and time.","vk-booking-manager"),n="string"==typeof e?.message?e.message:"",t=e?.data?.status||e?.status,r="booking_time_conflict"===e?.code||409===t||n.includes("A reservation for the same date and time already exists.");T((r?a:n)||(0,o.__)("Confirmation of reservation failed. Please try again later.","vk-booking-manager"))}).finally(()=>B(!1))},disabled:!oa,children:U?(0,o.__)("Processing...","vk-booking-manager"):(0,o.__)("Reserve with this content","vk-booking-manager")}),aa&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__success text-center",role:"status",children:Ke}),R&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger",role:"alert",children:R})]})]})]})},I=(e,a)=>{const n=new URLSearchParams;return Object.entries(a).forEach(([e,a])=>{null!=a&&""!==a&&n.append(e,a)}),`${e}?${n.toString()}`},U="vkbm_draft_token",B=()=>{if("undefined"==typeof document)return"";const e=document.cookie.match(new RegExp(`(?:^|; )${U}=([^;]*)`));return S(e?decodeURIComponent(e[1]):"")},R=(e,a)=>{(0,s.useEffect)(()=>{if(!e)return a([]),()=>{};let n=!0;return m()({path:e}).then(e=>{n&&a(e||[])}).catch(()=>{n&&a([])}),()=>{n=!1}},[e,a])},T=()=>"undefined"==typeof window?"":window.location.href,D=(e="")=>{if("undefined"==typeof window)return"/wp-login.php?action=logout";const a="string"==typeof e&&""!==e.trim()?e:window.location.href;return`/wp-login.php?action=logout&redirect_to=${encodeURIComponent(a)}`},$=e=>{if("undefined"==typeof window)return"";const a=new URL(window.location.href);return e?a.searchParams.set("vkbm_auth",e):a.searchParams.delete("vkbm_auth"),a.toString()},F=({defaultMenuId:e=0,defaultStaffId:a=0,allowStaffSelection:n=!0,isEditor:t=!1})=>{var r,i,l;const _=(0,s.useMemo)(()=>"undefined"==typeof window?null:window.vkbmCurrentUserBootstrap||null,[]),u=(0,s.useMemo)(()=>(()=>{if("undefined"==typeof window)return{};try{const e=new URLSearchParams(window.location.search);return{menuId:Number(e.get("menu_id"))||0,staffId:Number(e.get("resource_id"))||0,date:e.get("date")||"",auth:e.get("vkbm_auth")||"",draft:S(e.get("draft")||"")}}catch(e){return{}}})(),[]),v=u.menuId||e||0,b=u.staffId||a||0,k=u.date||"",f=k?new Date(k):new Date,[p,y]=(0,s.useState)(v),[w,C]=(0,s.useState)(b),[P,E]=(0,s.useState)(k),[F,O]=(0,s.useState)(null),[z,H]=(0,s.useState)({year:f.getFullYear(),month:f.getMonth()+1}),[Y,G]=(0,s.useState)([]),[J,V]=(0,s.useState)([]),[W,X]=(0,s.useState)({taxEnabled:!1,taxRate:0,taxLabelText:"",reservationPageUrl:"",showMenuList:!0,staffEnabled:!1,defaultStaffId:0,resourceLabelSingular:(0,o.__)("Staff","vk-booking-manager"),resourceLabelPlural:(0,o.__)("Staff","vk-booking-manager"),showProviderLogo:!1,showProviderName:!1,providerName:"",providerLogoUrl:""}),[q,K]=(0,s.useState)({html:"",isLoading:!0,error:""}),[Q,Z]=(0,s.useState)(""),[ee,ae]=(0,s.useState)(!1),[ne,te]=(0,s.useState)(""),[re,oe]=(0,s.useState)(u.auth||""),[ie,se]=(0,s.useState)(_?.logoutUrl||""),[le,me]=(0,s.useState)(_?.shiftDashboardUrl||""),[ce,de]=(0,s.useState)(Boolean(_?.canManageReservations)),_e=Boolean(_?.canViewPrivateMenus),[ue,ve]=(0,s.useState)(!1),[be,ke]=(0,s.useState)(""),[ge,fe]=(0,s.useState)([]),[he,pe]=(0,s.useState)(0),ye="undefined"!=typeof document&&document.body.classList.contains("logged-in"),xe=u.draft||"",je=e=>{"undefined"!=typeof window&&oe(a=>{const n=a===e?"":e,t=new URL(window.location.href);return n?t.searchParams.set("vkbm_auth",n):t.searchParams.delete("vkbm_auth"),window.history.replaceState(null,"",t.toString()),n})},[Ne,we]=(0,s.useState)(null),[Se,Le]=(0,s.useState)(!1),[Ce,Pe]=(0,s.useState)(null),[Ee,Me]=(0,s.useState)([]),[Ie,Ue]=(0,s.useState)(!1),[Be,Re]=(0,s.useState)(null),[Te,De]=(0,s.useState)(!1),[$e,Fe]=(0,s.useState)(""),[Ae,Oe]=(0,s.useState)({html:"",isLoading:!1,error:""}),ze=(0,s.useRef)(null),He=(0,s.useRef)(null),[Ye,Ge]=(0,s.useState)(!1),Je=n&&W.staffEnabled;(0,s.useEffect)(()=>{let e=!0;return m()({path:"/vkbm/v1/provider-settings"}).then(a=>{e&&X({taxEnabled:Boolean(a?.tax_enabled),taxRate:Number(a?.tax_rate)||0,taxLabelText:"string"==typeof a?.tax_label_text?a.tax_label_text:"",currencySymbol:"string"==typeof a?.currency_symbol?a.currency_symbol:"",reservationPageUrl:a?.reservation_page_url||"",showMenuList:!1!==a?.reservation_show_menu_list,staffEnabled:Boolean(a?.staff_enabled),defaultStaffId:Number(a?.default_staff_id)||0,showProviderLogo:Boolean(a?.reservation_show_provider_logo),showProviderName:Boolean(a?.reservation_show_provider_name),resourceLabelSingular:"string"==typeof a?.resource_label_singular&&""!==a.resource_label_singular.trim()?a.resource_label_singular:(0,o.__)("Staff","vk-booking-manager"),resourceLabelPlural:"string"==typeof a?.resource_label_plural&&""!==a.resource_label_plural.trim()?a.resource_label_plural:"string"==typeof a?.resource_label_singular&&""!==a.resource_label_singular.trim()?a.resource_label_singular:(0,o.__)("Staff","vk-booking-manager"),providerName:"string"==typeof a?.provider_name?a.provider_name:"",providerLogoUrl:"string"==typeof a?.provider_logo_url?a.provider_logo_url:""})}).catch(()=>{}).finally(()=>{e&&Ge(!0)}),()=>{e=!1}},[]),(0,s.useEffect)(()=>{Ye&&(W.staffEnabled||(W.defaultStaffId>0&&w!==W.defaultStaffId?C(W.defaultStaffId):0===W.defaultStaffId&&0!==w&&C(0)))},[Ye,W.staffEnabled,W.defaultStaffId,w]),(0,s.useEffect)(()=>{let e=!0;return Ye?!W.showMenuList||p?(K({html:"",isLoading:!1,error:""}),()=>{e=!1}):(K({html:"",isLoading:!0,error:""}),m()({path:"/vkbm/v1/menu-loop"}).then(a=>{e&&K({html:a?.html||"",isLoading:!1,error:""})}).catch(a=>{e&&K({html:"",isLoading:!1,error:a?.message||(0,o.__)("Could not get menu list.","vk-booking-manager")})}),()=>{e=!1}):()=>{e=!1}},[Ye,W.showMenuList,p]),(0,s.useEffect)(()=>{let e=!0;if(!ye)return se(""),me(""),de(!1),()=>{e=!1};if(_&&"object"==typeof _&&"string"==typeof _.logoutUrl&&"string"==typeof _.shiftDashboardUrl)return se(_.logoutUrl||""),me(_.shiftDashboardUrl||""),de(Boolean(_.canManageReservations)),()=>{e=!1};const a=T(),n=I("/vkbm/v1/current-user",{redirect:a||void 0});return m()({path:n}).then(a=>{e&&(se(a?.logout_url||""),me(a?.shift_dashboard_url||""),de(Boolean(a?.can_manage_reservations)))}).catch(()=>{e&&(se(""),me(""),de(!1))}),()=>{e=!1}},[ye]),(0,s.useEffect)(()=>{ce&&("profile"!==re&&"bookings"!==re||oe(""))},[ce,re]),(0,s.useEffect)(()=>{if(!re)return void Z("");if("bookings"===re)return void Z("");const e="profile"===re||"bookings"===re;if(e&&!ye)return void Z("");if(!e&&ye)return void Z("");ae(!0),te(""),Z("");const a=new URLSearchParams;a.set("type",re);const n=T();n&&a.set("redirect",n),"login"===re?a.set("register_url",$("register")):"register"===re&&a.set("login_url",$("login")),m()({path:`/vkbm/v1/auth-form?${a.toString()}`,cache:"no-store",credentials:"same-origin"}).then(e=>{const a=e?.html||"",n=e?.message||"";Z(a),!a&&"register"===re&&n&&te(n)}).catch(e=>{te(e?.message||(0,o.__)("The form could not be displayed.","vk-booking-manager"))}).finally(()=>{ae(!1)})},[re,ye]);const Ve=(0,s.useCallback)(e=>{const a=Number(e)||0;a&&!he&&("undefined"==typeof window||window.confirm((0,o.__)("Do you want to cancel this reservation?","vk-booking-manager")))&&(pe(a),ke(""),m()({path:`/vkbm/v1/my-bookings/${a}/cancel`,method:"POST"}).then(()=>{fe(e=>Array.isArray(e)?e.filter(e=>Number(e?.id)!==a):[])}).catch(e=>{ke(e?.message||(0,o.__)("I was unable to cancel my reservation.","vk-booking-manager"))}).finally(()=>{pe(0)}))},[he]);(0,s.useEffect)(()=>{ye&&re&&"profile"!==re&&"bookings"!==re&&oe(""),ye||"profile"!==re&&"bookings"!==re||oe("")},[ye,re]),(0,s.useEffect)(()=>{let e=!0;return ye&&"bookings"===re?(ve(!0),ke(""),m()({path:"/vkbm/v1/my-bookings"}).then(a=>{e&&fe(Array.isArray(a)?a:[])}).catch(()=>{e&&(fe([]),ke((0,o.__)("The reservation list could not be loaded.","vk-booking-manager")))}).finally(()=>{e&&ve(!1)}),()=>{e=!1}):()=>{e=!1}},[re,ye]);const We=(0,s.useMemo)(()=>Y.find(e=>e.id===p),[Y,p]),Xe=(0,s.useMemo)(()=>J.find(e=>e.id===w),[J,w]),qe=(0,s.useMemo)(()=>{const e=We?.meta;if(!e)return[];const a=(Array.isArray(e._vkbm_staff_ids)&&e._vkbm_staff_ids.length?e._vkbm_staff_ids:Array.isArray(e.vkbm_staff_ids)&&e.vkbm_staff_ids.length?e.vkbm_staff_ids:[]).map(e=>"number"==typeof e?e:"string"==typeof e&&Number(e)||0).filter(e=>e>0);return Array.from(new Set(a))},[We]),Ke=(0,s.useMemo)(()=>{if(!W.staffEnabled)return J;if(0===qe.length)return J;const e=new Set(qe);return J.filter(a=>e.has(a.id))},[qe,J,W.staffEnabled]),Qe=1===qe.length;(0,s.useEffect)(()=>{if(W.staffEnabled&&p&&0!==qe.length){if(1===qe.length){const e=qe[0];return void(w!==e&&C(e))}w&&!qe.includes(w)&&C(0)}},[p,qe,w,W.staffEnabled]);const Ze=(0,s.useMemo)(()=>{var e,a,n;const t=We?.meta;if(!t)return!1;const r=null!==(e=null!==(a=null!==(n=t._vkbm_disable_nomination_fee)&&void 0!==n?n:t.vkbm_disable_nomination_fee)&&void 0!==a?a:We?._vkbm_disable_nomination_fee)&&void 0!==e?e:We?.vkbm_disable_nomination_fee;if(null==r)return!1;if("boolean"==typeof r)return r;const o=String(r).toLowerCase().trim();return"1"===o||"true"===o},[We]),ea=ye&&"profile"===re,aa=("profile"===re||"bookings"===re)&&ye||!ye&&("login"===re||"register"===re),na=!aa,ta=Boolean(p),ra=e=>["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link",e&&re===e&&"is-active"].filter(Boolean).join(" "),oa=(0,s.useCallback)(e=>{const a=j(e);return null===a?null:a},[W]),ia=(0,s.useMemo)(()=>(e=>{if(!e)return null;const a=[e?.meta?.vkbm_base_price,e?.meta?._vkbm_base_price,e?._vkbm_base_price,e?.price];for(const e of a){const a=j(e);if(null!==a)return a}return null})(We),[We]),sa=(0,s.useMemo)(()=>null===ia?null:oa(ia),[oa,ia]),la=(0,s.useMemo)(()=>{var e,a,n;if(!W.staffEnabled)return 0;if(!w)return null;if(Ze)return 0;const t=null!==(e=null!==(a=null!==(n=Xe?.meta?.vkbm_nomination_fee)&&void 0!==n?n:Xe?.meta?._vkbm_nomination_fee)&&void 0!==a?a:Xe?._vkbm_nomination_fee)&&void 0!==e?e:Xe?.nomination_fee,r=j(t);return null===r?0:r},[Xe,w,Ze,W.staffEnabled]),ma=(0,s.useMemo)(()=>null===la?null:oa(la),[oa,la]),ca=(0,s.useMemo)(()=>null===sa?null:sa+(null===ma?0:ma),[sa,ma]),da=(0,s.useMemo)(()=>{if(!Ye)return[];const e=W.taxEnabled&&W.taxLabelText&&""!==W.taxLabelText.trim()?W.taxLabelText:"",a=a=>({value:a,taxLabel:"—"!==a?e:""}),n=W.currencySymbol||null,t=[{key:"base",label:(0,o.__)("Service basic fee","vk-booking-manager"),...a(null!==sa?N(sa,n):"—")},{key:"total",label:(0,o.__)("Total basic fee","vk-booking-manager"),...a(null!==ca?N(ca,n):"—"),highlight:!0}];return W.staffEnabled&&t.splice(1,0,{key:"nomination",label:(0,o.__)("Nomination fee","vk-booking-manager"),value:null===ma?w?N(oa(0),n):"—":N(ma,n),taxLabel:""}),t},[sa,ma,ca,W,Ye]),_a=(0,s.useMemo)(()=>I("/wp/v2/vkbm_service_menu",{per_page:100,_fields:"id,title,meta,menu_order,vkbm_menu_group",status:_e?"publish,private":void 0}),[_e]);R(_a,G),(0,s.useEffect)(()=>{let e=!0;return p?(Oe({html:"",isLoading:!0,error:""}),m()({path:`/vkbm/v1/menu-preview/${p}`}).then(a=>{e&&Oe({html:a?.html||"",isLoading:!1,error:""})}).catch(a=>{e&&Oe({html:"",isLoading:!1,error:a?.message||(0,o.__)("Failed to retrieve menu information.","vk-booking-manager")})}),()=>{e=!1}):(Oe({html:"",isLoading:!1,error:""}),()=>{e=!1})},[p]);const ua=(0,s.useMemo)(()=>Ye&&W.staffEnabled?"/wp/v2/vkbm_resource?per_page=100&_fields=id,title,meta,nomination_fee":"",[Ye,W.staffEnabled]);R(ua,V);const va=(0,s.useMemo)(()=>Ne?.days?Ne.days.reduce((e,a)=>(e[a.date]=a,e),{}):{},[Ne]),ba=(0,s.useCallback)(()=>{if(!p||!z.year||!z.month)return void we(null);Le(!0),Pe(null);const e=I("/vkbm/v1/calendar-meta",{menu_id:p,resource_id:w||void 0,year:z.year,month:z.month});m()({path:e}).then(e=>{we(e)}).catch(e=>{Pe(e?.message||(0,o.__)("Failed to load calendar.","vk-booking-manager"))}).finally(()=>{Le(!1)})},[p,w,z]);(0,s.useEffect)(()=>{ba()},[ba]),(0,s.useEffect)(()=>{if(!p||!P)return void Me([]);Ue(!0),Re(null);const e=I("/vkbm/v1/availabilities",{menu_id:p,resource_id:w||void 0,date:P});m()({path:e}).then(e=>{var a,n,t;const r=Array.isArray(e?.slots)?e.slots:[],i=w&&null!==(a=null!==(n=null!==(t=Xe?.title?.rendered)&&void 0!==t?t:Xe?.title)&&void 0!==n?n:Xe?.name)&&void 0!==a?a:"",s=r.map(e=>{const a=e.staff_label||e.staff?.name||i||(0,o.__)("No preference","vk-booking-manager");return{...e,staff_label:i||a,staff:e.staff||(i?{id:w,name:i}:null)}});Me(s)}).catch(e=>{Re(e?.message||(0,o.__)("Failed to read free space.","vk-booking-manager"))}).finally(()=>{Ue(!1)})},[p,w,P,Xe]),(0,s.useEffect)(()=>{Fe("")},[F,p,w]),(0,s.useEffect)(()=>{F&&He.current&&He.current.scrollIntoView({behavior:"smooth",block:"start"})},[F]);const ka=e=>{const a=Y.find(a=>a.id===e),n=a?.meta;if(W.staffEnabled){const e=Array.isArray(n?._vkbm_staff_ids)&&n._vkbm_staff_ids.length?n._vkbm_staff_ids:Array.isArray(n?.vkbm_staff_ids)&&n.vkbm_staff_ids.length?n.vkbm_staff_ids:[],a=Array.from(new Set(e.map(e=>"number"==typeof e?e:"string"==typeof e&&Number(e)||0).filter(e=>e>0)));1===a.length?C(a[0]):w&&!a.includes(w)&&C(0)}else Ye&&W.defaultStaffId>0?C(W.defaultStaffId):Ye&&C(0);y(e),E(""),O(null),H({year:(new Date).getFullYear(),month:(new Date).getMonth()+1})},ga=(0,s.useCallback)(e=>{const a=e.target;if(!a||"function"!=typeof a.closest)return;if(!a.closest("a.vkbm-menu-loop__button--reserve"))return;e.preventDefault();const n=a.closest(".vkbm-menu-loop__item");if(!n)return;const t=n.getAttribute("data-menu-id")||"",r=Number(t)||0;if(!r)return;ka(r);const o=ze.current?.closest?.(".vkbm-reservation-block"),i=o||ze.current;i&&i.scrollIntoView({behavior:"smooth",block:"start"})},[ka]),fa=Boolean(p&&F),ha=(0,s.useCallback)(()=>{var e,a,n,r,i,s,l,c,d;if(t)return void Fe((0,o.__)("The editor does not transition to the confirmation page.","vk-booking-manager"));if(!F||!p)return void Fe((0,o.__)("Please select your menu and reservation slot before proceeding.","vk-booking-manager"));De(!0),Fe("");const _={token:B(),menu_id:p,resource_id:w||0,menu_label:null!==(e=null!==(a=null!==(n=We?.title?.rendered)&&void 0!==n?n:We?.title)&&void 0!==a?a:We?.name)&&void 0!==e?e:"",staff_label:w?null!==(r=null!==(i=null!==(s=Xe?.title?.rendered)&&void 0!==s?s:Xe?.title)&&void 0!==i?i:Xe?.name)&&void 0!==r?r:"":(0,o.__)("No preference","vk-booking-manager"),is_staff_preferred:Boolean(w),date:P,slot:{slot_id:F.slot_id,start_at:F.start_at,end_at:F.end_at,service_end_at:F.service_end_at||F.end_at,duration_minutes:F.duration_minutes||0,staff_label:F.staff_label||(w?null!==(l=null!==(c=null!==(d=Xe?.title?.rendered)&&void 0!==d?d:Xe?.title)&&void 0!==c?c:Xe?.name)&&void 0!==l?l:"":(0,o.__)("No preference","vk-booking-manager")),staff:F.staff?{id:F.staff.id,name:F.staff.name||F.staff.title||""}:null,assignable_staff_ids:Array.isArray(F.assignable_staff_ids)?F.assignable_staff_ids.map(e=>Number(e)||0).filter(Boolean):[],auto_assign:Boolean(F.auto_assign||!w&&!F.staff&&(!F.assignable_staff_ids||F.assignable_staff_ids.length>0))},meta:{timezone:Ne?.meta?.timezone||""}};m()({path:"/vkbm/v1/drafts",method:"POST",data:_}).then(e=>{const a=S(e?.token),n=e?.expires_in||1800;if(!a)throw new Error((0,o.__)("Temporary reservation data save failed.","vk-booking-manager"));if(((e,a=1800)=>{if("undefined"==typeof document)return;const n=S(e);if(!n)return;let t=`${U}=${encodeURIComponent(n)}; path=/; max-age=${a}; SameSite=Lax`;"undefined"!=typeof window&&"https:"===window.location?.protocol&&(t+="; Secure"),document.cookie=t})(a,n),"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.delete("vkbm_auth"),e.searchParams.set("draft",a),window.location.href=e.toString()}}).catch(e=>{Fe(e?.message||(0,o.__)("Failed to save reservation details. Please try again later.","vk-booking-manager"))}).finally(()=>{De(!1)})},[Ne?.meta?.timezone,We,Xe,t,p,P,F,w]),pa=W.showProviderLogo&&"string"==typeof W.providerLogoUrl&&""!==W.providerLogoUrl.trim(),ya=W.showProviderName&&"string"==typeof W.providerName&&""!==W.providerName.trim(),xa=pa||ya,ja=("string"==typeof W.reservationPageUrl?W.reservationPageUrl:"").trim(),Na=ya?W.providerName:(0,o.__)("Logo image","vk-booking-manager");return xe?(0,d.jsx)("div",{className:"vkbm-reservation vkbm-reservation--confirm",children:(0,d.jsx)(M,{redirectUrl:"",termsLabel:(0,o.__)("I agree to the terms of use","vk-booking-manager"),policyText:(0,o.__)("Please check our cancellation policy before booking.","vk-booking-manager"),successMessage:(0,o.__)("Your reservation has been completed.","vk-booking-manager")})}):(0,d.jsxs)("div",{className:"vkbm-reservation-layout",ref:ze,children:[xa?(0,d.jsxs)("div",{className:"vkbm-reservation-layout__header",children:[ja?(0,d.jsxs)("a",{className:"vkbm-reservation-layout__brand vkbm-reservation-layout__brand-link",href:ja,children:[pa&&(0,d.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:W.providerLogoUrl,alt:Na,loading:"lazy"}),ya&&(0,d.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:W.providerName})]}):(0,d.jsxs)("div",{className:"vkbm-reservation-layout__brand",children:[pa&&(0,d.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:W.providerLogoUrl,alt:Na,loading:"lazy"}),ya&&(0,d.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:W.providerName})]}),(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),aa?(0,d.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:()=>je(re||""),children:(0,o.__)("Return","vk-booking-manager")}):ye&&ce?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:le||"",children:(0,o.__)("Shift/reservation table","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||D(W.reservationPageUrl),children:(0,o.__)("Log out","vk-booking-manager")})]}):ye?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",className:ra("bookings"),onClick:()=>je("bookings"),"aria-pressed":"bookings"===re,children:(0,o.__)("Confirm reservation","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("button",{type:"button",className:ra("profile"),onClick:()=>je("profile"),"aria-pressed":ea,children:(0,o.__)("Edit user information","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||D(W.reservationPageUrl),children:(0,o.__)("Log out","vk-booking-manager")})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",className:ra("login"),onClick:()=>je("login"),"aria-pressed":"login"===re,children:(0,o.__)("Log in","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("button",{type:"button",className:ra("register"),onClick:()=>je("register"),"aria-pressed":"register"===re,children:(0,o.__)("Sign up","vk-booking-manager")})]}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]})]}):(0,d.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,o.__)("Reservation block navigation","vk-booking-manager"),children:[(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),aa?(0,d.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:()=>je(re||""),children:(0,o.__)("return","vk-booking-manager")}):ye&&ce?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:le||"",children:(0,o.__)("Shift/reservation table","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||D(W.reservationPageUrl),children:(0,o.__)("Log out","vk-booking-manager")})]}):ye?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",className:ra("bookings"),onClick:()=>je("bookings"),"aria-pressed":"bookings"===re,children:(0,o.__)("Confirm reservation","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("button",{type:"button",className:ra("profile"),onClick:()=>je("profile"),"aria-pressed":ea,children:(0,o.__)("Edit user information","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||D(W.reservationPageUrl),children:(0,o.__)("Log out","vk-booking-manager")})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",className:ra("login"),onClick:()=>je("login"),"aria-pressed":"login"===re,children:(0,o.__)("Log in","vk-booking-manager")}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,d.jsx)("button",{type:"button",className:ra("register"),onClick:()=>je("register"),"aria-pressed":"register"===re,children:(0,o.__)("Sign up","vk-booking-manager")})]}),(0,d.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),aa&&(0,d.jsx)("section",{className:"vkbm-user-section","aria-live":"polite",children:(0,d.jsxs)("div",{className:"vkbm-user-section__panel vkbm-reservation__auth-panel",children:["bookings"===re&&ue&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-reservation__auth-loading",role:"status",children:(0,o.__)("Loading...","vk-booking-manager")}),"bookings"===re&&be&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-reservation__auth-error",role:"alert",children:be}),"bookings"===re&&!ue&&!be&&0===ge.length&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-reservation__auth-loading",role:"status",children:(0,o.__)("There are no reservations to display.","vk-booking-manager")}),"bookings"===re&&ge.length>0&&(0,d.jsx)("div",{className:"vkbm-confirm",children:ge.map(e=>{const a=((e,a)=>{if(!e)return{date:"",time:""};let n;try{n="function"==typeof c.__experimentalGetSettings?(0,c.__experimentalGetSettings)():void 0}catch(e){n=void 0}const t=n?.formats?.date||"Y/m/d",r=n?.formats?.time||"H:i",o=n?.timezone?.string,i=new Date(e);if(Number.isNaN(i.getTime()))return{date:e,time:""};const s=(0,c.dateI18n)(t,i,o),l=(0,c.dateI18n)("D",i,o),m=(0,c.dateI18n)(r,i,o);let d=m;if(a){const e=new Date(a);Number.isNaN(e.getTime())||(d=`${m} - ${(0,c.dateI18n)(r,e,o)}`.trim())}return{date:`${s}(${l})`,time:d}})(e?.start_at,e?.end_at),n=String(e?.status||"").trim(),t="pending"===n.toLowerCase(),r="cancelled"===n.toLowerCase();return(0,d.jsxs)("div",{className:["vkbm-confirm__summary",r&&"vkbm-confirm__summary--cancelled"].filter(Boolean).join(" "),children:[(a.date||a.time)&&(0,d.jsxs)("div",{className:"vkbm-confirm__summary-title",children:[(0,d.jsxs)("div",{className:"vkbm-confirm__datetime",children:[t&&(0,d.jsx)("span",{className:"vkbm-confirm__status vkbm-confirm__status--pending",children:(0,o.__)("Pending","vk-booking-manager")}),r&&(0,d.jsx)("span",{className:"vkbm-confirm__status vkbm-confirm__status--cancelled",children:(0,o.__)("Cancelled","vk-booking-manager")}),a.date&&(0,d.jsx)("span",{className:"vkbm-confirm__date",children:a.date}),a.time&&(0,d.jsxs)("span",{className:"vkbm-confirm__time",children:[a.date?" ":"",a.time]})]}),e?.can_cancel&&(0,d.jsx)("button",{type:"button",className:"vkbm-button vkbm-button__sm vkbm-button__secondary vkbm-confirm__cancel-button",onClick:()=>Ve(e?.id),disabled:he===Number(e?.id),children:he===Number(e?.id)?(0,o.__)("Processing...","vk-booking-manager"):(0,o.__)("Cancelled","vk-booking-manager")})]}),(0,d.jsx)(L,{booking:e,resourceLabel:W.resourceLabelSingular,currencySymbol:W.currencySymbol||null})]},e?.id||datetimeLabel)})}),"bookings"!==re&&ee&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-reservation__auth-loading",role:"status",children:(0,o.__)("Loading form...","vk-booking-manager")}),"bookings"!==re&&ne&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-reservation__auth-error",role:"alert",children:ne}),"bookings"!==re&&Q&&(0,d.jsx)("div",{className:"vkbm-reservation__auth-form",dangerouslySetInnerHTML:{__html:Q}})]})}),na&&(0,d.jsxs)("div",{className:["vkbm-reservation",t&&"vkbm-reservation--is-editor"].filter(Boolean).join(" "),children:[Ye?W.showMenuList&&!p?(0,d.jsxs)("section",{className:"vkbm-reservation__menu-list","aria-live":"polite",children:[q.isLoading&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info",role:"status",children:(0,o.__)("Loading service menu...","vk-booking-manager")}),q.error&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__danger",role:"alert",children:q.error}),Ye&&!q.isLoading&&!q.error&&!q.html&&(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__warning",role:"status",children:(0,o.__)("There are no service menus to display.","vk-booking-manager")}),q.html&&(0,d.jsx)("div",{className:"vkbm-reservation__menu-loop",onClick:ga,dangerouslySetInnerHTML:{__html:q.html}})]}):(0,d.jsx)(x,{menuId:p,staffId:w,menus:Y,staffOptions:Ke,onMenuChange:ka,onStaffChange:e=>{C(e),O(null)},allowStaffSelection:Je,showStaffField:W.staffEnabled,lockStaffSelection:Qe,pricingRows:da,menuPreviewLoading:Ae.isLoading,menuPreviewError:Ae.error,menuPreviewHtml:Ae.html,resourceLabelSingular:W.resourceLabelSingular}):(0,d.jsx)("p",{className:"vkbm-alert vkbm-alert__info",role:"status",children:(0,o.__)("Loading...","vk-booking-manager")}),ta&&(0,d.jsxs)("div",{className:"vkbm-reservation__body",children:[(0,d.jsx)(g,{year:z.year,month:z.month,dayMetaMap:va,selectedDate:P,onSelectDate:e=>{p&&(E(e),O(null))},onMonthChange:e=>{H(a=>{const n=a.month+e,t=new Date(a.year,n-1,1);return{year:t.getFullYear(),month:t.getMonth()+1}})},isLoading:Se,locale:_?.locale}),(0,d.jsx)("div",{className:"vkbm-reservation__slots",children:(0,d.jsx)(h,{slots:Ee,selectedDate:P,onSelectSlot:e=>O(e),selectedSlotId:F?.slot_id,isLoading:Ie,error:Ce||Be,showStaffLabel:W.staffEnabled,selectedStaffLabel:w&&null!==(r=null!==(i=null!==(l=Xe?.title?.rendered)&&void 0!==l?l:Xe?.title)&&void 0!==i?i:Xe?.name)&&void 0!==r?r:""})})]}),ta&&(0,d.jsxs)("div",{className:"vkbm-plan-summary__status vkbm-plan-summary__status--detached",ref:He,children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"vkbm-plan-summary__status-label",children:(0,o.__)("Selected frame","vk-booking-manager")}),F?(0,d.jsxs)("strong",{children:[F.start_at?.slice(0,10)," ",A(F.start_at)," ",F.start_at?.slice(11,16)," -"," ",(F.service_end_at||F.end_at)?.slice(11,16)]}):(0,d.jsx)("span",{children:(0,o.__)("Not selected","vk-booking-manager")})]}),(0,d.jsxs)("div",{className:"vkbm-plan-summary__actions",children:[(0,d.jsx)("button",{type:"button",className:"vkbm-plan-summary__action vkbm-button vkbm-button__md vkbm-button__primary",onClick:ha,disabled:!fa||Te,children:Te?(0,o.__)("Processing...","vk-booking-manager"):(0,o.__)("Proceed to Reservation","vk-booking-manager")}),$e&&(0,d.jsx)("p",{className:"vkbm-plan-summary__error",children:$e})]})]})]})]})},A=e=>{if(!e)return"";try{const a=new Date(e);return Number.isNaN(a.getTime())?"":`(${new Intl.DateTimeFormat("ja-JP",{weekday:"short"}).format(a)})`}catch(e){return""}},O="undefined"!=typeof window&&window.vkbmReservationBlock?.providerSettingsUrl?window.vkbmReservationBlock.providerSettingsUrl:"",z=()=>(0,d.jsxs)("p",{className:"vkbm-reservation-block-settings-message",children:[(0,o.__)('Configure reservation block settings from the "',"vk-booking-manager"),O?(0,d.jsx)("a",{href:O,target:"_blank",rel:"noopener noreferrer",children:(0,o.__)("BM basic settings","vk-booking-manager")}):(0,o.__)("BM basic settings","vk-booking-manager"),(0,o.__)('" screen.',"vk-booking-manager")]}),H=JSON.parse('{"apiVersion":3,"name":"vk-booking-manager/reservation","title":"reserved block","description":"This is a reservation UI that allows you to select menus and search for available slots.","category":"widgets","icon":"calendar-alt","textdomain":"vk-booking-manager","attributes":{},"supports":{"align":["wide","full"],"anchor":true,"spacing":{"margin":true,"padding":true}},"editorScript":"file:./index.js","viewScript":"file:./view.js","style":"file:./style-index.css","editorStyle":"file:./index.css"}'),Y=[{attributes:{defaultMenuId:{type:"string",source:"attribute",selector:"div",attribute:"data-default-menu-id",default:""},defaultResourceId:{type:"string",source:"attribute",selector:"div",attribute:"data-default-resource-id",default:""},allowMenuSelection:{type:"string",source:"attribute",selector:"div",attribute:"data-allow-menu-selection",default:"1"},allowStaffSelection:{type:"string",source:"attribute",selector:"div",attribute:"data-allow-staff-selection",default:"1"}},save:({attributes:e})=>{var a,n;const t=r.useBlockProps.save({className:"vkbm-reservation-block"}),o="string"==typeof e?.defaultMenuId?e.defaultMenuId:"",i="string"==typeof e?.defaultResourceId?e.defaultResourceId:"",s="0"===String(null!==(a=e?.allowMenuSelection)&&void 0!==a?a:"1")?"0":"1",l="0"===String(null!==(n=e?.allowStaffSelection)&&void 0!==n?n:"1")?"0":"1";return(0,d.jsx)("div",{...t,"data-default-menu-id":o,"data-default-resource-id":i,"data-allow-menu-selection":s,"data-allow-staff-selection":l})}}];(0,t.registerBlockType)(H,{edit:()=>{const e=(0,r.useBlockProps)();return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.InspectorControls,{children:(0,d.jsx)(i.PanelBody,{title:(0,o.__)("Block settings","vk-booking-manager"),initialOpen:!0,children:(0,d.jsx)(z,{})})}),(0,d.jsx)("div",{...e,children:(0,d.jsx)(F,{defaultMenuId:0,defaultStaffId:0,allowStaffSelection:!0,isEditor:!0})})]})},save:()=>{const e=r.useBlockProps.save({className:"vkbm-reservation-block"});return(0,d.jsx)("div",{...e})},deprecated:Y})}},n={};function t(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return a[e](o,o.exports,t),o.exports}t.m=a,e=[],t.O=(a,n,r,o)=>{if(!n){var i=1/0;for(c=0;c<e.length;c++){for(var[n,r,o]=e[c],s=!0,l=0;l<n.length;l++)(!1&o||i>=o)&&Object.keys(t.O).every(e=>t.O[e](n[l]))?n.splice(l--,1):(s=!1,o<i&&(i=o));if(s){e.splice(c--,1);var m=r();void 0!==m&&(a=m)}}return a}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[n,r,o]},t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={439:0,159:0};t.O.j=a=>0===e[a];var a=(a,n)=>{var r,o,[i,s,l]=n,m=0;if(i.some(a=>0!==e[a])){for(r in s)t.o(s,r)&&(t.m[r]=s[r]);if(l)var c=l(t)}for(a&&a(n);m<i.length;m++)o=i[m],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(c)},n=globalThis.webpackChunkvk_booking_manager=globalThis.webpackChunkvk_booking_manager||[];n.forEach(a.bind(null,0)),n.push=a.bind(null,n.push.bind(n))})();var r=t.O(void 0,[159],()=>t(19));r=t.O(r)})();