(()=>{"use strict";var e={n:a=>{var n=a&&a.__esModule?()=>a.default:()=>a;return e.d(n,{a:n}),n},d:(a,n)=>{for(var t in n)e.o(n,t)&&!e.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:n[t]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.domReady;var n=e.n(a);const t=window.wp.element,r=window.wp.i18n,o=window.wp.apiFetch;var i=e.n(o);const s=window.wp.date,l=window.ReactJSXRuntime,m=[(0,r.__)("Sun","vk-booking-manager"),(0,r.__)("Mon","vk-booking-manager"),(0,r.__)("Tue","vk-booking-manager"),(0,r.__)("Wed","vk-booking-manager"),(0,r.__)("Thu","vk-booking-manager"),(0,r.__)("Fri","vk-booking-manager"),(0,r.__)("Sat","vk-booking-manager")],c=e=>e.toString().padStart(2,"0"),d=e=>[e.getFullYear(),c(e.getMonth()+1),c(e.getDate())].join("-"),_=(e,a,n)=>{const t=new Date(e,a-1,1),r=n||"en";if("string"==typeof r&&r.startsWith("ja"))return new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"numeric"}).format(t);const o="string"==typeof r?r.replace("_","-"):"en-US";return new Intl.DateTimeFormat(o,{year:"numeric",month:"long"}).format(t)},u=d(new Date),v=({year:e,month:a,dayMetaMap:n={},selectedDate:o,onSelectDate:i,onMonthChange:s,isLoading:c,locale:v})=>{const b=e=>{if(!e||"normal"===e)return"";switch(e){case"holiday":return(0,r.__)("Closed days","vk-booking-manager");case"special_open":return(0,r.__)("Special Opening","vk-booking-manager");case"special_close":return(0,r.__)("Temporary closure","vk-booking-manager");case"off":return(0,r.__)("private","vk-booking-manager");default:return e}},k=(0,t.useMemo)(()=>((e,a)=>{const n=[],t=new Date(e,a-1,1).getDay();let r=new Date(e,a-1,1-t);for(let e=0;e<6;e+=1){const e=[];for(let n=0;n<7;n+=1){const t=new Date(r);e.push({label:t.getDate(),date:t,iso:d(t),inMonth:t.getMonth()===a-1,weekday:n}),r.setDate(r.getDate()+1)}n.push(e)}return n})(e,a),[e,a]);return(0,l.jsxs)("div",{className:"vkbm-calendar",children:[(0,l.jsxs)("header",{className:"vkbm-calendar__header",children:[(0,l.jsx)("button",{type:"button",className:"vkbm-calendar__nav",onClick:()=>s(-1),"aria-label":(0,r.__)("previous month","vk-booking-manager"),children:"‹"}),(0,l.jsxs)("div",{className:"vkbm-calendar__current",children:[_(e,a,v),c&&(0,l.jsx)("span",{className:"vkbm-calendar__spinner","aria-live":"polite",children:(0,r.__)("Loading...","vk-booking-manager")})]}),(0,l.jsx)("button",{type:"button",className:"vkbm-calendar__nav",onClick:()=>s(1),"aria-label":(0,r.__)("next month","vk-booking-manager"),children:"›"})]}),(0,l.jsx)("div",{className:"vkbm-calendar__weekdays",children:m.map(e=>(0,l.jsx)("span",{children:e},e))}),(0,l.jsx)("div",{className:"vkbm-calendar__grid",children:k.map((e,a)=>(0,l.jsx)("div",{className:"vkbm-calendar__week",children:e.map(e=>{const a=n[e.iso]||{},t=o===e.iso,r=!e.inMonth||Boolean(a.is_disabled)||e.iso<u;return(0,l.jsxs)("button",{type:"button",className:["vkbm-calendar__day",!e.inMonth&&"vkbm-calendar__day--muted",t&&"vkbm-calendar__day--selected",a.available_slots>0&&"vkbm-calendar__day--available"].filter(Boolean).join(" "),onClick:()=>i(e.iso),disabled:r,children:[(0,l.jsx)("span",{className:"vkbm-calendar__day-label",children:e.label}),b(a.shift_status)&&(0,l.jsx)("span",{className:"vkbm-calendar__status",children:b(a.shift_status)})]},e.iso)})},`week-${a}`))})]})},b=e=>e?e.slice(11,16):"",k=({slots:e,selectedDate:a,onSelectSlot:n,selectedSlotId:t,isLoading:o,error:i,selectedStaffLabel:s="",showStaffLabel:m=!0})=>i?(0,l.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--alert",children:(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-alert--compact",role:"alert",children:i})}):a?o?(0,l.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--placeholder",children:(0,r.__)("Loading empty slots...","vk-booking-manager")}):e?.length?(0,l.jsx)("div",{className:"vkbm-slot-list",children:e.map(e=>(0,l.jsxs)("button",{type:"button",className:["vkbm-slot-list__item",t===e.slot_id&&"is-selected"].filter(Boolean).join(" "),onClick:()=>n(e),children:[(0,l.jsxs)("div",{className:"vkbm-slot-list__time",children:[b(e.start_at)," -"," ",b(e.service_end_at||e.end_at)]}),m&&(0,l.jsx)("div",{className:"vkbm-slot-list__staff",children:e.staff_label||e.staff?.name||s||(0,r.__)("No preference","vk-booking-manager")})]},e.slot_id))}):(0,l.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--placeholder",children:(0,r.__)("There are no available reservation times for the selected criteria.","vk-booking-manager")}):(0,l.jsx)("div",{className:"vkbm-slot-list vkbm-slot-list--alert",children:(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-alert--compact",role:"status",children:(0,r.__)("When you select a date from the calendar, reservation candidates will be displayed.","vk-booking-manager")})}),g=({label:e,options:a,value:n,onChange:t,disabled:r,placeholder:o})=>(0,l.jsxs)("label",{className:"vkbm-plan-summary__field",children:[(0,l.jsx)("span",{className:"vkbm-plan-summary__label",children:e}),(0,l.jsxs)("select",{value:n||"",onChange:e=>t(e.target.value),disabled:r,children:[(0,l.jsx)("option",{value:"",children:o}),a.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),f=({label:e,value:a,placeholder:n})=>(0,l.jsxs)("div",{className:"vkbm-plan-summary__field",children:[(0,l.jsx)("span",{className:"vkbm-plan-summary__label",children:e}),(0,l.jsx)("span",{className:"vkbm-plan-summary__value",children:a||n})]}),h=({menuId:e,staffId:a,menus:n,staffOptions:t,onMenuChange:o,onStaffChange:i,allowStaffSelection:s,showStaffField:m=!0,pricingRows:c=[],menuPreviewLoading:d=!1,menuPreviewError:_="",menuPreviewHtml:u="",resourceLabelSingular:v=(0,r.__)("Staff","vk-booking-manager"),lockStaffSelection:b=!1})=>{const k=(()=>{const e=(0,r.__)("Please select a menu.","vk-booking-manager");return e.includes("%s")?(0,r.sprintf)(e,(0,r.__)("Menu","vk-booking-manager")):e})(),h=[...n].sort((e,a)=>{var n,t,r,o,i,s;const l=e?.vkbm_menu_group||null,m=a?.vkbm_menu_group||null,c=Number.isFinite(l?.order)?l.order:Number.MAX_SAFE_INTEGER,d=Number.isFinite(m?.order)?m.order:Number.MAX_SAFE_INTEGER;if(c!==d)return c-d;const _=Boolean(l);if(_!==Boolean(m))return _?-1:1;const u=String(null!==(n=l?.name)&&void 0!==n?n:""),v=String(null!==(t=m?.name)&&void 0!==t?t:""),b=u.localeCompare(v);if(0!==b)return b;const k=Number.isFinite(e?.menu_order)?e.menu_order:0,g=Number.isFinite(a?.menu_order)?a.menu_order:0;if(k!==g)return k-g;const f=String(null!==(r=null!==(o=e?.title?.rendered)&&void 0!==o?o:e?.title)&&void 0!==r?r:""),h=String(null!==(i=null!==(s=a?.title?.rendered)&&void 0!==s?s:a?.title)&&void 0!==i?i:"");return f.localeCompare(h)}).map(e=>{var a;return{id:e.id,name:null!==(a=e.title?.rendered)&&void 0!==a?a:e.title}}),p=t.map(e=>{var a,n;return{id:e.id,name:null!==(a=null!==(n=e.title?.rendered)&&void 0!==n?n:e.name)&&void 0!==a?a:e.title}});return(0,l.jsxs)("div",{className:"vkbm-plan-summary",children:[(0,l.jsxs)("div",{className:"vkbm-plan-summary__selectors",children:[(0,l.jsx)(g,{label:(0,r.__)("Menu","vk-booking-manager"),options:h,value:e,onChange:e=>o(Number(e)||0),placeholder:(0,r.__)("Select menu","vk-booking-manager"),disabled:!h.length}),m&&(s?(0,l.jsx)(g,{label:v,options:p,value:a,onChange:e=>i(Number(e)||0),placeholder:(0,r.__)("No preference","vk-booking-manager"),disabled:!p.length||b}):(0,l.jsx)(f,{label:v,value:p.find(e=>e.id===a)?.name,placeholder:(0,r.__)("No preference","vk-booking-manager")}))]}),e?(0,l.jsxs)("div",{className:"vkbm-plan-summary__menu-preview vkbm-reservation__menu-preview",children:[d&&(0,l.jsx)("p",{className:"vkbm-reservation__menu-preview-notice",children:(0,r.__)("Loading menu information...","vk-booking-manager")}),!d&&_&&(0,l.jsx)("div",{className:"vkbm-reservation__error",children:_}),!d&&!_&&u&&(0,l.jsx)("div",{className:"vkbm-reservation__menu-preview-card",dangerouslySetInnerHTML:{__html:u}})]}):null,e?c?.length>0?(0,l.jsx)("div",{className:"vkbm-plan-summary__pricing",children:c.map(e=>{var a;return(0,l.jsxs)("div",{className:"vkbm-plan-summary__pricing-row",children:[(0,l.jsx)("span",{className:"vkbm-plan-summary__pricing-label",children:e.label}),(0,l.jsxs)("strong",{className:["vkbm-plan-summary__pricing-value",e.highlight&&"vkbm-plan-summary__pricing-value--accent"].filter(Boolean).join(" "),children:[(0,l.jsx)("span",{className:"vkbm-plan-summary__pricing-amount",children:null!==(a=e.value)&&void 0!==a?a:"—"}),e.taxLabel?(0,l.jsx)("span",{className:"vkbm-plan-summary__pricing-tax",children:e.taxLabel}):null]})]},e.key)})}):null:(0,l.jsx)("div",{className:"vkbm-plan-summary__pricing vkbm-plan-summary__pricing--alert",children:(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-alert--compact",role:"status",children:k})})]})},p=e=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e)&&e>=0)return e;if("string"==typeof e){const a=e.trim();if(""===a)return null;const n=Number(a);if(Number.isFinite(n)&&n>=0)return n}return null},y=(e,a=null)=>{const n=p(e);if(null===n)return"";let t;try{t=new Intl.NumberFormat(x())}catch(e){t=new Intl.NumberFormat("ja-JP")}const o=t.format(n),i="string"==typeof a?a.trim():"",s=""!==i?i:(()=>{if("undefined"==typeof window)return"$";const e=window?.vkbmCurrentUserBootstrap?.locale;return"string"==typeof e&&""!==e.trim()&&e.toLowerCase().startsWith("ja")?"¥":"$"})();return""!==s?`${s}${o}`:(0,r.sprintf)(/* translators: %s: price amount */ /* translators: %s: price amount */
(0,r.__)("$%s","vk-booking-manager"),o)},x=()=>{if("undefined"==typeof window)return"ja-JP";const e=window?.vkbmCurrentUserBootstrap?.locale;return"string"==typeof e&&""!==e.trim()?e.trim():"ja-JP"},j=(e="")=>"string"!=typeof e?"":e.toLowerCase().replace(/[^a-z0-9]/g,""),N=({booking:e,resourceLabel:a,emptyValue:n="",currencySymbol:t=null})=>{const o="string"==typeof a&&""!==a.trim()?a:(0,r.__)("Staff","vk-booking-manager"),i="string"==typeof e?.menu_name&&""!==e.menu_name.trim()?e.menu_name:n,s="string"==typeof e?.resource_name&&""!==e.resource_name.trim()?e.resource_name:n;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,l.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:(0,r.__)("Menu","vk-booking-manager")}),(0,l.jsx)("dd",{className:"vkbm-confirm__summary-item-value",children:i})]}),e?.is_staff_preferred&&(0,l.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,l.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:o}),(0,l.jsx)("dd",{className:"vkbm-confirm__summary-item-value",children:s})]}),(0,l.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,l.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:(0,r.__)("Total basic fee","vk-booking-manager")}),(0,l.jsx)("dd",{className:"vkbm-confirm__summary-item-value vkbm-confirm__summary-item-value--price",children:y(e?.total_price||0,t)})]}),"string"==typeof e?.other_conditions&&""!==e.other_conditions.trim()&&(0,l.jsxs)("dl",{className:"vkbm-confirm__summary-item vkbm-confirm__summary-item--other-conditions",children:[(0,l.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:(0,r.__)("Other conditions","vk-booking-manager")}),(0,l.jsx)("dd",{className:"vkbm-confirm__summary-value--multiline",children:e.other_conditions})]})]})},w=(e,a,n)=>{if(!e)return{date:"",time:""};const t=S(e,n,{includeTime:!1,includeDate:!0,includeWeekday:!0}),r=S(e,n,{includeTime:!0,includeDate:!1}),o=a?S(a,n,{includeTime:!0,includeDate:!1}):"";return{date:t,time:o?`${r} - ${o}`.trim():r}},S=(e,a,{includeTime:n=!0,includeDate:t=!0,includeWeekday:r=!1}={})=>{if(!e)return"";try{const o=new Date(e);if(Number.isNaN(o.getTime()))return e;let i;try{i="function"==typeof s.__experimentalGetSettings?(0,s.__experimentalGetSettings)():void 0}catch(e){i=void 0}const l=i?.formats?.date||"Y/m/d",m=i?.formats?.time||"H:i",c=a||i?.timezone?.string,d=t?(0,s.dateI18n)(l,o,c):"",_=n?(0,s.dateI18n)(m,o,c):"",u=r?(0,s.dateI18n)("D",o,c):"";return t&&n?r&&u?`${d}(${u}) ${_}`.trim():`${d} ${_}`.trim():t?r&&u?`${d}(${u})`.trim():d:_}catch(a){return e}},L=({label:e,value:a,valueClassName:n})=>(0,l.jsxs)("dl",{className:"vkbm-confirm__summary-item",children:[(0,l.jsx)("dt",{className:"vkbm-confirm__summary-item-title",children:e}),(0,l.jsx)("dd",{className:["vkbm-confirm__summary-item-value",n].filter(Boolean).join(" "),children:a||"—"})]}),C=({redirectUrl:e,termsLabel:a,policyText:n,successMessage:o,reservationPageUrl:s=""})=>{const m=(0,t.useMemo)(()=>"undefined"==typeof window?null:window.vkbmCurrentUserBootstrap||null,[]),c=(0,t.useMemo)(()=>(e=>{if("undefined"==typeof window)return"";const a=new URLSearchParams(window.location.search).get(e)||"";return j(a)})("draft"),[]),[d,_]=(0,t.useState)(null),[u,v]=(0,t.useState)(null),[b,k]=(0,t.useState)(null),[g,f]=(0,t.useState)(!0),[h,x]=(0,t.useState)(""),[S,C]=(0,t.useState)(""),[P,E]=(0,t.useState)(!1),[M,U]=(0,t.useState)(!1),[I,R]=(0,t.useState)(!1),[T,B]=(0,t.useState)(""),[D,$]=(0,t.useState)(!1),[F,A]=(0,t.useState)(""),[O,z]=(0,t.useState)(""),[H,Y]=(0,t.useState)(""),[G,J]=(0,t.useState)(""),[W,V]=(0,t.useState)(Boolean(m?.canManageReservations)),[X,q]=(0,t.useState)(m?.logoutUrl||""),[K,Q]=(0,t.useState)(m?.shiftDashboardUrl||""),[Z,ee]=(0,t.useState)(""),[ae,ne]=(0,t.useState)(""),[te,re]=(0,t.useState)(""),[oe,ie]=(0,t.useState)(""),[se,le]=(0,t.useState)(""),[me,ce]=(0,t.useState)(!1),[de,_e]=(0,t.useState)(!1),[ue,ve]=(0,t.useState)(!0),[be,ke]=(0,t.useState)((0,r.__)("Staff","vk-booking-manager")),[ge,fe]=(0,t.useState)(s||""),[he,pe]=(0,t.useState)(""),[ye,xe]=(0,t.useState)(""),je="undefined"!=typeof document&&document.body.classList.contains("logged-in");(0,t.useEffect)(()=>{console.log("[DEBUG] BookingConfirmApp mounted"),console.log("[DEBUG] isLoggedIn:",je),console.log("[DEBUG] userBootstrap:",m),console.log("[DEBUG] document body class:","undefined"!=typeof document?document.body.className:"no document")},[je,m]);const Ne=(0,t.useMemo)(()=>(()=>{if("undefined"==typeof window)return{};try{const e=new URLSearchParams(window.location.search);return{auth:e.get("vkbm_auth")||"",draft:j(e.get("draft")||"")}}catch(e){return{}}})(),[]),[we,Se]=(0,t.useState)(Ne.auth||""),[Le,Ce]=(0,t.useState)(""),[Pe,Ee]=(0,t.useState)(!1),[Me,Ue]=(0,t.useState)(""),[Ie,Re]=(0,t.useState)(!1),[Te,Be]=(0,t.useState)(""),[De,$e]=(0,t.useState)([]),[Fe,Ae]=(0,t.useState)(0),Oe=d?.meta?.timezone||"",ze=(0,t.useMemo)(()=>{var e,a,n,t,r,o,i;const s=Boolean(d?.menu_price_tax_included),l=""!==he.trim()?he:"",m=e=>s&&l?`${e}${l}`:e,c=null!==(e=null!==(a=p(d?.menu_price))&&void 0!==a?a:p(d?.menu_price_base))&&void 0!==e?e:p(null!==(n=null!==(t=null!==(r=u?.meta?.vkbm_base_price)&&void 0!==r?r:u?.meta?._vkbm_base_price)&&void 0!==t?t:u?._vkbm_base_price)&&void 0!==n?n:u?.price),_=""!==ye.trim()?ye:null,v="string"==typeof d?.menu_price_formatted&&""!==d.menu_price_formatted.trim()?d.menu_price_formatted:null!==c?m(y(c,_)):"",b=ue&&null!==(o=p(d?.nomination_fee))&&void 0!==o?o:0,k="string"==typeof d?.nomination_fee_formatted&&""!==d.nomination_fee_formatted.trim()?d.nomination_fee_formatted:m(y(b,_)),g=null!==(i=p(d?.total_price))&&void 0!==i?i:null!==c?c+b:null;return{baseLabel:v,nominationLabel:k,totalLabel:"string"==typeof d?.total_price_formatted&&""!==d.total_price_formatted.trim()?d.total_price_formatted:null!==g?m(y(g,_)):""}},[d,u,ue,he,ye]);(0,t.useEffect)(()=>{if(!c)return x((0,r.__)("The URL does not include a temporary reservation data parameter. Please try again from the reservation page.","vk-booking-manager")),void f(!1);f(!0),x(""),i()({path:`/vkbm/v1/drafts/${c}`}).then(e=>{_(e),C(e?.memo||"");const a=Boolean(e?.agree_terms);E(void 0!==e?.agree_cancellation_policy?Boolean(e?.agree_cancellation_policy):a),U(void 0!==e?.agree_terms_of_service?Boolean(e?.agree_terms_of_service):a)}).catch(e=>{x(e?.message||(0,r.__)("Couldn't load temporary reservation data. Please try again from the reservation page.","vk-booking-manager"))}).finally(()=>f(!1))},[c]),(0,t.useEffect)(()=>{let e=!0;return i()({path:"/vkbm/v1/provider-settings"}).then(a=>{e&&("string"==typeof a?.resource_label_singular&&""!==a.resource_label_singular.trim()?ke(a.resource_label_singular):ke((0,r.__)("Staff","vk-booking-manager")),ee("string"==typeof a?.cancellation_policy?a.cancellation_policy:""),ne("string"==typeof a?.terms_of_service?a.terms_of_service:""),re("string"==typeof a?.payment_method?a.payment_method:""),ie("string"==typeof a?.provider_name?a.provider_name:""),le("string"==typeof a?.provider_logo_url?a.provider_logo_url:""),ce(Boolean(a?.reservation_show_provider_logo)),_e(Boolean(a?.reservation_show_provider_name)),ve(!1!==a?.staff_enabled),pe("string"==typeof a?.tax_label_text?a.tax_label_text:""),xe("string"==typeof a?.currency_symbol?a.currency_symbol:""),s||"string"!=typeof a?.reservation_page_url||fe(a.reservation_page_url))}).catch(()=>{}),()=>{e=!1}},[s]),(0,t.useEffect)(()=>{d?.menu_id?i()({path:`/wp/v2/vkbm_service_menu/${d.menu_id}?_fields=id,title,meta`}).then(e=>v(e)).catch(()=>v(null)):v(null)},[d?.menu_id]),(0,t.useEffect)(()=>{d?.resource_id&&ue?i()({path:`/wp/v2/vkbm_resource/${d.resource_id}?_fields=id,title,meta`}).then(e=>k(e)).catch(()=>k(null)):k(null)},[d?.resource_id,ue]),(0,t.useEffect)(()=>{let e=!0;if(!je)return V(!1),q(""),Q(""),()=>{e=!1};if(m&&"object"==typeof m&&"string"==typeof m.logoutUrl&&"string"==typeof m.shiftDashboardUrl)return V(Boolean(m.canManageReservations)),q(m.logoutUrl||""),Q(m.shiftDashboardUrl||""),()=>{e=!1};const a=((e,a={})=>{const n=new URLSearchParams;return Object.entries(a).forEach(([e,a])=>{null!=a&&""!==a&&n.append(e,a)}),`${e}?${n.toString()}`})("/vkbm/v1/current-user",{redirect:He()||void 0});return i()({path:a}).then(a=>{e&&(V(Boolean(a?.can_manage_reservations)),q(a?.logout_url||""),Q(a?.shift_dashboard_url||""))}).catch(()=>{e&&(V(!1),q(""),Q(""))}),()=>{e=!1}},[je]),(0,t.useEffect)(()=>{W&&("profile"!==we&&"bookings"!==we||Se(""))},[W,we]),(0,t.useEffect)(()=>{W||(z(""),Y(""),J(""))},[W]);const He=()=>"undefined"==typeof window?"":window.location.href,Ye=e=>{if("undefined"==typeof window)return"";const a=new URL(window.location.href);return e?a.searchParams.set("vkbm_auth",e):a.searchParams.delete("vkbm_auth"),a.toString()},Ge=(0,t.useCallback)(e=>{if("undefined"==typeof window)return"";const a=ge||s||"",n=a?new URL(a,window.location.origin):new URL(window.location.href);return e?n.searchParams.set("vkbm_auth",e):n.searchParams.delete("vkbm_auth"),n.searchParams.delete("draft"),n.toString()},[ge,s]),Je=(0,t.useCallback)(e=>{const a=e===we?"":e;if(Se(a),"undefined"==typeof window)return;const n=new URL(window.location.href);a?n.searchParams.set("vkbm_auth",a):n.searchParams.delete("vkbm_auth"),window.history.replaceState(null,"",n.toString())},[we]),We=(0,t.useCallback)(()=>{const e=Ge("bookings");e?window.location.href=e:Je("bookings")},[Ge,Je]),Ve=(0,t.useCallback)(()=>{const e=Ge("profile");e?window.location.href=e:Je("profile")},[Ge,Je]),Xe=(0,t.useCallback)(()=>{const e=Ge("");e?window.location.href=e:Je("")},[Ge,Je]);(0,t.useEffect)(()=>{if(!we)return void Ce("");if("bookings"===we)return void Ce("");const e="profile"===we||"bookings"===we;if(e&&!je)return void Ce("");if(!e&&je)return void Ce("");Ee(!0),Ue(""),Ce("");const a=new URLSearchParams;a.set("type",we);const n=He();n&&a.set("redirect",n),"login"===we?a.set("register_url",Ye("register")):"register"===we&&a.set("login_url",Ye("login")),i()({path:`/vkbm/v1/auth-form?${a.toString()}`,cache:"no-store",credentials:"same-origin"}).then(e=>{const a=e?.html||"",n=e?.message||"";Ce(a),!a&&"register"===we&&n&&Ue(n)}).catch(e=>{Ue(e?.message||(0,r.__)("The form could not be displayed.","vk-booking-manager"))}).finally(()=>Ee(!1))},[we,je]);const qe=(0,t.useCallback)(e=>{const a=Number(e)||0;a&&!Fe&&("undefined"==typeof window||window.confirm((0,r.__)("Do you want to cancel this reservation?","vk-booking-manager")))&&(Ae(a),Be(""),i()({path:`/vkbm/v1/my-bookings/${a}/cancel`,method:"POST"}).then(()=>{$e(e=>Array.isArray(e)?e.filter(e=>Number(e?.id)!==a):[])}).catch(e=>{Be(e?.message||(0,r.__)("I was unable to cancel my reservation.","vk-booking-manager"))}).finally(()=>{Ae(0)}))},[Fe]);if((0,t.useEffect)(()=>{je&&we&&"profile"!==we&&"bookings"!==we&&Se(""),je||"profile"!==we&&"bookings"!==we||Se("")},[je,we]),(0,t.useEffect)(()=>{let e=!0;return je&&"bookings"===we?(Re(!0),Be(""),i()({path:"/vkbm/v1/my-bookings"}).then(a=>{e&&$e(Array.isArray(a)?a:[])}).catch(()=>{e&&($e([]),Be((0,r.__)("The reservation list could not be loaded.","vk-booking-manager")))}).finally(()=>{e&&Re(!1)}),()=>{e=!1}):()=>{e=!1}},[we,je]),(0,t.useEffect)(()=>{if(!D||e)return;if("undefined"==typeof window)return;const a=new URL(window.location.href);a.searchParams.has("draft")&&(a.searchParams.delete("draft"),window.history.replaceState(null,"",a.toString()))},[D,e]),g)return(0,l.jsx)("div",{className:"vkbm-confirm",children:(0,l.jsx)("div",{className:"vkbm-alert vkbm-alert__info",role:"status",children:(0,r.__)("Loading temporary reservation data...","vk-booking-manager")})});if(h)return(0,l.jsx)("div",{className:"vkbm-confirm",children:(0,l.jsx)("div",{className:"vkbm-alert vkbm-alert__danger",role:"alert",children:h})});if(!d)return null;const Ke="pending"===F?(0,r.__)("Your tentative reservation has been completed.","vk-booking-manager"):o,Qe=d.menu_label||u?.title?.rendered||u?.title||u?.name||String(d.menu_id),Ze=d.staff_label||d.slot?.staff_label||d.slot?.staff?.name||b?.title?.rendered||b?.title||b?.name||(0,r.__)("No preference","vk-booking-manager"),ea=X||((e="")=>{if("undefined"==typeof window)return"/wp-login.php?action=logout";const a="string"==typeof e&&""!==e.trim()?e:window.location.href;return`/wp-login.php?action=logout&redirect_to=${encodeURIComponent(a)}`})(ge||s),aa=D&&!e,na="string"==typeof Z&&""!==Z.trim(),ta="string"==typeof ae&&""!==ae.trim(),ra="string"==typeof te&&""!==te.trim()?te:"",oa=je&&!I&&(W||!na||P)&&(W||!ta||M),ia=w(d?.slot?.start_at||"",d?.slot?.service_end_at||d?.slot?.end_at||"",Oe),sa=me&&"string"==typeof se&&""!==se.trim(),la=de&&"string"==typeof oe&&""!==oe.trim(),ma=sa||la,ca="string"==typeof ge?ge.trim():"",da=la?oe:(0,r.__)("Logo image","vk-booking-manager");return(0,l.jsxs)("div",{className:"vkbm-confirm",children:[ma?(0,l.jsxs)("div",{className:"vkbm-reservation-layout__header",children:[ca?(0,l.jsxs)("a",{className:"vkbm-reservation-layout__brand vkbm-reservation-layout__brand-link",href:ca,children:[sa&&(0,l.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:se,alt:da,loading:"lazy"}),la&&(0,l.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:oe})]}):(0,l.jsxs)("div",{className:"vkbm-reservation-layout__brand",children:[sa&&(0,l.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:se,alt:da,loading:"lazy"}),la&&(0,l.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:oe})]}),je&&W&&(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:K||"",children:(0,r.__)("Shift/reservation table","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,r.__)("Log out","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!W&&aa&&(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,l.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:Xe,children:(0,r.__)("Return","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!W&&!aa&&(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,l.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","bookings"===we&&"is-active"].filter(Boolean).join(" "),onClick:We,"aria-pressed":"bookings"===we,children:(0,r.__)("Confirm reservation","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","profile"===we&&"is-active"].filter(Boolean).join(" "),onClick:Ve,"aria-pressed":"profile"===we,children:(0,r.__)("Edit user information","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,r.__)("Log out","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]})]}):(0,l.jsxs)(l.Fragment,{children:[je&&W&&(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:K||"",children:(0,r.__)("Shift/reservation table","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,r.__)("Log out","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!W&&aa&&(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,l.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:Xe,children:(0,r.__)("Return","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),je&&!W&&!aa&&(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),(0,l.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","bookings"===we&&"is-active"].filter(Boolean).join(" "),onClick:We,"aria-pressed":"bookings"===we,children:(0,r.__)("Confirm reservation","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("button",{type:"button",className:["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link","profile"===we&&"is-active"].filter(Boolean).join(" "),onClick:Ve,"aria-pressed":"profile"===we,children:(0,r.__)("Edit user information","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ea,children:(0,r.__)("Log out","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]})]}),je&&"profile"===we&&(0,l.jsxs)("div",{className:"vkbm-confirm__auth-panel",children:[Pe&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,r.__)("Loading form...","vk-booking-manager")}),Me&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-confirm__auth-error",role:"alert",children:Me}),Le&&(0,l.jsx)("div",{className:"vkbm-confirm__auth-form",dangerouslySetInnerHTML:{__html:Le}})]}),je&&"bookings"===we&&(0,l.jsxs)("div",{className:"vkbm-confirm__auth-panel",children:[Ie&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,r.__)("Loading...","vk-booking-manager")}),Te&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-confirm__auth-error",role:"alert",children:Te}),!Ie&&!Te&&0===De.length&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,r.__)("There are no reservations to display.","vk-booking-manager")}),De.length>0&&(0,l.jsx)("div",{className:"vkbm-confirm",children:De.map(e=>{const a=w(e?.start_at||"",e?.end_at||"",Oe),n="cancelled"===String(e?.status||"").trim().toLowerCase();return(0,l.jsxs)("div",{className:["vkbm-confirm__summary",n&&"vkbm-confirm__summary--cancelled"].filter(Boolean).join(" "),children:[(a.date||a.time)&&(0,l.jsxs)("div",{className:"vkbm-confirm__summary-title",children:[(0,l.jsxs)("div",{className:"vkbm-confirm__datetime","aria-label":(0,r.__)("Reservation date and time","vk-booking-manager"),children:[n&&(0,l.jsx)("span",{className:"vkbm-confirm__status vkbm-confirm__status--cancelled",children:(0,r.__)("Cancelled","vk-booking-manager")}),a.date&&(0,l.jsx)("span",{className:"vkbm-confirm__date",children:a.date}),a.time&&(0,l.jsxs)("span",{className:"vkbm-confirm__time",children:[a.date?" ":"",a.time]})]}),e?.can_cancel&&(0,l.jsx)("button",{type:"button",className:"vkbm-button vkbm-button__sm vkbm-button__secondary vkbm-confirm__cancel-button",onClick:()=>qe(e?.id),disabled:Fe===Number(e?.id),children:Fe===Number(e?.id)?(0,r.__)("Processing...","vk-booking-manager"):(0,r.__)("Cancelled","vk-booking-manager")})]}),(0,l.jsx)(N,{booking:e,resourceLabel:be,emptyValue:"—",currencySymbol:""!==ye.trim()?ye:null})]},e?.id||a.date)})})]}),"bookings"!==we&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"vkbm-confirm__summary",children:[(ia.date||ia.time)&&(0,l.jsx)("div",{className:"vkbm-confirm__summary-title",children:(0,l.jsxs)("div",{className:"vkbm-confirm__datetime","aria-label":(0,r.__)("Reservation date and time","vk-booking-manager"),children:[ia.date&&(0,l.jsx)("span",{className:"vkbm-confirm__date",children:ia.date}),ia.time&&(0,l.jsxs)("span",{className:"vkbm-confirm__time",children:[ia.date?" ":"",ia.time]})]})}),(0,l.jsx)(L,{label:(0,r.__)("Menu","vk-booking-manager"),value:Qe}),ue&&(0,l.jsx)(L,{label:be,value:Ze}),(0,l.jsx)(L,{label:(0,r.__)("Service basic fee","vk-booking-manager"),value:ze.baseLabel}),ue&&(0,l.jsx)(L,{label:(0,r.__)("Nomination fee","vk-booking-manager"),value:ze.nominationLabel||y(0,""!==ye.trim()?ye:null)}),(0,l.jsx)(L,{label:(0,r.__)("Total basic fee","vk-booking-manager"),value:ze.totalLabel||ze.baseLabel,valueClassName:"vkbm-confirm__summary-item-value--price"})]}),!W&&!Z&&!ae&&n&&(0,l.jsx)("p",{className:"vkbm-confirm__policy",children:n}),!je&&(0,l.jsxs)("div",{className:"vkbm-confirm__auth",children:[(0,l.jsx)("p",{className:"vkbm-confirm__auth-label",children:(0,r.__)("You must log in to confirm your reservation.","vk-booking-manager")}),(0,l.jsxs)("div",{className:"vkbm-buttons vkbm-buttons__center",children:[(0,l.jsx)("button",{type:"button",className:["vkbm-button","vkbm-button__sm","vkbm-button__primary","login"===we&&"is-active"].filter(Boolean).join(" "),onClick:()=>Je("login"),children:(0,r.__)("Log in","vk-booking-manager")}),(0,l.jsx)("button",{type:"button",className:["vkbm-button","vkbm-button__sm","vkbm-button-outline","vkbm-button-outline__primary","register"===we&&"is-active"].filter(Boolean).join(" "),onClick:()=>Je("register"),children:(0,r.__)("Sign up","vk-booking-manager")})]}),we&&(0,l.jsxs)("div",{className:"vkbm-confirm__auth-panel",children:[Pe&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-confirm__auth-loading",role:"status",children:(0,r.__)("Loading form...","vk-booking-manager")}),Me&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-confirm__auth-error",role:"alert",children:Me}),Le&&(0,l.jsx)("div",{className:"vkbm-confirm__auth-form",dangerouslySetInnerHTML:{__html:Le}})]})]}),(0,l.jsxs)("div",{className:"vkbm-confirm__form",children:[(0,l.jsx)("label",{htmlFor:"vkbm-confirm-memo",children:(0,r.__)("Requests/Notes","vk-booking-manager")}),(()=>{const e=(0,l.jsx)("textarea",{id:"vkbm-confirm-memo",value:S,onChange:e=>C(e.target.value),placeholder:(0,r.__)("Please enter any contact information","vk-booking-manager")});return aa?(0,l.jsx)("textarea",{id:"vkbm-confirm-memo",value:S,readOnly:!0,placeholder:(0,r.__)("No entry","vk-booking-manager")}):e})()]}),W&&(0,l.jsxs)("div",{className:"vkbm-confirm__admin-fields",children:[(0,l.jsxs)("div",{className:"vkbm-confirm__admin-field",children:[(0,l.jsx)("label",{htmlFor:"vkbm-confirm-customer-name",children:(0,r.__)("Reserved name","vk-booking-manager")}),(0,l.jsx)("input",{type:"text",id:"vkbm-confirm-customer-name",value:O,onChange:e=>z(e.target.value),placeholder:(0,r.__)("Please enter customer name.","vk-booking-manager")})]}),(0,l.jsxs)("div",{className:"vkbm-confirm__admin-field",children:[(0,l.jsx)("label",{htmlFor:"vkbm-confirm-customer-phone",children:(0,r.__)("Telephone number","vk-booking-manager")}),(0,l.jsx)("input",{type:"tel",id:"vkbm-confirm-customer-phone",value:H,onChange:e=>Y(e.target.value),placeholder:(0,r.__)("Please enter your contact phone number.","vk-booking-manager")})]}),(0,l.jsxs)("div",{className:"vkbm-confirm__admin-field",children:[(0,l.jsx)("label",{htmlFor:"vkbm-confirm-provider-note",children:(0,r.__)("Management memo","vk-booking-manager")}),(0,l.jsx)("textarea",{id:"vkbm-confirm-provider-note",value:G,onChange:e=>J(e.target.value),placeholder:(0,r.__)("Please enter any internal notes.","vk-booking-manager")})]})]}),(()=>{if(aa||W)return null;const e="string"==typeof Z&&""!==Z.trim()?Z:"",t="string"==typeof ae&&""!==ae.trim()?ae:"",o=Boolean(e||t||ra);return(0,l.jsxs)(l.Fragment,{children:[o&&(0,l.jsxs)("div",{className:"vkbm-agreements",children:[e&&(0,l.jsxs)("div",{className:"vkbm-agreement",children:[(0,l.jsx)("h3",{className:"vkbm-agreement__title",children:(0,r.__)("Cancellation policy","vk-booking-manager")}),(0,l.jsx)("div",{className:"vkbm-agreement__body vkbm-agreement__body--full",children:e}),(0,l.jsxs)("div",{className:"vkbm-agreement__check",children:[(0,l.jsx)("input",{type:"checkbox",checked:P,onChange:e=>E(e.target.checked),id:"vkbm-confirm-cancellation-policy"}),(0,l.jsx)("label",{htmlFor:"vkbm-confirm-cancellation-policy",children:(0,r.__)("I agree to the cancellation policy","vk-booking-manager")})]})]}),t&&(0,l.jsxs)("div",{className:"vkbm-agreement",children:[(0,l.jsx)("h3",{className:"vkbm-agreement__title",children:(0,r.__)("System Terms of Use","vk-booking-manager")}),(0,l.jsx)("div",{className:"vkbm-agreement__body vkbm-agreement__body--scroll",children:t}),(0,l.jsxs)("div",{className:"vkbm-agreement__check",children:[(0,l.jsx)("input",{type:"checkbox",checked:M,onChange:e=>U(e.target.checked),id:"vkbm-confirm-terms"}),(0,l.jsx)("label",{htmlFor:"vkbm-confirm-terms",children:a})]})]}),ra&&(0,l.jsxs)("div",{className:"vkbm-agreement",children:[(0,l.jsx)("h3",{className:"vkbm-agreement__title",children:(0,r.__)("Payment method","vk-booking-manager")}),(0,l.jsx)("div",{className:"vkbm-agreement__body",children:ra})]})]}),!t&&n&&(0,l.jsx)("p",{className:"vkbm-confirm__policy",children:n})]})})(),(0,l.jsxs)("div",{className:"vkbm-confirm__actions",children:[!D&&(0,l.jsx)("button",{type:"button",className:"vkbm-confirm__button vkbm-button vkbm-button__md vkbm-button__primary",onClick:()=>{if(!c)return;const a="string"==typeof Z&&""!==Z.trim()?Z:"",n="string"==typeof ae&&""!==ae.trim()?ae:"",t=!W;if(t&&a&&!P)return void B((0,r.__)("You must agree to the cancellation policy.","vk-booking-manager"));if(t&&n&&!M)return void B((0,r.__)("You must agree to the terms of use.","vk-booking-manager"));const o=!t||(!a||P)&&(!n||M);R(!0),B("");const s={token:c,memo:S,agree_terms:o,agree_cancellation_policy:!t||P,agree_terms_of_service:!t||M};W&&(s.customer_name=O,s.customer_phone=H,s.internal_note=G),i()({path:"/vkbm/v1/bookings",method:"POST",data:s,parse:!1}).then(async a=>{const n=await a.text();let t;try{t=(e=>{const a=new Error((0,r.__)("The response is not a valid JSON response.","vk-booking-manager"));if("string"!=typeof e)throw a;const n=e.trim();if(!n)throw a;try{return JSON.parse(n)}catch(e){let t=n.indexOf("{"),r=n.lastIndexOf("}");if((-1===t||-1===r||r<t)&&(t=n.indexOf("["),r=n.lastIndexOf("]")),-1===t||-1===r||r<t)throw a;try{return JSON.parse(n.slice(t,r+1))}catch(e){throw a}}})(n)}catch(e){t=null}if(!a.ok){const e=(0,r.__)("A reservation for the same date and time already exists. Please change the date and time.","vk-booking-manager"),o="string"==typeof n&&(n.includes("booking_time_conflict")||n.includes("A reservation for the same date and time already exists.")),i=(409===a?.status||"booking_time_conflict"===t?.code||o?e:t?.message)||(t?.code?`${t.code} (HTTP ${a.status})`:`HTTP ${a.status}`)||(0,r.__)("Confirmation of reservation failed. Please try again later.","vk-booking-manager");throw new Error(i)}if(A(t?.status||""),$(!0),e){const a=new URL(e,"undefined"!=typeof window?window.location.origin:void 0);t?.booking_id&&a.searchParams.set("booking_id",String(t.booking_id)),window.location.href=a.toString()}}).catch(e=>{const a=(0,r.__)("A reservation for the same date and time already exists. Please change the date and time.","vk-booking-manager"),n="string"==typeof e?.message?e.message:"",t=e?.data?.status||e?.status,o="booking_time_conflict"===e?.code||409===t||n.includes("A reservation for the same date and time already exists.");B((o?a:n)||(0,r.__)("Confirmation of reservation failed. Please try again later.","vk-booking-manager"))}).finally(()=>R(!1))},disabled:!oa,children:I?(0,r.__)("Processing...","vk-booking-manager"):(0,r.__)("Reserve with this content","vk-booking-manager")}),aa&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__success text-center",role:"status",children:Ke}),T&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger",role:"alert",children:T})]})]})]})},P=(e,a)=>{const n=new URLSearchParams;return Object.entries(a).forEach(([e,a])=>{null!=a&&""!==a&&n.append(e,a)}),`${e}?${n.toString()}`},E="vkbm_draft_token",M=()=>{if("undefined"==typeof document)return"";const e=document.cookie.match(new RegExp(`(?:^|; )${E}=([^;]*)`));return j(e?decodeURIComponent(e[1]):"")},U=(e,a)=>{(0,t.useEffect)(()=>{if(!e)return a([]),()=>{};let n=!0;return i()({path:e}).then(e=>{n&&a(e||[])}).catch(()=>{n&&a([])}),()=>{n=!1}},[e,a])},I=()=>"undefined"==typeof window?"":window.location.href,R=(e="")=>{if("undefined"==typeof window)return"/wp-login.php?action=logout";const a="string"==typeof e&&""!==e.trim()?e:window.location.href;return`/wp-login.php?action=logout&redirect_to=${encodeURIComponent(a)}`},T=e=>{if("undefined"==typeof window)return"";const a=new URL(window.location.href);return e?a.searchParams.set("vkbm_auth",e):a.searchParams.delete("vkbm_auth"),a.toString()},B=({defaultMenuId:e=0,defaultStaffId:a=0,allowStaffSelection:n=!0,isEditor:o=!1})=>{var m,c,d;const _=(0,t.useMemo)(()=>"undefined"==typeof window?null:window.vkbmCurrentUserBootstrap||null,[]),u=(0,t.useMemo)(()=>(()=>{if("undefined"==typeof window)return{};try{const e=new URLSearchParams(window.location.search);return{menuId:Number(e.get("menu_id"))||0,staffId:Number(e.get("resource_id"))||0,date:e.get("date")||"",auth:e.get("vkbm_auth")||"",draft:j(e.get("draft")||"")}}catch(e){return{}}})(),[]),b=u.menuId||e||0,g=u.staffId||a||0,f=u.date||"",x=f?new Date(f):new Date,[w,S]=(0,t.useState)(b),[L,B]=(0,t.useState)(g),[$,F]=(0,t.useState)(f),[A,O]=(0,t.useState)(null),[z,H]=(0,t.useState)({year:x.getFullYear(),month:x.getMonth()+1}),[Y,G]=(0,t.useState)([]),[J,W]=(0,t.useState)([]),[V,X]=(0,t.useState)({taxEnabled:!1,taxRate:0,taxLabelText:"",reservationPageUrl:"",showMenuList:!0,staffEnabled:!1,defaultStaffId:0,resourceLabelSingular:(0,r.__)("Staff","vk-booking-manager"),resourceLabelPlural:(0,r.__)("Staff","vk-booking-manager"),showProviderLogo:!1,showProviderName:!1,providerName:"",providerLogoUrl:""}),[q,K]=(0,t.useState)({html:"",isLoading:!0,error:""}),[Q,Z]=(0,t.useState)(""),[ee,ae]=(0,t.useState)(!1),[ne,te]=(0,t.useState)(""),[re,oe]=(0,t.useState)(u.auth||""),[ie,se]=(0,t.useState)(_?.logoutUrl||""),[le,me]=(0,t.useState)(_?.shiftDashboardUrl||""),[ce,de]=(0,t.useState)(Boolean(_?.canManageReservations)),_e=Boolean(_?.canViewPrivateMenus),[ue,ve]=(0,t.useState)(!1),[be,ke]=(0,t.useState)(""),[ge,fe]=(0,t.useState)([]),[he,pe]=(0,t.useState)(0),ye="undefined"!=typeof document&&document.body.classList.contains("logged-in"),xe=u.draft||"",je=e=>{"undefined"!=typeof window&&oe(a=>{const n=a===e?"":e,t=new URL(window.location.href);return n?t.searchParams.set("vkbm_auth",n):t.searchParams.delete("vkbm_auth"),window.history.replaceState(null,"",t.toString()),n})},[Ne,we]=(0,t.useState)(null),[Se,Le]=(0,t.useState)(!1),[Ce,Pe]=(0,t.useState)(null),[Ee,Me]=(0,t.useState)([]),[Ue,Ie]=(0,t.useState)(!1),[Re,Te]=(0,t.useState)(null),[Be,De]=(0,t.useState)(!1),[$e,Fe]=(0,t.useState)(""),[Ae,Oe]=(0,t.useState)({html:"",isLoading:!1,error:""}),ze=(0,t.useRef)(null),He=(0,t.useRef)(null),[Ye,Ge]=(0,t.useState)(!1),Je=n&&V.staffEnabled;(0,t.useEffect)(()=>{let e=!0;return i()({path:"/vkbm/v1/provider-settings"}).then(a=>{e&&X({taxEnabled:Boolean(a?.tax_enabled),taxRate:Number(a?.tax_rate)||0,taxLabelText:"string"==typeof a?.tax_label_text?a.tax_label_text:"",currencySymbol:"string"==typeof a?.currency_symbol?a.currency_symbol:"",reservationPageUrl:a?.reservation_page_url||"",showMenuList:!1!==a?.reservation_show_menu_list,staffEnabled:Boolean(a?.staff_enabled),defaultStaffId:Number(a?.default_staff_id)||0,showProviderLogo:Boolean(a?.reservation_show_provider_logo),showProviderName:Boolean(a?.reservation_show_provider_name),resourceLabelSingular:"string"==typeof a?.resource_label_singular&&""!==a.resource_label_singular.trim()?a.resource_label_singular:(0,r.__)("Staff","vk-booking-manager"),resourceLabelPlural:"string"==typeof a?.resource_label_plural&&""!==a.resource_label_plural.trim()?a.resource_label_plural:"string"==typeof a?.resource_label_singular&&""!==a.resource_label_singular.trim()?a.resource_label_singular:(0,r.__)("Staff","vk-booking-manager"),providerName:"string"==typeof a?.provider_name?a.provider_name:"",providerLogoUrl:"string"==typeof a?.provider_logo_url?a.provider_logo_url:""})}).catch(()=>{}).finally(()=>{e&&Ge(!0)}),()=>{e=!1}},[]),(0,t.useEffect)(()=>{Ye&&(V.staffEnabled||(V.defaultStaffId>0&&L!==V.defaultStaffId?B(V.defaultStaffId):0===V.defaultStaffId&&0!==L&&B(0)))},[Ye,V.staffEnabled,V.defaultStaffId,L]),(0,t.useEffect)(()=>{let e=!0;return Ye?!V.showMenuList||w?(K({html:"",isLoading:!1,error:""}),()=>{e=!1}):(K({html:"",isLoading:!0,error:""}),i()({path:"/vkbm/v1/menu-loop"}).then(a=>{e&&K({html:a?.html||"",isLoading:!1,error:""})}).catch(a=>{e&&K({html:"",isLoading:!1,error:a?.message||(0,r.__)("Could not get menu list.","vk-booking-manager")})}),()=>{e=!1}):()=>{e=!1}},[Ye,V.showMenuList,w]),(0,t.useEffect)(()=>{let e=!0;if(!ye)return se(""),me(""),de(!1),()=>{e=!1};if(_&&"object"==typeof _&&"string"==typeof _.logoutUrl&&"string"==typeof _.shiftDashboardUrl)return se(_.logoutUrl||""),me(_.shiftDashboardUrl||""),de(Boolean(_.canManageReservations)),()=>{e=!1};const a=I(),n=P("/vkbm/v1/current-user",{redirect:a||void 0});return i()({path:n}).then(a=>{e&&(se(a?.logout_url||""),me(a?.shift_dashboard_url||""),de(Boolean(a?.can_manage_reservations)))}).catch(()=>{e&&(se(""),me(""),de(!1))}),()=>{e=!1}},[ye]),(0,t.useEffect)(()=>{ce&&("profile"!==re&&"bookings"!==re||oe(""))},[ce,re]),(0,t.useEffect)(()=>{if(!re)return void Z("");if("bookings"===re)return void Z("");const e="profile"===re||"bookings"===re;if(e&&!ye)return void Z("");if(!e&&ye)return void Z("");ae(!0),te(""),Z("");const a=new URLSearchParams;a.set("type",re);const n=I();n&&a.set("redirect",n),"login"===re?a.set("register_url",T("register")):"register"===re&&a.set("login_url",T("login")),i()({path:`/vkbm/v1/auth-form?${a.toString()}`,cache:"no-store",credentials:"same-origin"}).then(e=>{const a=e?.html||"",n=e?.message||"";Z(a),!a&&"register"===re&&n&&te(n)}).catch(e=>{te(e?.message||(0,r.__)("The form could not be displayed.","vk-booking-manager"))}).finally(()=>{ae(!1)})},[re,ye]);const We=(0,t.useCallback)(e=>{const a=Number(e)||0;a&&!he&&("undefined"==typeof window||window.confirm((0,r.__)("Do you want to cancel this reservation?","vk-booking-manager")))&&(pe(a),ke(""),i()({path:`/vkbm/v1/my-bookings/${a}/cancel`,method:"POST"}).then(()=>{fe(e=>Array.isArray(e)?e.filter(e=>Number(e?.id)!==a):[])}).catch(e=>{ke(e?.message||(0,r.__)("I was unable to cancel my reservation.","vk-booking-manager"))}).finally(()=>{pe(0)}))},[he]);(0,t.useEffect)(()=>{ye&&re&&"profile"!==re&&"bookings"!==re&&oe(""),ye||"profile"!==re&&"bookings"!==re||oe("")},[ye,re]),(0,t.useEffect)(()=>{let e=!0;return ye&&"bookings"===re?(ve(!0),ke(""),i()({path:"/vkbm/v1/my-bookings"}).then(a=>{e&&fe(Array.isArray(a)?a:[])}).catch(()=>{e&&(fe([]),ke((0,r.__)("The reservation list could not be loaded.","vk-booking-manager")))}).finally(()=>{e&&ve(!1)}),()=>{e=!1}):()=>{e=!1}},[re,ye]);const Ve=(0,t.useMemo)(()=>Y.find(e=>e.id===w),[Y,w]),Xe=(0,t.useMemo)(()=>J.find(e=>e.id===L),[J,L]),qe=(0,t.useMemo)(()=>{const e=Ve?.meta;if(!e)return[];const a=(Array.isArray(e._vkbm_staff_ids)&&e._vkbm_staff_ids.length?e._vkbm_staff_ids:Array.isArray(e.vkbm_staff_ids)&&e.vkbm_staff_ids.length?e.vkbm_staff_ids:[]).map(e=>"number"==typeof e?e:"string"==typeof e&&Number(e)||0).filter(e=>e>0);return Array.from(new Set(a))},[Ve]),Ke=(0,t.useMemo)(()=>{if(!V.staffEnabled)return J;if(0===qe.length)return J;const e=new Set(qe);return J.filter(a=>e.has(a.id))},[qe,J,V.staffEnabled]),Qe=1===qe.length;(0,t.useEffect)(()=>{if(V.staffEnabled&&w&&0!==qe.length){if(1===qe.length){const e=qe[0];return void(L!==e&&B(e))}L&&!qe.includes(L)&&B(0)}},[w,qe,L,V.staffEnabled]);const Ze=(0,t.useMemo)(()=>{var e,a,n;const t=Ve?.meta;if(!t)return!1;const r=null!==(e=null!==(a=null!==(n=t._vkbm_disable_nomination_fee)&&void 0!==n?n:t.vkbm_disable_nomination_fee)&&void 0!==a?a:Ve?._vkbm_disable_nomination_fee)&&void 0!==e?e:Ve?.vkbm_disable_nomination_fee;if(null==r)return!1;if("boolean"==typeof r)return r;const o=String(r).toLowerCase().trim();return"1"===o||"true"===o},[Ve]),ea=ye&&"profile"===re,aa=("profile"===re||"bookings"===re)&&ye||!ye&&("login"===re||"register"===re),na=!aa,ta=Boolean(w),ra=e=>["vkbm-user-actions__link","vkbm-button","vkbm-button__sm","vkbm-button__link","vkbm-reservation-layout__nav-link",e&&re===e&&"is-active"].filter(Boolean).join(" "),oa=(0,t.useCallback)(e=>{const a=p(e);return null===a?null:a},[V]),ia=(0,t.useMemo)(()=>(e=>{if(!e)return null;const a=[e?.meta?.vkbm_base_price,e?.meta?._vkbm_base_price,e?._vkbm_base_price,e?.price];for(const e of a){const a=p(e);if(null!==a)return a}return null})(Ve),[Ve]),sa=(0,t.useMemo)(()=>null===ia?null:oa(ia),[oa,ia]),la=(0,t.useMemo)(()=>{var e,a,n;if(!V.staffEnabled)return 0;if(!L)return null;if(Ze)return 0;const t=null!==(e=null!==(a=null!==(n=Xe?.meta?.vkbm_nomination_fee)&&void 0!==n?n:Xe?.meta?._vkbm_nomination_fee)&&void 0!==a?a:Xe?._vkbm_nomination_fee)&&void 0!==e?e:Xe?.nomination_fee,r=p(t);return null===r?0:r},[Xe,L,Ze,V.staffEnabled]),ma=(0,t.useMemo)(()=>null===la?null:oa(la),[oa,la]),ca=(0,t.useMemo)(()=>null===sa?null:sa+(null===ma?0:ma),[sa,ma]),da=(0,t.useMemo)(()=>{if(!Ye)return[];const e=V.taxEnabled&&V.taxLabelText&&""!==V.taxLabelText.trim()?V.taxLabelText:"",a=a=>({value:a,taxLabel:"—"!==a?e:""}),n=V.currencySymbol||null,t=[{key:"base",label:(0,r.__)("Service basic fee","vk-booking-manager"),...a(null!==sa?y(sa,n):"—")},{key:"total",label:(0,r.__)("Total basic fee","vk-booking-manager"),...a(null!==ca?y(ca,n):"—"),highlight:!0}];return V.staffEnabled&&t.splice(1,0,{key:"nomination",label:(0,r.__)("Nomination fee","vk-booking-manager"),value:null===ma?L?y(oa(0),n):"—":y(ma,n),taxLabel:""}),t},[sa,ma,ca,V,Ye]),_a=(0,t.useMemo)(()=>P("/wp/v2/vkbm_service_menu",{per_page:100,_fields:"id,title,meta,menu_order,vkbm_menu_group",status:_e?"publish,private":void 0}),[_e]);U(_a,G),(0,t.useEffect)(()=>{let e=!0;return w?(Oe({html:"",isLoading:!0,error:""}),i()({path:`/vkbm/v1/menu-preview/${w}`}).then(a=>{e&&Oe({html:a?.html||"",isLoading:!1,error:""})}).catch(a=>{e&&Oe({html:"",isLoading:!1,error:a?.message||(0,r.__)("Failed to retrieve menu information.","vk-booking-manager")})}),()=>{e=!1}):(Oe({html:"",isLoading:!1,error:""}),()=>{e=!1})},[w]);const ua=(0,t.useMemo)(()=>Ye&&V.staffEnabled?"/wp/v2/vkbm_resource?per_page=100&_fields=id,title,meta,nomination_fee":"",[Ye,V.staffEnabled]);U(ua,W);const va=(0,t.useMemo)(()=>Ne?.days?Ne.days.reduce((e,a)=>(e[a.date]=a,e),{}):{},[Ne]),ba=(0,t.useCallback)(()=>{if(!w||!z.year||!z.month)return void we(null);Le(!0),Pe(null);const e=P("/vkbm/v1/calendar-meta",{menu_id:w,resource_id:L||void 0,year:z.year,month:z.month});i()({path:e}).then(e=>{we(e)}).catch(e=>{Pe(e?.message||(0,r.__)("Failed to load calendar.","vk-booking-manager"))}).finally(()=>{Le(!1)})},[w,L,z]);(0,t.useEffect)(()=>{ba()},[ba]),(0,t.useEffect)(()=>{if(!w||!$)return void Me([]);Ie(!0),Te(null);const e=P("/vkbm/v1/availabilities",{menu_id:w,resource_id:L||void 0,date:$});i()({path:e}).then(e=>{var a,n,t;const o=Array.isArray(e?.slots)?e.slots:[],i=L&&null!==(a=null!==(n=null!==(t=Xe?.title?.rendered)&&void 0!==t?t:Xe?.title)&&void 0!==n?n:Xe?.name)&&void 0!==a?a:"",s=o.map(e=>{const a=e.staff_label||e.staff?.name||i||(0,r.__)("No preference","vk-booking-manager");return{...e,staff_label:i||a,staff:e.staff||(i?{id:L,name:i}:null)}});Me(s)}).catch(e=>{Te(e?.message||(0,r.__)("Failed to read free space.","vk-booking-manager"))}).finally(()=>{Ie(!1)})},[w,L,$,Xe]),(0,t.useEffect)(()=>{Fe("")},[A,w,L]),(0,t.useEffect)(()=>{A&&He.current&&He.current.scrollIntoView({behavior:"smooth",block:"start"})},[A]);const ka=e=>{const a=Y.find(a=>a.id===e),n=a?.meta;if(V.staffEnabled){const e=Array.isArray(n?._vkbm_staff_ids)&&n._vkbm_staff_ids.length?n._vkbm_staff_ids:Array.isArray(n?.vkbm_staff_ids)&&n.vkbm_staff_ids.length?n.vkbm_staff_ids:[],a=Array.from(new Set(e.map(e=>"number"==typeof e?e:"string"==typeof e&&Number(e)||0).filter(e=>e>0)));1===a.length?B(a[0]):L&&!a.includes(L)&&B(0)}else Ye&&V.defaultStaffId>0?B(V.defaultStaffId):Ye&&B(0);S(e),F(""),O(null),H({year:(new Date).getFullYear(),month:(new Date).getMonth()+1})},ga=(0,t.useCallback)(e=>{const a=e.target;if(!a||"function"!=typeof a.closest)return;if(!a.closest("a.vkbm-menu-loop__button--reserve"))return;e.preventDefault();const n=a.closest(".vkbm-menu-loop__item");if(!n)return;const t=n.getAttribute("data-menu-id")||"",r=Number(t)||0;if(!r)return;ka(r);const o=ze.current?.closest?.(".vkbm-reservation-block"),i=o||ze.current;i&&i.scrollIntoView({behavior:"smooth",block:"start"})},[ka]),fa=Boolean(w&&A),ha=(0,t.useCallback)(()=>{var e,a,n,t,s,l,m,c,d;if(o)return void Fe((0,r.__)("The editor does not transition to the confirmation page.","vk-booking-manager"));if(!A||!w)return void Fe((0,r.__)("Please select your menu and reservation slot before proceeding.","vk-booking-manager"));De(!0),Fe("");const _={token:M(),menu_id:w,resource_id:L||0,menu_label:null!==(e=null!==(a=null!==(n=Ve?.title?.rendered)&&void 0!==n?n:Ve?.title)&&void 0!==a?a:Ve?.name)&&void 0!==e?e:"",staff_label:L?null!==(t=null!==(s=null!==(l=Xe?.title?.rendered)&&void 0!==l?l:Xe?.title)&&void 0!==s?s:Xe?.name)&&void 0!==t?t:"":(0,r.__)("No preference","vk-booking-manager"),is_staff_preferred:Boolean(L),date:$,slot:{slot_id:A.slot_id,start_at:A.start_at,end_at:A.end_at,service_end_at:A.service_end_at||A.end_at,duration_minutes:A.duration_minutes||0,staff_label:A.staff_label||(L?null!==(m=null!==(c=null!==(d=Xe?.title?.rendered)&&void 0!==d?d:Xe?.title)&&void 0!==c?c:Xe?.name)&&void 0!==m?m:"":(0,r.__)("No preference","vk-booking-manager")),staff:A.staff?{id:A.staff.id,name:A.staff.name||A.staff.title||""}:null,assignable_staff_ids:Array.isArray(A.assignable_staff_ids)?A.assignable_staff_ids.map(e=>Number(e)||0).filter(Boolean):[],auto_assign:Boolean(A.auto_assign||!L&&!A.staff&&(!A.assignable_staff_ids||A.assignable_staff_ids.length>0))},meta:{timezone:Ne?.meta?.timezone||""}};i()({path:"/vkbm/v1/drafts",method:"POST",data:_}).then(e=>{const a=j(e?.token),n=e?.expires_in||1800;if(!a)throw new Error((0,r.__)("Temporary reservation data save failed.","vk-booking-manager"));if(((e,a=1800)=>{if("undefined"==typeof document)return;const n=j(e);if(!n)return;let t=`${E}=${encodeURIComponent(n)}; path=/; max-age=${a}; SameSite=Lax`;"undefined"!=typeof window&&"https:"===window.location?.protocol&&(t+="; Secure"),document.cookie=t})(a,n),"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.delete("vkbm_auth"),e.searchParams.set("draft",a),window.location.href=e.toString()}}).catch(e=>{Fe(e?.message||(0,r.__)("Failed to save reservation details. Please try again later.","vk-booking-manager"))}).finally(()=>{De(!1)})},[Ne?.meta?.timezone,Ve,Xe,o,w,$,A,L]),pa=V.showProviderLogo&&"string"==typeof V.providerLogoUrl&&""!==V.providerLogoUrl.trim(),ya=V.showProviderName&&"string"==typeof V.providerName&&""!==V.providerName.trim(),xa=pa||ya,ja=("string"==typeof V.reservationPageUrl?V.reservationPageUrl:"").trim(),Na=ya?V.providerName:(0,r.__)("Logo image","vk-booking-manager");return xe?(0,l.jsx)("div",{className:"vkbm-reservation vkbm-reservation--confirm",children:(0,l.jsx)(C,{redirectUrl:"",termsLabel:(0,r.__)("I agree to the terms of use","vk-booking-manager"),policyText:(0,r.__)("Please check our cancellation policy before booking.","vk-booking-manager"),successMessage:(0,r.__)("Your reservation has been completed.","vk-booking-manager")})}):(0,l.jsxs)("div",{className:"vkbm-reservation-layout",ref:ze,children:[xa?(0,l.jsxs)("div",{className:"vkbm-reservation-layout__header",children:[ja?(0,l.jsxs)("a",{className:"vkbm-reservation-layout__brand vkbm-reservation-layout__brand-link",href:ja,children:[pa&&(0,l.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:V.providerLogoUrl,alt:Na,loading:"lazy"}),ya&&(0,l.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:V.providerName})]}):(0,l.jsxs)("div",{className:"vkbm-reservation-layout__brand",children:[pa&&(0,l.jsx)("img",{className:"vkbm-reservation-layout__brand-logo",src:V.providerLogoUrl,alt:Na,loading:"lazy"}),ya&&(0,l.jsx)("span",{className:"vkbm-reservation-layout__brand-name",children:V.providerName})]}),(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),aa?(0,l.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:()=>je(re||""),children:(0,r.__)("Return","vk-booking-manager")}):ye&&ce?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:le||"",children:(0,r.__)("Shift/reservation table","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||R(V.reservationPageUrl),children:(0,r.__)("Log out","vk-booking-manager")})]}):ye?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{type:"button",className:ra("bookings"),onClick:()=>je("bookings"),"aria-pressed":"bookings"===re,children:(0,r.__)("Confirm reservation","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("button",{type:"button",className:ra("profile"),onClick:()=>je("profile"),"aria-pressed":ea,children:(0,r.__)("Edit user information","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||R(V.reservationPageUrl),children:(0,r.__)("Log out","vk-booking-manager")})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{type:"button",className:ra("login"),onClick:()=>je("login"),"aria-pressed":"login"===re,children:(0,r.__)("Log in","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("button",{type:"button",className:ra("register"),onClick:()=>je("register"),"aria-pressed":"register"===re,children:(0,r.__)("Sign up","vk-booking-manager")})]}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]})]}):(0,l.jsxs)("div",{className:"vkbm-user-actions vkbm-reservation-layout__nav",role:"navigation","aria-label":(0,r.__)("Reservation block navigation","vk-booking-manager"),children:[(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"["}),aa?(0,l.jsx)("button",{type:"button",className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",onClick:()=>je(re||""),children:(0,r.__)("return","vk-booking-manager")}):ye&&ce?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:le||"",children:(0,r.__)("Shift/reservation table","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||R(V.reservationPageUrl),children:(0,r.__)("Log out","vk-booking-manager")})]}):ye?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{type:"button",className:ra("bookings"),onClick:()=>je("bookings"),"aria-pressed":"bookings"===re,children:(0,r.__)("Confirm reservation","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("button",{type:"button",className:ra("profile"),onClick:()=>je("profile"),"aria-pressed":ea,children:(0,r.__)("Edit user information","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("a",{className:"vkbm-user-actions__link vkbm-button vkbm-button__sm vkbm-button__link vkbm-reservation-layout__nav-link",href:ie||R(V.reservationPageUrl),children:(0,r.__)("Log out","vk-booking-manager")})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{type:"button",className:ra("login"),onClick:()=>je("login"),"aria-pressed":"login"===re,children:(0,r.__)("Log in","vk-booking-manager")}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-divider","aria-hidden":"true",children:"|"}),(0,l.jsx)("button",{type:"button",className:ra("register"),onClick:()=>je("register"),"aria-pressed":"register"===re,children:(0,r.__)("Sign up","vk-booking-manager")})]}),(0,l.jsx)("span",{className:"vkbm-reservation-layout__nav-bracket","aria-hidden":"true",children:"]"})]}),aa&&(0,l.jsx)("section",{className:"vkbm-user-section","aria-live":"polite",children:(0,l.jsxs)("div",{className:"vkbm-user-section__panel vkbm-reservation__auth-panel",children:["bookings"===re&&ue&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-reservation__auth-loading",role:"status",children:(0,r.__)("Loading...","vk-booking-manager")}),"bookings"===re&&be&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-reservation__auth-error",role:"alert",children:be}),"bookings"===re&&!ue&&!be&&0===ge.length&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-reservation__auth-loading",role:"status",children:(0,r.__)("There are no reservations to display.","vk-booking-manager")}),"bookings"===re&&ge.length>0&&(0,l.jsx)("div",{className:"vkbm-confirm",children:ge.map(e=>{const a=((e,a)=>{if(!e)return{date:"",time:""};let n;try{n="function"==typeof s.__experimentalGetSettings?(0,s.__experimentalGetSettings)():void 0}catch(e){n=void 0}const t=n?.formats?.date||"Y/m/d",r=n?.formats?.time||"H:i",o=n?.timezone?.string,i=new Date(e);if(Number.isNaN(i.getTime()))return{date:e,time:""};const l=(0,s.dateI18n)(t,i,o),m=(0,s.dateI18n)("D",i,o),c=(0,s.dateI18n)(r,i,o);let d=c;if(a){const e=new Date(a);Number.isNaN(e.getTime())||(d=`${c} - ${(0,s.dateI18n)(r,e,o)}`.trim())}return{date:`${l}(${m})`,time:d}})(e?.start_at,e?.end_at),n=String(e?.status||"").trim(),t="pending"===n.toLowerCase(),o="cancelled"===n.toLowerCase();return(0,l.jsxs)("div",{className:["vkbm-confirm__summary",o&&"vkbm-confirm__summary--cancelled"].filter(Boolean).join(" "),children:[(a.date||a.time)&&(0,l.jsxs)("div",{className:"vkbm-confirm__summary-title",children:[(0,l.jsxs)("div",{className:"vkbm-confirm__datetime",children:[t&&(0,l.jsx)("span",{className:"vkbm-confirm__status vkbm-confirm__status--pending",children:(0,r.__)("Pending","vk-booking-manager")}),o&&(0,l.jsx)("span",{className:"vkbm-confirm__status vkbm-confirm__status--cancelled",children:(0,r.__)("Cancelled","vk-booking-manager")}),a.date&&(0,l.jsx)("span",{className:"vkbm-confirm__date",children:a.date}),a.time&&(0,l.jsxs)("span",{className:"vkbm-confirm__time",children:[a.date?" ":"",a.time]})]}),e?.can_cancel&&(0,l.jsx)("button",{type:"button",className:"vkbm-button vkbm-button__sm vkbm-button__secondary vkbm-confirm__cancel-button",onClick:()=>We(e?.id),disabled:he===Number(e?.id),children:he===Number(e?.id)?(0,r.__)("Processing...","vk-booking-manager"):(0,r.__)("Cancelled","vk-booking-manager")})]}),(0,l.jsx)(N,{booking:e,resourceLabel:V.resourceLabelSingular,currencySymbol:V.currencySymbol||null})]},e?.id||datetimeLabel)})}),"bookings"!==re&&ee&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info vkbm-reservation__auth-loading",role:"status",children:(0,r.__)("Loading form...","vk-booking-manager")}),"bookings"!==re&&ne&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger vkbm-reservation__auth-error",role:"alert",children:ne}),"bookings"!==re&&Q&&(0,l.jsx)("div",{className:"vkbm-reservation__auth-form",dangerouslySetInnerHTML:{__html:Q}})]})}),na&&(0,l.jsxs)("div",{className:["vkbm-reservation",o&&"vkbm-reservation--is-editor"].filter(Boolean).join(" "),children:[Ye?V.showMenuList&&!w?(0,l.jsxs)("section",{className:"vkbm-reservation__menu-list","aria-live":"polite",children:[q.isLoading&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info",role:"status",children:(0,r.__)("Loading service menu...","vk-booking-manager")}),q.error&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__danger",role:"alert",children:q.error}),Ye&&!q.isLoading&&!q.error&&!q.html&&(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__warning",role:"status",children:(0,r.__)("There are no service menus to display.","vk-booking-manager")}),q.html&&(0,l.jsx)("div",{className:"vkbm-reservation__menu-loop",onClick:ga,dangerouslySetInnerHTML:{__html:q.html}})]}):(0,l.jsx)(h,{menuId:w,staffId:L,menus:Y,staffOptions:Ke,onMenuChange:ka,onStaffChange:e=>{B(e),O(null)},allowStaffSelection:Je,showStaffField:V.staffEnabled,lockStaffSelection:Qe,pricingRows:da,menuPreviewLoading:Ae.isLoading,menuPreviewError:Ae.error,menuPreviewHtml:Ae.html,resourceLabelSingular:V.resourceLabelSingular}):(0,l.jsx)("p",{className:"vkbm-alert vkbm-alert__info",role:"status",children:(0,r.__)("Loading...","vk-booking-manager")}),ta&&(0,l.jsxs)("div",{className:"vkbm-reservation__body",children:[(0,l.jsx)(v,{year:z.year,month:z.month,dayMetaMap:va,selectedDate:$,onSelectDate:e=>{w&&(F(e),O(null))},onMonthChange:e=>{H(a=>{const n=a.month+e,t=new Date(a.year,n-1,1);return{year:t.getFullYear(),month:t.getMonth()+1}})},isLoading:Se,locale:_?.locale}),(0,l.jsx)("div",{className:"vkbm-reservation__slots",children:(0,l.jsx)(k,{slots:Ee,selectedDate:$,onSelectSlot:e=>O(e),selectedSlotId:A?.slot_id,isLoading:Ue,error:Ce||Re,showStaffLabel:V.staffEnabled,selectedStaffLabel:L&&null!==(m=null!==(c=null!==(d=Xe?.title?.rendered)&&void 0!==d?d:Xe?.title)&&void 0!==c?c:Xe?.name)&&void 0!==m?m:""})})]}),ta&&(0,l.jsxs)("div",{className:"vkbm-plan-summary__status vkbm-plan-summary__status--detached",ref:He,children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"vkbm-plan-summary__status-label",children:(0,r.__)("Selected frame","vk-booking-manager")}),A?(0,l.jsxs)("strong",{children:[A.start_at?.slice(0,10)," ",D(A.start_at)," ",A.start_at?.slice(11,16)," -"," ",(A.service_end_at||A.end_at)?.slice(11,16)]}):(0,l.jsx)("span",{children:(0,r.__)("Not selected","vk-booking-manager")})]}),(0,l.jsxs)("div",{className:"vkbm-plan-summary__actions",children:[(0,l.jsx)("button",{type:"button",className:"vkbm-plan-summary__action vkbm-button vkbm-button__md vkbm-button__primary",onClick:ha,disabled:!fa||Be,children:Be?(0,r.__)("Processing...","vk-booking-manager"):(0,r.__)("Proceed to Reservation","vk-booking-manager")}),$e&&(0,l.jsx)("p",{className:"vkbm-plan-summary__error",children:$e})]})]})]})]})},D=e=>{if(!e)return"";try{const a=new Date(e);return Number.isNaN(a.getTime())?"":`(${new Intl.DateTimeFormat("ja-JP",{weekday:"short"}).format(a)})`}catch(e){return""}};n()(()=>{document.querySelectorAll(".wp-block-vk-booking-manager-reservation").forEach(e=>{var a,n,r;const o=e.dataset||{},i=null!==(a=o.defaultMenuId)&&void 0!==a?a:"0",s=null!==(n=o.defaultResourceId)&&void 0!==n?n:"0",m=null!==(r=o.allowStaffSelection)&&void 0!==r?r:"1",c={defaultMenuId:Number(i)||0,defaultStaffId:Number(s)||0,allowStaffSelection:"0"!==m};(0,t.render)((0,l.jsx)(B,{...c}),e)})})})();