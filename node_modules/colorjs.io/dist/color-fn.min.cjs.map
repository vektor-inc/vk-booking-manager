{"version":3,"file":"color-fn.min.cjs","sources":["../src/multiply-matrices.js","../src/util.js","../src/Type.js","../src/Format.js","../src/hooks.js","../src/adapt.js","../src/defaults.js","../src/parse.js","../src/getColor.js","../src/ColorSpace.js","../src/spaces/xyz-d65.js","../src/RGBColorSpace.js","../src/getAll.js","../src/get.js","../src/setAll.js","../src/set.js","../src/spaces/xyz-d50.js","../src/spaces/lab.js","../src/angles.js","../src/spaces/lch.js","../src/deltaE/deltaE2000.js","../src/spaces/oklab.js","../src/deltaE/deltaEOK.js","../src/inGamut.js","../src/clone.js","../src/distance.js","../src/deltaE/deltaE76.js","../src/deltaE/deltaECMC.js","../src/spaces/xyz-abs-d65.js","../src/spaces/jzazbz.js","../src/spaces/jzczhz.js","../src/deltaE/deltaEJz.js","../src/spaces/ictcp.js","../src/deltaE/deltaEITP.js","../src/deltaE/deltaEOK2.js","../src/spaces/cam16.js","../src/spaces/hct.js","../src/deltaE/deltaEHCT.js","../src/deltaE/index.js","../src/toGamut.js","../src/to.js","../src/serialize.js","../src/spaces/rec2020-linear.js","../src/spaces/rec2020.js","../src/spaces/p3-linear.js","../src/spaces/srgb-linear.js","../src/keywords.js","../src/spaces/srgb.js","../src/spaces/p3.js","../src/display.js","../src/deltas.js","../src/luminance.js","../src/contrast/WCAG21.js","../src/contrast/APCA.js","../src/contrast/Michelson.js","../src/contrast/Weber.js","../src/contrast/Lstar.js","../src/spaces/lab-d65.js","../src/contrast/deltaPhi.js","../src/chromaticity.js","../src/deltaE.js","../src/variations.js","../src/interpolation.js","../src/spaces/hsl.js","../src/spaces/hsv.js","../src/spaces/hwb.js","../src/spaces/a98rgb-linear.js","../src/spaces/a98rgb.js","../src/spaces/prophoto-linear.js","../src/spaces/prophoto.js","../src/spaces/rec2020-oetf.js","../src/spaces/oklch.js","../src/spaces/okhsl.js","../src/spaces/oklrab.js","../src/spaces/oklrch.js","../src/spaces/okhsv.js","../src/spaces/luv.js","../src/spaces/lchuv.js","../src/spaces/hsluv.js","../src/spaces/hpluv.js","../src/spaces/rec2100-linear.js","../src/spaces/rec2100-pq.js","../src/spaces/rec2100-hlg.js","../src/CATs.js","../src/spaces/acescg.js","../src/spaces/acescc.js","../src/contrast.js","../src/equals.js","../src/tryColor.js"],"sourcesContent":["/** @import { Matrix3x3, Vector3 } from \"./types.js\" */\n\n/**\n * A is m x n. B is n x p. product is m x p.\n *\n * Array arguments are treated like vectors:\n * - A becomes 1 x n\n * - B becomes n x 1\n *\n * Returns Matrix m x p or equivalent array or number\n *\n * @overload\n * @param {number[]} A Vector 1 x n\n * @param {number[]} B Vector n x 1\n * @returns {number} Scalar number\n *\n * @overload\n * @param {number[][]} A Matrix m x n\n * @param {number[]} B Vector n x 1\n * @returns {number[]} Array with length m\n *\n * @overload\n * @param {number[]} A Vector 1 x n\n * @param {number[][]} B Matrix n x p\n * @returns {number[]} Array with length p\n *\n * @overload\n * @param {number[][]} A Matrix m x n\n * @param {number[][]} B Matrix n x p\n * @returns {number[][]} Matrix m x p\n *\n * @param {number[] | number[][]} A Matrix m x n or a vector\n * @param {number[] | number[][]} B Matrix n x p or a vector\n * @returns {number | number[] | number[][]} Matrix m x p or equivalent array or number\n */\nexport default function multiplyMatrices (A, B) {\n\tlet m = A.length;\n\t/** @type {number[][]} */\n\tlet AM;\n\t/** @type {number[][]} */\n\tlet BM;\n\tlet aVec = false;\n\tlet bVec = false;\n\n\tif (!Array.isArray(A[0])) {\n\t\t// A is vector, convert to [[a, b, c, ...]]\n\t\tAM = [/** @type {number[]} */ (A)];\n\t\tm = AM.length;\n\t\taVec = true;\n\t}\n\telse {\n\t\tAM = /** @type {number[][]} */ (A);\n\t}\n\n\tif (!Array.isArray(B[0])) {\n\t\t// B is vector, convert to [[a], [b], [c], ...]]\n\t\tBM = B.length > 0 ? B.map(x => [x]) : [[]]; // Avoid mapping empty array\n\t\tbVec = true;\n\t}\n\telse {\n\t\tBM = /** @type {number[][]} */ (B);\n\t}\n\n\tlet p = BM[0].length;\n\tlet BM_cols = BM[0].map((_, i) => BM.map(x => x[i])); // transpose B\n\t/** @type {number[] | number[][]} */\n\tlet product = AM.map(row =>\n\t\tBM_cols.map(col => {\n\t\t\tlet ret = 0;\n\n\t\t\tif (!Array.isArray(row)) {\n\t\t\t\tfor (let c of col) {\n\t\t\t\t\tret += row * c;\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < row.length; i++) {\n\t\t\t\tret += row[i] * (col[i] || 0);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}));\n\n\tif (m === 1 && aVec) {\n\t\tproduct = product[0]; // Avoid [[a, b, c, ...]]\n\t}\n\tif (p === 1 && bVec) {\n\t\tif (m === 1 && aVec) {\n\t\t\treturn product[0]; // Avoid [[a]], return a number\n\t\t}\n\t\telse {\n\t\t\treturn product.map(x => x[0]); // Avoid [[a], [b], [c], ...]]\n\t\t}\n\t}\n\n\treturn product;\n}\n\n// dot3 and transform functions adapted from https://github.com/texel-org/color/blob/9793c7d4d02b51f068e0f3fd37131129a4270396/src/core.js\n//\n// The MIT License (MIT)\n// Copyright (c) 2024 Matt DesLauriers\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE\n// OR OTHER DEALINGS IN THE SOFTWARE.\n\n/**\n * Returns the dot product of two vectors each with a length of 3.\n *\n * @param {Vector3} a\n * @param {Vector3} b\n * @returns {number}\n */\nfunction dot3 (a, b) {\n\treturn a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\n/**\n * Transforms a vector of length 3 by a 3x3 matrix. Specify the same input and output\n * vector to transform in place.\n *\n * @param {Vector3} input\n * @param {Matrix3x3} matrix\n * @param {Vector3} [out]\n * @returns {Vector3}\n */\nexport function multiply_v3_m3x3 (input, matrix, out = [0, 0, 0]) {\n\tconst x = dot3(input, matrix[0]);\n\tconst y = dot3(input, matrix[1]);\n\tconst z = dot3(input, matrix[2]);\n\tout[0] = x;\n\tout[1] = y;\n\tout[2] = z;\n\treturn out;\n}\n","/**\n * Various utility functions\n */\n\nexport { default as multiplyMatrices, multiply_v3_m3x3 } from \"./multiply-matrices.js\";\n\n/**\n * Check if a value is a string (including a String object)\n * @param {any} str - Value to check\n * @returns {str is string}\n */\nexport function isString (str) {\n\treturn type(str) === \"string\";\n}\n\n/**\n * Determine the internal JavaScript [[Class]] of an object.\n * @param {any} o - Value to check\n * @returns {string}\n */\nexport function type (o) {\n\tlet str = Object.prototype.toString.call(o);\n\n\treturn (str.match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n}\n\n/**\n * @param {number} n\n * @param {{ precision?: number | undefined, unit?: string | undefined }} options\n * @returns {string}\n */\nexport function serializeNumber (n, { precision = 16, unit }) {\n\tif (isNone(n)) {\n\t\treturn \"none\";\n\t}\n\n\tn = +toPrecision(n, precision);\n\n\treturn n + (unit ?? \"\");\n}\n\n/**\n * Check if a value corresponds to a none argument\n * @param {any} n - Value to check\n * @returns {n is null}\n */\nexport function isNone (n) {\n\treturn n === null;\n}\n\n/**\n * Replace none values with 0\n * @param {number | null} n\n * @returns {number}\n */\nexport function skipNone (n) {\n\treturn isNone(n) ? 0 : n;\n}\n\n/**\n * Round a number to a certain number of significant digits\n * @param {number} n - The number to round\n * @param {number} precision - Number of significant digits\n */\nexport function toPrecision (n, precision) {\n\tif (n === 0) {\n\t\treturn 0;\n\t}\n\tlet integer = ~~n;\n\tlet digits = 0;\n\tif (integer && precision) {\n\t\tdigits = ~~Math.log10(Math.abs(integer)) + 1;\n\t}\n\tconst multiplier = 10.0 ** (precision - digits);\n\treturn Math.floor(n * multiplier + 0.5) / multiplier;\n}\n\n/**\n * @param {number} start\n * @param {number} end\n * @param {number} p\n */\nexport function interpolate (start, end, p) {\n\tif (isNaN(start)) {\n\t\treturn end;\n\t}\n\n\tif (isNaN(end)) {\n\t\treturn start;\n\t}\n\n\treturn start + (end - start) * p;\n}\n\n/**\n * @param {number} start\n * @param {number} end\n * @param {number} value\n */\nexport function interpolateInv (start, end, value) {\n\treturn (value - start) / (end - start);\n}\n\n/**\n * @param {[number, number]} from\n * @param {[number, number]} to\n * @param {number} value\n */\nexport function mapRange (from, to, value) {\n\tif (\n\t\t!from ||\n\t\t!to ||\n\t\tfrom === to ||\n\t\t(from[0] === to[0] && from[1] === to[1]) ||\n\t\tisNaN(value) ||\n\t\tvalue === null\n\t) {\n\t\t// Ranges missing or the same\n\t\treturn value;\n\t}\n\n\treturn interpolate(to[0], to[1], interpolateInv(from[0], from[1], value));\n}\n\n/**\n * Clamp value between the minimum and maximum\n * @param {number} min minimum value to return\n * @param {number} val the value to return if it is between min and max\n * @param {number} max maximum value to return\n */\nexport function clamp (min, val, max) {\n\treturn Math.max(Math.min(max, val), min);\n}\n\n/**\n * Copy sign of one value to another.\n * @param {number} to - Number to copy sign to\n * @param {number} from - Number to copy sign from\n */\nexport function copySign (to, from) {\n\treturn Math.sign(to) === Math.sign(from) ? to : -to;\n}\n\n/**\n * Perform pow on a signed number and copy sign to result\n * @param {number} base The base number\n * @param {number} exp The exponent\n */\nexport function spow (base, exp) {\n\treturn copySign(Math.abs(base) ** exp, base);\n}\n\n/**\n * Perform a divide, but return zero if the denominator is zero\n * @param {number} n The numerator\n * @param {number} d The denominator\n */\nexport function zdiv (n, d) {\n\treturn d === 0 ? 0 : n / d;\n}\n\n/**\n * Perform a bisect on a sorted list and locate the insertion point for\n * a value in arr to maintain sorted order.\n * @param {number[]} arr - array of sorted numbers\n * @param {number} value - value to find insertion point for\n * @param {number} lo - used to specify a the low end of a subset of the list\n * @param {number} hi - used to specify a the high end of a subset of the list\n */\nexport function bisectLeft (arr, value, lo = 0, hi = arr.length) {\n\twhile (lo < hi) {\n\t\tconst mid = (lo + hi) >> 1;\n\t\tif (arr[mid] < value) {\n\t\t\tlo = mid + 1;\n\t\t}\n\t\telse {\n\t\t\thi = mid;\n\t\t}\n\t}\n\treturn lo;\n}\n\n/**\n * Determines whether an argument is an instance of a constructor, including subclasses.\n * This is done by first just checking `instanceof`,\n * and then comparing the string names of the constructors if that fails.\n * @param {any} arg\n * @param {C} constructor\n * @template {new (...args: any) => any} C\n * @returns {arg is InstanceType<C>}\n */\nexport function isInstance (arg, constructor) {\n\tif (arg instanceof constructor) {\n\t\treturn true;\n\t}\n\n\tconst targetName = constructor.name;\n\n\twhile (arg) {\n\t\tconst proto = Object.getPrototypeOf(arg);\n\t\tconst constructorName = proto?.constructor?.name;\n\t\tif (constructorName === targetName) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!constructorName || constructorName === \"Object\") {\n\t\t\treturn false;\n\t\t}\n\t\targ = proto;\n\t}\n\n\treturn false;\n}\n","import { serializeNumber, mapRange, isInstance } from \"./util.js\";\n\nexport default class Type {\n\t// Class properties - declared here so that type inference works\n\ttype;\n\tcoordMeta;\n\tcoordRange;\n\t/** @type {[number, number]} */\n\trange;\n\n\t/**\n\t * @param {any} type\n\t * @param {import(\"./types.js\").CoordMeta} coordMeta\n\t */\n\tconstructor (type, coordMeta) {\n\t\tif (typeof type === \"object\") {\n\t\t\tthis.coordMeta = type;\n\t\t}\n\n\t\tif (coordMeta) {\n\t\t\tthis.coordMeta = coordMeta;\n\t\t\tthis.coordRange = coordMeta.range ?? coordMeta.refRange;\n\t\t}\n\n\t\tif (typeof type === \"string\") {\n\t\t\tlet params = type\n\t\t\t\t.trim()\n\t\t\t\t.match(/^(?<type><[a-z]+>)(\\[(?<min>-?[.\\d]+),\\s*(?<max>-?[.\\d]+)\\])?$/);\n\n\t\t\tif (!params) {\n\t\t\t\tthrow new TypeError(`Cannot parse ${type} as a type definition.`);\n\t\t\t}\n\n\t\t\tthis.type = params.groups.type;\n\t\t\tlet { min, max } = params.groups;\n\n\t\t\tif (min || max) {\n\t\t\t\tthis.range = [+min, +max];\n\t\t\t}\n\t\t}\n\t}\n\n\t/** @returns {[number, number]} */\n\tget computedRange () {\n\t\tif (this.range) {\n\t\t\treturn this.range;\n\t\t}\n\t\tif (this.type === \"<percentage>\") {\n\t\t\treturn this.percentageRange();\n\t\t}\n\t\telse if (this.type === \"<angle>\") {\n\t\t\treturn [0, 360];\n\t\t}\n\t\treturn null;\n\t}\n\n\tget unit () {\n\t\tif (this.type === \"<percentage>\") {\n\t\t\treturn \"%\";\n\t\t}\n\t\telse if (this.type === \"<angle>\") {\n\t\t\treturn \"deg\";\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Map a number to the internal representation\n\t * @param {number} number\n\t */\n\tresolve (number) {\n\t\tif (this.type === \"<angle>\") {\n\t\t\treturn number;\n\t\t}\n\n\t\tlet fromRange = this.computedRange;\n\t\tlet toRange = this.coordRange;\n\n\t\tif (this.type === \"<percentage>\") {\n\t\t\ttoRange ??= this.percentageRange();\n\t\t}\n\n\t\treturn mapRange(fromRange, toRange, number);\n\t}\n\n\t/**\n\t * Serialize a number from the internal representation to a string\n\t * @param {number} number\n\t * @param {number} [precision]\n\t */\n\tserialize (number, precision) {\n\t\tlet toRange = this.type === \"<percentage>\" ? this.percentageRange(100) : this.computedRange;\n\n\t\tlet unit = this.unit;\n\n\t\tnumber = mapRange(this.coordRange, toRange, number);\n\t\treturn serializeNumber(number, { unit, precision });\n\t}\n\n\ttoString () {\n\t\tlet ret = this.type;\n\n\t\tif (this.range) {\n\t\t\tlet [min = \"\", max = \"\"] = this.range;\n\t\t\tret += `[${min},${max}]`;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Returns a percentage range for values of this type\n\t * @param {number} scale\n\t * @returns {[number, number]}\n\t */\n\tpercentageRange (scale = 1) {\n\t\tlet range;\n\t\tif (\n\t\t\t(this.coordMeta && this.coordMeta.range) ||\n\t\t\t(this.coordRange && this.coordRange[0] >= 0)\n\t\t) {\n\t\t\trange = [0, 1];\n\t\t}\n\t\telse {\n\t\t\trange = [-1, 1];\n\t\t}\n\t\treturn [range[0] * scale, range[1] * scale];\n\t}\n\n\tstatic get (type, coordMeta) {\n\t\tif (isInstance(type, this)) {\n\t\t\treturn type;\n\t\t}\n\n\t\treturn new this(type, coordMeta);\n\t}\n}\n","import { isInstance, isNone } from \"./util.js\";\nimport Type from \"./Type.js\";\n\n/** @import { ColorSpace, Coords } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Format} FormatInterface */\n\n/**\n * @internal\n * Used to index {@link FormatInterface Format} objects and store an instance.\n * Not meant for external use\n */\nexport const instance = Symbol(\"instance\");\n\n/**\n * Remove the first element of an array type\n * @template {any[]} T\n * @typedef {T extends [any, ...infer R] ? R : T[number][]} RemoveFirstElement\n */\n\n/**\n * @class Format\n * @implements {Omit<FormatInterface, \"coords\" | \"serializeCoords\">}\n * Class to hold a color serialization format\n */\nexport default class Format {\n\t// Class properties - declared here so that type inference works\n\ttype;\n\tname;\n\tspaceCoords;\n\t/** @type {Type[][]} */\n\tcoords;\n\t/** @type {string | undefined} */\n\tid;\n\t/** @type {boolean | undefined} */\n\talpha;\n\n\t/**\n\t * @param {FormatInterface} format\n\t * @param {ColorSpace} space\n\t */\n\tconstructor (format, space = format.space) {\n\t\tformat[instance] = this;\n\t\tthis.type = \"function\";\n\t\tthis.name = \"color\";\n\n\t\tObject.assign(this, format);\n\n\t\tthis.space = space;\n\n\t\tif (this.type === \"custom\") {\n\t\t\t// Nothing else to do here\n\t\t\treturn;\n\t\t}\n\n\t\tthis.spaceCoords = Object.values(space.coords);\n\n\t\tif (!this.coords) {\n\t\t\t// @ts-expect-error Strings are converted to the correct type later\n\t\t\tthis.coords = this.spaceCoords.map(coordMeta => {\n\t\t\t\tlet ret = [\"<number>\", \"<percentage>\"];\n\n\t\t\t\tif (coordMeta.type === \"angle\") {\n\t\t\t\t\tret.push(\"<angle>\");\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t});\n\t\t}\n\n\t\tthis.coords = this.coords.map(\n\t\t\t/** @param {string | string[] | Type[]} types */ (types, i) => {\n\t\t\t\tlet coordMeta = this.spaceCoords[i];\n\n\t\t\t\tif (typeof types === \"string\") {\n\t\t\t\t\ttypes = types.trim().split(/\\s*\\|\\s*/);\n\t\t\t\t}\n\n\t\t\t\treturn types.map(type => Type.get(type, coordMeta));\n\t\t\t},\n\t\t);\n\t}\n\n\t/**\n\t * @param {Coords} coords\n\t * @param {number} precision\n\t * @param {Type[]} types\n\t */\n\tserializeCoords (coords, precision, types) {\n\t\ttypes = coords.map((_, i) =>\n\t\t\tType.get(types?.[i] ?? this.coords[i][0], this.spaceCoords[i]));\n\t\treturn coords.map((c, i) => types[i].serialize(c, precision));\n\t}\n\n\t/**\n\t * Validates the coordinates of a color against a format's coord grammar and\n\t * maps the coordinates to the range or refRange of the coordinates.\n\t * @param {Coords} coords\n\t * @param {[string, string, string]} types\n\t */\n\tcoerceCoords (coords, types) {\n\t\treturn Object.entries(this.space.coords).map(([id, coordMeta], i) => {\n\t\t\tlet arg = coords[i];\n\n\t\t\tif (isNone(arg) || isNaN(arg)) {\n\t\t\t\t// Nothing to do here\n\t\t\t\treturn arg;\n\t\t\t}\n\n\t\t\t// Find grammar alternative that matches the provided type\n\t\t\t// Non-strict equals is intentional because we are comparing w/ string objects\n\t\t\tlet providedType = types[i];\n\t\t\tlet type = this.coords[i].find(c => c.type == providedType);\n\n\t\t\t// Check that each coord conforms to its grammar\n\t\t\tif (!type) {\n\t\t\t\t// Type does not exist in the grammar, throw\n\t\t\t\tlet coordName = coordMeta.name || id;\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t`${providedType ?? /** @type {any} */ (arg)?.raw ?? arg} not allowed for ${coordName} in ${this.name}()`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\targ = type.resolve(arg);\n\n\t\t\tif (type.range) {\n\t\t\t\t// Adjust type to include range\n\t\t\t\ttypes[i] = type.toString();\n\t\t\t}\n\n\t\t\treturn arg;\n\t\t});\n\t}\n\n\t/**\n\t * @returns {boolean | Required<FormatInterface>[\"serialize\"]}\n\t */\n\tcanSerialize () {\n\t\treturn this.type === \"function\" || /** @type {any} */ (this).serialize;\n\t}\n\n\t/**\n\t * @param {string} str\n\t * @returns {(import(\"./types.js\").ColorConstructor) | undefined | null}\n\t */\n\tparse (str) {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @param {Format | FormatInterface} format\n\t * @param {RemoveFirstElement<ConstructorParameters<typeof Format>>} args\n\t * @returns {Format}\n\t */\n\tstatic get (format, ...args) {\n\t\tif (!format || isInstance(format, this)) {\n\t\t\treturn /** @type {Format} */ (format);\n\t\t}\n\n\t\tif (format[instance]) {\n\t\t\treturn format[instance];\n\t\t}\n\n\t\treturn new Format(format, ...args);\n\t}\n}\n","/**\n * A class for adding deep extensibility to any piece of JS code\n */\nexport class Hooks {\n\tadd (name, callback, first) {\n\t\tif (typeof arguments[0] != \"string\") {\n\t\t\t// Multiple hooks\n\t\t\tfor (var name in arguments[0]) {\n\t\t\t\tthis.add(name, arguments[0][name], arguments[1]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t(Array.isArray(name) ? name : [name]).forEach(function (name) {\n\t\t\tthis[name] = this[name] || [];\n\n\t\t\tif (callback) {\n\t\t\t\tthis[name][first ? \"unshift\" : \"push\"](callback);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\trun (name, env) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name].forEach(function (callback) {\n\t\t\tcallback.call(env && env.context ? env.context : env, env);\n\t\t});\n\t}\n}\n\n/**\n * The instance of {@link Hooks} used throughout Color.js\n */\nconst hooks = new Hooks();\n\nexport default hooks;\n","import hooks from \"./hooks.js\";\nimport { multiply_v3_m3x3 } from \"./util.js\";\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").White} White */\n\n/** @type {Record<string, White>} */\n// prettier-ignore\nexport const WHITES = {\n\t// for compatibility, the four-digit chromaticity-derived ones everyone else uses\n\tD50: [0.3457 / 0.3585, 1.00000, (1.0 - 0.3457 - 0.3585) / 0.3585],\n\tD65: [0.3127 / 0.3290, 1.00000, (1.0 - 0.3127 - 0.3290) / 0.3290],\n};\n\n/**\n *\n * @param {string | White} name\n * @returns {White}\n */\nexport function getWhite (name) {\n\tif (Array.isArray(name)) {\n\t\treturn name;\n\t}\n\n\treturn WHITES[name];\n}\n\n/**\n * Adapt XYZ from white point W1 to W2\n * @param {White | string} W1\n * @param {White | string} W2\n * @param {[number, number, number]} XYZ\n * @param {{ method?: string | undefined }} options\n * @returns {[number, number, number]}\n */\nexport default function adapt (W1, W2, XYZ, options = {}) {\n\tW1 = getWhite(W1);\n\tW2 = getWhite(W2);\n\n\tif (!W1 || !W2) {\n\t\tthrow new TypeError(\n\t\t\t`Missing white point to convert ${!W1 ? \"from\" : \"\"}${!W1 && !W2 ? \"/\" : \"\"}${!W2 ? \"to\" : \"\"}`,\n\t\t);\n\t}\n\n\tif (W1 === W2) {\n\t\t// Same whitepoints, no conversion needed\n\t\treturn XYZ;\n\t}\n\n\tlet env = { W1, W2, XYZ, options };\n\n\thooks.run(\"chromatic-adaptation-start\", env);\n\n\tif (!env.M) {\n\t\tif (env.W1 === WHITES.D65 && env.W2 === WHITES.D50) {\n\t\t\t// prettier-ignore\n\t\t\tenv.M = [\n\t\t\t\t[  1.0479297925449969,   0.022946870601609652, -0.05019226628920524  ],\n\t\t\t\t[  0.02962780877005599,  0.9904344267538799,   -0.017073799063418826 ],\n\t\t\t\t[ -0.009243040646204504, 0.015055191490298152,  0.7518742814281371   ],\n\t\t\t];\n\t\t}\n\t\telse if (env.W1 === WHITES.D50 && env.W2 === WHITES.D65) {\n\t\t\t// prettier-ignore\n\t\t\tenv.M = [\n\t\t\t\t[  0.955473421488075,    -0.02309845494876471,  0.06325924320057072  ],\n\t\t\t\t[ -0.0283697093338637,    1.0099953980813041,   0.021041441191917323 ],\n\t\t\t\t[  0.012314014864481998, -0.020507649298898964, 1.330365926242124    ],\n\t\t\t];\n\t\t}\n\t}\n\n\thooks.run(\"chromatic-adaptation-end\", env);\n\n\tif (env.M) {\n\t\treturn multiply_v3_m3x3(env.XYZ, env.M);\n\t}\n\telse {\n\t\tthrow new TypeError(\"Only Bradford CAT with white points D50 and D65 supported for now.\");\n\t}\n}\n","// Global defaults one may want to configure\nexport default {\n\tgamut_mapping: \"css\",\n\tprecision: 5,\n\tdeltaE: \"76\", // Default deltaE method\n\tverbose: globalThis?.process?.env?.NODE_ENV?.toLowerCase() !== \"test\",\n\twarn: function warn (msg) {\n\t\tif (this.verbose) {\n\t\t\tglobalThis?.console?.warn?.(msg);\n\t\t}\n\t},\n};\n","import { isNone, clamp } from \"./util.js\";\nimport hooks from \"./hooks.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\n\n/** @import { ColorConstructor } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").ArgumentMeta} ArgumentMeta */\n/** @typedef {import(\"./types.js\").ParseFunctionReturn} ParseFunctionReturn */\n/** @typedef {import(\"./types.js\").ParseOptions} ParseOptions */\n\n/**\n * Convert a CSS Color string to a color object\n * @param {string} str\n * @param {ParseOptions} [options]\n * @returns {ColorConstructor}\n */\nexport default function parse (str, options) {\n\tlet env = {\n\t\tstr: String(str)?.trim(),\n\t\toptions,\n\t};\n\n\thooks.run(\"parse-start\", env);\n\n\tif (env.color) {\n\t\treturn env.color;\n\t}\n\n\tenv.parsed = parseFunction(env.str);\n\tlet ret;\n\tlet meta = env.options ? (env.options.parseMeta ?? env.options.meta) : null;\n\n\tif (env.parsed) {\n\t\t// Is a functional syntax\n\t\tlet name = env.parsed.name;\n\t\tlet format;\n\t\tlet space;\n\t\tlet coords = env.parsed.args;\n\t\tlet types = coords.map((c, i) => env.parsed.argMeta[i]?.type);\n\n\t\tif (name === \"color\") {\n\t\t\t// color() function\n\t\t\tlet id = coords.shift();\n\t\t\ttypes.shift();\n\t\t\t// Check against both <dashed-ident> and <ident> versions\n\t\t\tlet alternateId = id.startsWith(\"--\") ? id.substring(2) : `--${id}`;\n\t\t\tlet ids = [id, alternateId];\n\t\t\tformat = ColorSpace.findFormat({ name, id: ids, type: \"function\" });\n\n\t\t\tif (!format) {\n\t\t\t\t// Not found\n\t\t\t\tlet didYouMean;\n\n\t\t\t\tlet registryId = id in ColorSpace.registry ? id : alternateId;\n\t\t\t\tif (registryId in ColorSpace.registry) {\n\t\t\t\t\t// Used color space id instead of color() id, these are often different\n\t\t\t\t\tlet cssId = ColorSpace.registry[registryId].formats?.color?.id;\n\n\t\t\t\t\tif (cssId) {\n\t\t\t\t\t\tlet altColor = str.replace(\"color(\" + id, \"color(\" + cssId);\n\t\t\t\t\t\tdidYouMean = `Did you mean ${altColor}?`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t`Cannot parse ${env.str}. ` + (didYouMean ?? \"Missing a plugin?\"),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tspace = format.space;\n\n\t\t\tif (format.id.startsWith(\"--\") && !id.startsWith(\"--\")) {\n\t\t\t\tdefaults.warn(\n\t\t\t\t\t`${space.name} is a non-standard space and not currently supported in the CSS spec. ` +\n\t\t\t\t\t\t`Use prefixed color(${format.id}) instead of color(${id}).`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (id.startsWith(\"--\") && !format.id.startsWith(\"--\")) {\n\t\t\t\tdefaults.warn(\n\t\t\t\t\t`${space.name} is a standard space and supported in the CSS spec. ` +\n\t\t\t\t\t\t`Use color(${format.id}) instead of prefixed color(${id}).`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tformat = ColorSpace.findFormat({ name, type: \"function\" });\n\t\t\tspace = format.space;\n\t\t}\n\n\t\tif (meta) {\n\t\t\tObject.assign(meta, {\n\t\t\t\tformat,\n\t\t\t\tformatId: format.name,\n\t\t\t\ttypes,\n\t\t\t\tcommas: env.parsed.commas,\n\t\t\t});\n\t\t}\n\n\t\tlet alpha = 1;\n\n\t\tif (env.parsed.lastAlpha) {\n\t\t\talpha = env.parsed.args.pop();\n\n\t\t\tif (meta) {\n\t\t\t\tmeta.alphaType = types.pop();\n\t\t\t}\n\t\t}\n\n\t\tlet coordCount = format.coords.length;\n\n\t\tif (coords.length !== coordCount) {\n\t\t\tthrow new TypeError(\n\t\t\t\t`Expected ${coordCount} coordinates for ${space.id} in ${env.str}), got ${coords.length}`,\n\t\t\t);\n\t\t}\n\n\t\tcoords = format.coerceCoords(coords, types);\n\n\t\tret = { spaceId: space.id, coords, alpha };\n\t}\n\telse {\n\t\t// Custom, colorspace-specific format\n\t\tspaceloop: for (let space of ColorSpace.all) {\n\t\t\tfor (let formatId in space.formats) {\n\t\t\t\tlet format = space.formats[formatId];\n\n\t\t\t\tif (format.type !== \"custom\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (format.test && !format.test(env.str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Convert to Format object\n\t\t\t\tlet formatObject = space.getFormat(format);\n\n\t\t\t\tlet color = formatObject.parse(env.str);\n\n\t\t\t\tif (color) {\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tObject.assign(meta, { format: formatObject, formatId });\n\t\t\t\t\t}\n\n\t\t\t\t\tret = color;\n\t\t\t\t\tbreak spaceloop;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!ret) {\n\t\t// If we're here, we couldn't parse\n\t\tthrow new TypeError(`Could not parse ${str} as a color. Missing a plugin?`);\n\t}\n\n\t// Clamp alpha to [0, 1]\n\tret.alpha = isNone(ret.alpha)\n\t\t? ret.alpha\n\t\t: ret.alpha === undefined\n\t\t\t? 1\n\t\t\t: clamp(0, ret.alpha, 1);\n\n\treturn ret;\n}\n\n/**\n * Units and multiplication factors for the internally stored numbers\n */\nexport const units = {\n\t\"%\": 0.01,\n\tdeg: 1,\n\tgrad: 0.9,\n\trad: 180 / Math.PI,\n\tturn: 360,\n};\n\nexport const regex = {\n\t// Need to list calc(NaN) explicitly as otherwise its ending paren would terminate the function call\n\tfunction: /^([a-z]+)\\(((?:calc\\(NaN\\)|.)+?)\\)$/i,\n\tnumber: /^([-+]?(?:[0-9]*\\.)?[0-9]+(e[-+]?[0-9]+)?)$/i,\n\tunitValue: RegExp(`(${Object.keys(units).join(\"|\")})$`),\n\n\t// NOTE The -+ are not just for prefix, but also for idents, and e+N notation!\n\tsingleArgument: /\\/?\\s*(none|NaN|calc\\(NaN\\)|[-+\\w.]+(?:%|deg|g?rad|turn)?)/g,\n};\n\n/**\n * Parse a single function argument\n * @param {string} rawArg\n * @returns {{value: number, meta: ArgumentMeta}}\n */\nexport function parseArgument (rawArg) {\n\t/** @type {Partial<ArgumentMeta>} */\n\tlet meta = {};\n\tlet unit = rawArg.match(regex.unitValue)?.[0];\n\t/** @type {string | number} */\n\tlet value = (meta.raw = rawArg);\n\n\tif (unit) {\n\t\t// It’s a dimension token\n\t\tmeta.type = unit === \"%\" ? \"<percentage>\" : \"<angle>\";\n\t\tmeta.unit = unit;\n\t\tmeta.unitless = Number(value.slice(0, -unit.length)); // unitless number\n\n\t\tvalue = meta.unitless * units[unit];\n\t}\n\telse if (regex.number.test(value)) {\n\t\t// It's a number\n\t\t// Convert numerical args to numbers\n\t\tvalue = Number(value);\n\t\tmeta.type = \"<number>\";\n\t}\n\telse if (value === \"none\") {\n\t\tvalue = null;\n\t}\n\telse if (value === \"NaN\" || value === \"calc(NaN)\") {\n\t\tvalue = NaN;\n\t\tmeta.type = \"<number>\";\n\t}\n\telse {\n\t\tmeta.type = \"<ident>\";\n\t}\n\n\treturn { value: /** @type {number} */ (value), meta: /** @type {ArgumentMeta} */ (meta) };\n}\n\n/**\n * Parse a CSS function, regardless of its name and arguments\n * @param {string} str String to parse\n * @return {ParseFunctionReturn | void}\n */\nexport function parseFunction (str) {\n\tif (!str) {\n\t\treturn;\n\t}\n\n\tstr = str.trim();\n\n\tlet parts = str.match(regex.function);\n\n\tif (parts) {\n\t\t// It is a function, parse args\n\t\tlet args = [];\n\t\tlet argMeta = [];\n\t\tlet lastAlpha = false;\n\t\tlet name = parts[1].toLowerCase();\n\n\t\tlet separators = parts[2].replace(regex.singleArgument, ($0, rawArg) => {\n\t\t\tlet { value, meta } = parseArgument(rawArg);\n\n\t\t\tif (\n\t\t\t\t// If there's a slash here, it's modern syntax\n\t\t\t\t$0.startsWith(\"/\") ||\n\t\t\t\t// If there's still elements to process after there's already 3 in `args` (and the we're not dealing with \"color()\"), it's likely to be a legacy color like \"hsl(0, 0%, 0%, 0.5)\"\n\t\t\t\t(name !== \"color\" && args.length === 3)\n\t\t\t) {\n\t\t\t\t// It's alpha\n\t\t\t\tlastAlpha = true;\n\t\t\t}\n\n\t\t\targs.push(value);\n\t\t\targMeta.push(meta);\n\t\t\treturn \"\";\n\t\t});\n\n\t\treturn {\n\t\t\tname,\n\t\t\targs,\n\t\t\targMeta,\n\t\t\tlastAlpha,\n\t\t\tcommas: separators.includes(\",\"),\n\t\t\trawName: parts[1],\n\t\t\trawArgs: parts[2],\n\t\t};\n\t}\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport { isString, isInstance } from \"./util.js\";\nimport parse from \"./parse.js\";\n\n/** @import { ColorTypes, ParseOptions as GetColorOptions, PlainColorObject } from \"./types.js\" */\n\n/**\n * Resolves a color reference (object or string) to a plain color object\n * @overload\n * @param {ColorTypes} color\n * @param {GetColorOptions} [options]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes[]} color\n * @param {GetColorOptions} [options]\n * @returns {PlainColorObject[]}\n */\nexport default function getColor (color, options) {\n\tif (Array.isArray(color)) {\n\t\treturn color.map(c => getColor(c, options));\n\t}\n\n\tif (!color) {\n\t\tthrow new TypeError(\"Empty color reference\");\n\t}\n\n\tif (isString(color)) {\n\t\tcolor = parse(color, options);\n\t}\n\n\t// Object fixup\n\tlet space = color.space || color.spaceId;\n\n\tif (typeof space === \"string\") {\n\t\t// Convert string id to color space object\n\t\tcolor.space = ColorSpace.get(space);\n\t}\n\n\tif (color.alpha === undefined) {\n\t\tcolor.alpha = 1;\n\t}\n\n\treturn color;\n}\n","/**\n * @packageDocumentation\n * Defines the class and other types related to creating color spaces.\n * For the builtin color spaces, see the `spaces` module.\n */\nimport { type, isNone, isInstance } from \"./util.js\";\nimport Format from \"./Format.js\";\nimport { getWhite } from \"./adapt.js\";\nimport hooks from \"./hooks.js\";\nimport getColor from \"./getColor.js\";\n\nconst ε = 0.000075;\n\n/**\n * Class to represent a color space\n */\nexport default class ColorSpace {\n\tconstructor (options) {\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.base = options.base ? ColorSpace.get(options.base) : null;\n\t\tthis.aliases = options.aliases;\n\n\t\tif (this.base) {\n\t\t\tthis.fromBase = options.fromBase;\n\t\t\tthis.toBase = options.toBase;\n\t\t}\n\n\t\t// Coordinate metadata\n\n\t\tlet coords = options.coords ?? this.base.coords;\n\n\t\tfor (let name in coords) {\n\t\t\tif (!(\"name\" in coords[name])) {\n\t\t\t\tcoords[name].name = name;\n\t\t\t}\n\t\t}\n\t\tthis.coords = coords;\n\n\t\t// White point\n\n\t\tlet white = options.white ?? this.base.white ?? \"D65\";\n\t\tthis.white = getWhite(white);\n\n\t\t// Sort out formats\n\n\t\tthis.formats = options.formats ?? {};\n\n\t\tfor (let name in this.formats) {\n\t\t\tlet format = this.formats[name];\n\t\t\tformat.type ||= \"function\";\n\t\t\tformat.name ||= name;\n\t\t}\n\n\t\tif (!this.formats.color?.id) {\n\t\t\tthis.formats.color = {\n\t\t\t\t...(this.formats.color ?? {}),\n\t\t\t\tid: options.cssId || this.id,\n\t\t\t};\n\t\t}\n\n\t\t// Gamut space\n\n\t\tif (options.gamutSpace) {\n\t\t\t// Gamut space explicitly specified\n\t\t\tthis.gamutSpace =\n\t\t\t\toptions.gamutSpace === \"self\" ? this : ColorSpace.get(options.gamutSpace);\n\t\t}\n\t\telse {\n\t\t\t// No gamut space specified, calculate a sensible default\n\t\t\tif (this.isPolar) {\n\t\t\t\t// Do not check gamut through polar coordinates\n\t\t\t\tthis.gamutSpace = this.base;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.gamutSpace = this;\n\t\t\t}\n\t\t}\n\n\t\t// Optimize inGamut for unbounded spaces\n\t\tif (this.gamutSpace.isUnbounded) {\n\t\t\tthis.inGamut = (coords, options) => {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\t// Other stuff\n\t\tthis.referred = options.referred;\n\n\t\t// Compute ancestors and store them, since they will never change\n\t\tObject.defineProperty(this, \"path\", {\n\t\t\tvalue: getPath(this).reverse(),\n\t\t\twritable: false,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t});\n\n\t\thooks.run(\"colorspace-init-end\", this);\n\t}\n\n\tinGamut (coords, { epsilon = ε } = {}) {\n\t\tif (!this.equals(this.gamutSpace)) {\n\t\t\tcoords = this.to(this.gamutSpace, coords);\n\t\t\treturn this.gamutSpace.inGamut(coords, { epsilon });\n\t\t}\n\n\t\tlet coordMeta = Object.values(this.coords);\n\n\t\treturn coords.every((c, i) => {\n\t\t\tlet meta = coordMeta[i];\n\n\t\t\tif (meta.type !== \"angle\" && meta.range) {\n\t\t\t\tif (isNone(c)) {\n\t\t\t\t\t// NaN is always in gamut\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tlet [min, max] = meta.range;\n\t\t\t\treturn (\n\t\t\t\t\t(min === undefined || c >= min - epsilon) &&\n\t\t\t\t\t(max === undefined || c <= max + epsilon)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tget isUnbounded () {\n\t\treturn Object.values(this.coords).every(coord => !(\"range\" in coord));\n\t}\n\n\tget cssId () {\n\t\treturn this.formats?.color?.id || this.id;\n\t}\n\n\tget isPolar () {\n\t\tfor (let id in this.coords) {\n\t\t\tif (this.coords[id].type === \"angle\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Lookup a format in this color space\n\t * @param {string | object | Format} format - Format id if string. If object, it's converted to a `Format` object and returned.\n\t * @returns {Format}\n\t */\n\tgetFormat (format) {\n\t\tif (!format) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (format === \"default\") {\n\t\t\tformat = Object.values(this.formats)[0];\n\t\t}\n\t\telse if (typeof format === \"string\") {\n\t\t\tformat = this.formats[format];\n\t\t}\n\n\t\tlet ret = Format.get(format, this);\n\n\t\tif (ret !== format && format.name in this.formats) {\n\t\t\t// Update the format we have on file so we can find it more quickly next time\n\t\t\tthis.formats[format.name] = ret;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Check if this color space is the same as another color space reference.\n\t * Allows proxying color space objects and comparing color spaces with ids.\n\t * @param {string | ColorSpace} space ColorSpace object or id to compare to\n\t * @returns {boolean}\n\t */\n\tequals (space) {\n\t\tif (!space) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this === space || this.id === space || this.id === space.id;\n\t}\n\n\tto (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (this.equals(space)) {\n\t\t\t// Same space, no change needed\n\t\t\treturn coords;\n\t\t}\n\n\t\t// Convert NaN to 0, which seems to be valid in every coordinate of every color space\n\t\tcoords = coords.map(c => (isNone(c) ? 0 : c));\n\n\t\t// Find connection space = lowest common ancestor in the base tree\n\t\tlet myPath = this.path;\n\t\tlet otherPath = space.path;\n\n\t\tlet connectionSpace, connectionSpaceIndex;\n\n\t\tfor (let i = 0; i < myPath.length; i++) {\n\t\t\tif (myPath[i].equals(otherPath[i])) {\n\t\t\t\tconnectionSpace = myPath[i];\n\t\t\t\tconnectionSpaceIndex = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!connectionSpace) {\n\t\t\t// This should never happen\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot convert between color spaces ${this} and ${space}: no connection space was found`,\n\t\t\t);\n\t\t}\n\n\t\t// Go up from current space to connection space\n\t\tfor (let i = myPath.length - 1; i > connectionSpaceIndex; i--) {\n\t\t\tcoords = myPath[i].toBase(coords);\n\t\t}\n\n\t\t// Go down from connection space to target space\n\t\tfor (let i = connectionSpaceIndex + 1; i < otherPath.length; i++) {\n\t\t\tcoords = otherPath[i].fromBase(coords);\n\t\t}\n\n\t\treturn coords;\n\t}\n\n\tfrom (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\treturn space.to(this, coords);\n\t}\n\n\ttoString () {\n\t\treturn `${this.name} (${this.id})`;\n\t}\n\n\tgetMinCoords () {\n\t\tlet ret = [];\n\n\t\tfor (let id in this.coords) {\n\t\t\tlet meta = this.coords[id];\n\t\t\tlet range = meta.range || meta.refRange;\n\t\t\tret.push(range?.min ?? 0);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tstatic registry = {};\n\n\t// Returns array of unique color spaces\n\tstatic get all () {\n\t\treturn [...new Set(Object.values(ColorSpace.registry))];\n\t}\n\n\tstatic register (id, space) {\n\t\tif (arguments.length === 1) {\n\t\t\tspace = arguments[0];\n\t\t\tid = space.id;\n\t\t}\n\n\t\tspace = this.get(space);\n\n\t\tif (this.registry[id] && this.registry[id] !== space) {\n\t\t\tthrow new Error(`Duplicate color space registration: '${id}'`);\n\t\t}\n\t\tthis.registry[id] = space;\n\n\t\t// Register aliases when called without an explicit ID.\n\t\tif (arguments.length === 1 && space.aliases) {\n\t\t\tfor (let alias of space.aliases) {\n\t\t\t\tthis.register(alias, space);\n\t\t\t}\n\t\t}\n\n\t\treturn space;\n\t}\n\n\t/**\n\t * Lookup ColorSpace object by name\n\t * @param {ColorSpace | string} name\n\t */\n\tstatic get (space, ...alternatives) {\n\t\tif (!space || isInstance(space, this)) {\n\t\t\treturn space;\n\t\t}\n\n\t\tlet argType = type(space);\n\n\t\tif (argType === \"string\") {\n\t\t\t// It's a color space id\n\t\t\tlet ret = ColorSpace.registry[space.toLowerCase()];\n\n\t\t\tif (!ret) {\n\t\t\t\tthrow new TypeError(`No color space found with id = \"${space}\"`);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (alternatives.length) {\n\t\t\treturn ColorSpace.get(...alternatives);\n\t\t}\n\n\t\tthrow new TypeError(`${space} is not a valid color space`);\n\t}\n\n\t/**\n\t * Look up all color spaces for a format that matches certain criteria\n\t * @param {object | string} filters\n\t * @param {Array<ColorSpace>} [spaces=ColorSpace.all]\n\t * @returns {Format | null}\n\t */\n\tstatic findFormat (filters, spaces = ColorSpace.all) {\n\t\tif (!filters) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (typeof filters === \"string\") {\n\t\t\tfilters = { name: filters };\n\t\t}\n\n\t\tfor (let space of spaces) {\n\t\t\tfor (let [name, format] of Object.entries(space.formats)) {\n\t\t\t\tformat.name ??= name;\n\t\t\t\tformat.type ??= \"function\";\n\n\t\t\t\tlet matches =\n\t\t\t\t\t(!filters.name || format.name === filters.name) &&\n\t\t\t\t\t(!filters.type || format.type === filters.type);\n\n\t\t\t\tif (filters.id) {\n\t\t\t\t\tlet ids = format.ids || [format.id];\n\t\t\t\t\tlet filterIds = Array.isArray(filters.id) ? filters.id : [filters.id];\n\t\t\t\t\tmatches &&= filterIds.some(id => ids.includes(id));\n\t\t\t\t}\n\n\t\t\t\tif (matches) {\n\t\t\t\t\tlet ret = Format.get(format, space);\n\n\t\t\t\t\tif (ret !== format) {\n\t\t\t\t\t\tspace.formats[format.name] = ret;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Get metadata about a coordinate of a color space\n\t *\n\t * @static\n\t * @param {Array | string} ref\n\t * @param {ColorSpace | string} [workingSpace]\n\t * @return {Object}\n\t */\n\tstatic resolveCoord (ref, workingSpace) {\n\t\tlet coordType = type(ref);\n\t\tlet space, coord;\n\n\t\tif (coordType === \"string\") {\n\t\t\tif (ref.includes(\".\")) {\n\t\t\t\t// Absolute coordinate\n\t\t\t\t[space, coord] = ref.split(\".\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Relative coordinate\n\t\t\t\t[space, coord] = [, ref];\n\t\t\t}\n\t\t}\n\t\telse if (Array.isArray(ref)) {\n\t\t\t[space, coord] = ref;\n\t\t}\n\t\telse {\n\t\t\t// Object\n\t\t\tspace = ref.space;\n\t\t\tcoord = ref.coordId;\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (!space) {\n\t\t\tspace = workingSpace;\n\t\t}\n\n\t\tif (!space) {\n\t\t\tthrow new TypeError(\n\t\t\t\t`Cannot resolve coordinate reference ${ref}: No color space specified and relative references are not allowed here`,\n\t\t\t);\n\t\t}\n\n\t\tcoordType = type(coord);\n\n\t\tif (coordType === \"number\" || (coordType === \"string\" && coord >= 0)) {\n\t\t\t// Resolve numerical coord\n\t\t\tlet meta = Object.entries(space.coords)[coord];\n\n\t\t\tif (meta) {\n\t\t\t\treturn { space, id: meta[0], index: coord, ...meta[1] };\n\t\t\t}\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tlet normalizedCoord = coord.toLowerCase();\n\n\t\tlet i = 0;\n\t\tfor (let id in space.coords) {\n\t\t\tlet meta = space.coords[id];\n\n\t\t\tif (\n\t\t\t\tid.toLowerCase() === normalizedCoord ||\n\t\t\t\tmeta.name?.toLowerCase() === normalizedCoord\n\t\t\t) {\n\t\t\t\treturn { space, id, index: i, ...meta };\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\tthrow new TypeError(\n\t\t\t`No \"${coord}\" coordinate found in ${space.name}. Its coordinates are: ${Object.keys(space.coords).join(\", \")}`,\n\t\t);\n\t}\n\n\tstatic DEFAULT_FORMAT = {\n\t\ttype: \"functions\",\n\t\tname: \"color\",\n\t};\n}\n\nfunction getPath (space) {\n\tlet ret = [space];\n\n\tfor (let s = space; (s = s.base); ) {\n\t\tret.push(s);\n\t}\n\n\treturn ret;\n}\n","import ColorSpace from \"../ColorSpace.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d65\",\n\tname: \"XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"X\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Y\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Z\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\tformats: {\n\t\tcolor: {\n\t\t\tids: [\"xyz-d65\", \"xyz\"],\n\t\t},\n\t},\n\taliases: [\"xyz\"],\n});\n","import ColorSpace from \"./ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"./util.js\";\nimport adapt from \"./adapt.js\";\nimport XYZ_D65 from \"./spaces/xyz-d65.js\";\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").RGBOptions} RGBOptions */\n\n/** Convenience class for RGB color spaces */\nexport default class RGBColorSpace extends ColorSpace {\n\t/**\n\t * Creates a new RGB ColorSpace.\n\t * If coords are not specified, they will use the default RGB coords.\n\t * Instead of `fromBase()` and `toBase()` functions,\n\t * you can specify to/from XYZ matrices and have `toBase()` and `fromBase()` automatically generated.\n\t * @param {RGBOptions} options\n\t */\n\tconstructor (options) {\n\t\tif (!options.coords) {\n\t\t\toptions.coords = {\n\t\t\t\tr: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Red\",\n\t\t\t\t},\n\t\t\t\tg: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Green\",\n\t\t\t\t},\n\t\t\t\tb: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Blue\",\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (!options.base) {\n\t\t\toptions.base = XYZ_D65;\n\t\t}\n\n\t\tif (options.toXYZ_M && options.fromXYZ_M) {\n\t\t\toptions.toBase ??= rgb => {\n\t\t\t\tlet xyz = multiply_v3_m3x3(rgb, options.toXYZ_M);\n\n\t\t\t\tif (this.white !== this.base.white) {\n\t\t\t\t\t// Perform chromatic adaptation\n\t\t\t\t\txyz = adapt(this.white, this.base.white, xyz);\n\t\t\t\t}\n\n\t\t\t\treturn xyz;\n\t\t\t};\n\n\t\t\toptions.fromBase ??= xyz => {\n\t\t\t\txyz = adapt(this.base.white, this.white, xyz);\n\t\t\t\treturn multiply_v3_m3x3(xyz, options.fromXYZ_M);\n\t\t\t};\n\t\t}\n\n\t\toptions.referred ??= \"display\";\n\n\t\tsuper(options);\n\t}\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\nimport { toPrecision } from \"./util.js\";\n\n/** @import { ColorTypes, Coords } from \"./types.js\" */\n\n/**\n * Options for {@link getAll}\n * @typedef GetAllOptions\n * @property {string | ColorSpace | undefined} [space]\n * The color space to convert to. Defaults to the color's current space\n * @property {number | undefined} [precision]\n * The number of significant digits to round the coordinates to\n */\n\n/**\n * Get the coordinates of a color in any color space\n * @overload\n * @param {ColorTypes} color\n * @param {string | ColorSpace} [options=color.space] The color space to convert to. Defaults to the color's current space\n * @returns {Coords} The color coordinates in the given color space\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {GetAllOptions} [options]\n * @returns {Coords} The color coordinates in the given color space\n */\nexport default function getAll (color, options) {\n\tcolor = getColor(color);\n\n\tlet space = ColorSpace.get(options, options?.space);\n\tlet precision = options?.precision;\n\n\tlet coords;\n\tif (!space || color.space.equals(space)) {\n\t\t// No conversion needed\n\t\tcoords = color.coords.slice();\n\t}\n\telse {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn precision === undefined ? coords : coords.map(coord => toPrecision(coord, precision));\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getAll from \"./getAll.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes, Ref } from \"./types.js\" */\n\n/**\n * @param {ColorTypes} color\n * @param {Ref} prop\n * @returns {number}\n */\nexport default function get (color, prop) {\n\tcolor = getColor(color);\n\n\tif (prop === \"alpha\") {\n\t\treturn color.alpha ?? 1;\n\t}\n\n\tlet { space, index } = ColorSpace.resolveCoord(prop, color.space);\n\tlet coords = getAll(color, space);\n\treturn coords[index];\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes, Coords, PlainColorObject } from \"./types.js\" */\n\n/**\n * Set all coordinates of a color at once, in its own color space or another.\n * Modifies the color in place.\n * @overload\n * @param {ColorTypes} color\n * @param {Coords} coords Array of coordinates\n * @param {number} [alpha]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {string | ColorSpace} space The color space of the provided coordinates.\n * @param {Coords} coords Array of coordinates\n * @param {number} [alpha]\n * @returns {PlainColorObject}\n */\nexport default function setAll (color, space, coords, alpha) {\n\tcolor = getColor(color);\n\n\tif (Array.isArray(space)) {\n\t\t// Space is omitted\n\t\t[space, coords, alpha] = [color.space, space, coords];\n\t}\n\n\tspace = ColorSpace.get(space); // Make sure we have a ColorSpace object\n\tcolor.coords = space === color.space ? coords.slice() : space.to(color.space, coords);\n\n\tif (alpha !== undefined) {\n\t\tcolor.alpha = alpha;\n\t}\n\n\treturn color;\n}\n\n/** @type {\"color\"} */\nsetAll.returns = \"color\";\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\nimport get from \"./get.js\";\nimport getAll from \"./getAll.js\";\nimport setAll from \"./setAll.js\";\nimport { type } from \"./util.js\";\n\n/** @import { ColorTypes, PlainColorObject, Ref } from \"./types.js\" */\n\n/**\n * Set properties and return current instance\n * @overload\n * @param {ColorTypes} color\n * @param {Ref} prop\n * @param {number | ((coord: number) => number)} value\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {Record<string, number | ((coord: number) => number)>} props\n * @returns {PlainColorObject}\n */\nexport default function set (color, prop, value) {\n\tcolor = getColor(color);\n\n\tif (arguments.length === 2 && type(arguments[1]) === \"object\") {\n\t\t// Argument is an object literal\n\t\tlet object = arguments[1];\n\t\tfor (let p in object) {\n\t\t\tset(color, p, object[p]);\n\t\t}\n\t}\n\telse {\n\t\tif (typeof value === \"function\") {\n\t\t\tvalue = value(get(color, prop));\n\t\t}\n\n\t\tif (prop === \"alpha\") {\n\t\t\tcolor.alpha = value;\n\t\t}\n\t\telse {\n\t\t\tlet { space, index } = ColorSpace.resolveCoord(prop, color.space);\n\t\t\tlet coords = getAll(color, space);\n\t\t\tcoords[index] = value;\n\t\t\tsetAll(color, space, coords);\n\t\t}\n\t}\n\n\treturn color;\n}\n\n/** @type {\"color\"} */\nset.returns = \"color\";\n","import ColorSpace from \"../ColorSpace.js\";\nimport adapt from \"../adapt.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d50\",\n\tname: \"XYZ D50\",\n\twhite: \"D50\",\n\tbase: XYZ_D65,\n\tfromBase: coords => adapt(XYZ_D65.white, \"D50\", coords),\n\ttoBase: coords => adapt(\"D50\", XYZ_D65.white, coords),\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport xyz_d50 from \"./xyz-d50.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27; // 29^3/3^3\n\nlet white = WHITES.D50;\n\nexport default new ColorSpace({\n\tid: \"lab\",\n\tname: \"Lab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D50, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d50,\n\t// Convert D50-adapted XYX to Lab\n\t// CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\t\tlet f = xyz.map(value => (value > ε ? Math.cbrt(value) : (κ * value + 16) / 116));\n\n\t\tlet L = 116 * f[1] - 16;\n\t\tlet a = 500 * (f[0] - f[1]);\n\t\tlet b = 200 * (f[1] - f[2]);\n\n\t\treturn [L, a, b];\n\t},\n\t// Convert Lab to D50-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet [L, a, b] = Lab;\n\t\tlet f = [];\n\t\tf[1] = (L + 16) / 116;\n\t\tf[0] = a / 500 + f[1];\n\t\tf[2] = f[1] - b / 200;\n\n\t\t// compute xyz\n\t\t// prettier-ignore\n\t\tlet xyz = [\n\t\t\tf[0]   > ε3 ? Math.pow(f[0], 3)                : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8  ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2]   > ε3 ? Math.pow(f[2], 3)                : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\tlab: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import * as util from \"./util.js\";\n\n/**\n * Constrain an angle to 360 degrees\n * @param {number} angle\n * @returns {number}\n */\nexport function constrain (angle) {\n\tif (typeof angle !== \"number\") {\n\t\treturn angle;\n\t}\n\n\treturn ((angle % 360) + 360) % 360;\n}\n\n/**\n * @param {\"raw\" | \"increasing\" | \"decreasing\" | \"longer\" | \"shorter\"} arc\n * @param {[number, number]} angles\n * @returns {[number, number]}\n */\nexport function adjust (arc, angles) {\n\tlet [a1, a2] = angles;\n\n\tlet none1 = util.isNone(a1);\n\tlet none2 = util.isNone(a2);\n\n\tif (none1 && none2) {\n\t\treturn [a1, a2];\n\t}\n\telse if (none1) {\n\t\ta1 = a2;\n\t}\n\telse if (none2) {\n\t\ta2 = a1;\n\t}\n\n\tif (arc === \"raw\") {\n\t\treturn angles;\n\t}\n\n\ta1 = constrain(a1);\n\ta2 = constrain(a2);\n\n\tlet angleDiff = a2 - a1;\n\n\tif (arc === \"increasing\") {\n\t\tif (angleDiff < 0) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\telse if (arc === \"decreasing\") {\n\t\tif (angleDiff > 0) {\n\t\t\ta1 += 360;\n\t\t}\n\t}\n\telse if (arc === \"longer\") {\n\t\tif (-180 < angleDiff && angleDiff < 180) {\n\t\t\tif (angleDiff > 0) {\n\t\t\t\ta1 += 360;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ta2 += 360;\n\t\t\t}\n\t\t}\n\t}\n\telse if (arc === \"shorter\") {\n\t\tif (angleDiff > 180) {\n\t\t\ta1 += 360;\n\t\t}\n\t\telse if (angleDiff < -180) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\n\treturn [a1, a2];\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport Lab from \"./lab.js\";\nimport { constrain as constrainAngle } from \"../angles.js\";\nimport { isNone } from \"../util.js\";\n\nexport default new ColorSpace({\n\tid: \"lch\",\n\tname: \"LCH\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 150],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Lab,\n\tfromBase (Lab) {\n\t\t// These methods are used for other polar forms as well, so we can't hardcode the ε\n\t\tif (this.ε === undefined) {\n\t\t\t// @ts-expect-error Property 'coords' does not exist on type 'string | ColorSpace'\n\t\t\tlet range = Object.values(this.base.coords)[1].refRange;\n\t\t\tlet extent = range[1] - range[0];\n\t\t\tthis.ε = extent / 100000;\n\t\t}\n\n\t\t// Convert to polar form\n\t\tlet [L, a, b] = Lab;\n\t\tlet isAchromatic = Math.abs(a) < this.ε && Math.abs(b) < this.ε;\n\t\tlet h = isAchromatic ? null : constrainAngle((Math.atan2(b, a) * 180) / Math.PI);\n\t\tlet C = isAchromatic ? 0 : Math.sqrt(a ** 2 + b ** 2);\n\n\t\treturn [L, C, h];\n\t},\n\ttoBase (lch) {\n\t\t// Convert from polar form\n\t\tlet [L, C, h] = lch;\n\t\tlet a = null,\n\t\t\tb = null;\n\n\t\tif (!isNone(h)) {\n\t\t\tC = C < 0 ? 0 : C; // Clamp negative Chroma\n\t\t\ta = C * Math.cos((h * Math.PI) / 180);\n\t\t\tb = C * Math.sin((h * Math.PI) / 180);\n\t\t}\n\n\t\treturn [L, a, b];\n\t},\n\n\tformats: {\n\t\tlch: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import defaults from \"../defaults.js\";\nimport lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\n\n// deltaE2000 is a statistically significant improvement\n// and is recommended by the CIE and Idealliance\n// especially for color differences less than 10 deltaE76\n// but is wicked complicated\n// and many implementations have small errors!\n// DeltaE2000 is also discontinuous; in case this\n// matters to you, use deltaECMC instead.\n\nconst Gfactor = 25 ** 7;\nconst π = Math.PI;\nconst r2d = 180 / π;\nconst d2r = π / 180;\n\nfunction pow7 (x) {\n\t// Faster than x ** 7 or Math.pow(x, 7)\n\n\tconst x2 = x * x;\n\tconst x7 = x2 * x2 * x2 * x;\n\n\treturn x7;\n}\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @param {{ kL?: number | undefined; kC?: number | undefined; kH?: number | undefined }} options\n * @returns {number}\n */\nexport default function (color, sample, { kL = 1, kC = 1, kH = 1 } = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and the function parameter as the sample,\n\t// calculate deltaE 2000.\n\n\t// This implementation assumes the parametric\n\t// weighting factors kL, kC and kH\n\t// for the influence of viewing conditions\n\t// are all 1, as sadly seems typical.\n\t// kL should be increased for lightness texture or noise\n\t// and kC increased for chroma noise\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet C1 = lch.from(lab, [L1, a1, b1])[1];\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\tlet Cbar = (C1 + C2) / 2; // mean Chroma\n\n\t// calculate a-axis asymmetry factor from mean Chroma\n\t// this turns JND ellipses for near-neutral colors back into circles\n\tlet C7 = pow7(Cbar);\n\n\tlet G = 0.5 * (1 - Math.sqrt(C7 / (C7 + Gfactor)));\n\n\t// scale a axes by asymmetry factor\n\t// this by the way is why there is no Lab2000 colorspace\n\tlet adash1 = (1 + G) * a1;\n\tlet adash2 = (1 + G) * a2;\n\n\t// calculate new Chroma from scaled a and original b axes\n\tlet Cdash1 = Math.sqrt(adash1 ** 2 + b1 ** 2);\n\tlet Cdash2 = Math.sqrt(adash2 ** 2 + b2 ** 2);\n\n\t// calculate new hues, with zero hue for true neutrals\n\t// and in degrees, not radians\n\n\tlet h1 = adash1 === 0 && b1 === 0 ? 0 : Math.atan2(b1, adash1);\n\tlet h2 = adash2 === 0 && b2 === 0 ? 0 : Math.atan2(b2, adash2);\n\n\tif (h1 < 0) {\n\t\th1 += 2 * π;\n\t}\n\tif (h2 < 0) {\n\t\th2 += 2 * π;\n\t}\n\n\th1 *= r2d;\n\th2 *= r2d;\n\n\t// Lightness and Chroma differences; sign matters\n\tlet ΔL = L2 - L1;\n\tlet ΔC = Cdash2 - Cdash1;\n\n\t// Hue difference, getting the sign correct\n\tlet hdiff = h2 - h1;\n\tlet hsum = h1 + h2;\n\tlet habs = Math.abs(hdiff);\n\tlet Δh;\n\n\tif (Cdash1 * Cdash2 === 0) {\n\t\tΔh = 0;\n\t}\n\telse if (habs <= 180) {\n\t\tΔh = hdiff;\n\t}\n\telse if (hdiff > 180) {\n\t\tΔh = hdiff - 360;\n\t}\n\telse if (hdiff < -180) {\n\t\tΔh = hdiff + 360;\n\t}\n\telse {\n\t\tdefaults.warn(\"the unthinkable has happened\");\n\t}\n\n\t// weighted Hue difference, more for larger Chroma\n\tlet ΔH = 2 * Math.sqrt(Cdash2 * Cdash1) * Math.sin((Δh * d2r) / 2);\n\n\t// calculate mean Lightness and Chroma\n\tlet Ldash = (L1 + L2) / 2;\n\tlet Cdash = (Cdash1 + Cdash2) / 2;\n\tlet Cdash7 = pow7(Cdash);\n\n\t// Compensate for non-linearity in the blue region of Lab.\n\t// Four possibilities for hue weighting factor,\n\t// depending on the angles, to get the correct sign\n\tlet hdash;\n\tif (Cdash1 * Cdash2 === 0) {\n\t\thdash = hsum; // which should be zero\n\t}\n\telse if (habs <= 180) {\n\t\thdash = hsum / 2;\n\t}\n\telse if (hsum < 360) {\n\t\thdash = (hsum + 360) / 2;\n\t}\n\telse {\n\t\thdash = (hsum - 360) / 2;\n\t}\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor\n\t// a background with L=50 is assumed\n\tlet lsq = (Ldash - 50) ** 2;\n\tlet SL = 1 + (0.015 * lsq) / Math.sqrt(20 + lsq);\n\n\t// SC Chroma factor, similar to those in CMC and deltaE 94 formulae\n\tlet SC = 1 + 0.045 * Cdash;\n\n\t// Cross term T for blue non-linearity\n\tlet T = 1;\n\tT -= 0.17 * Math.cos((hdash - 30) * d2r);\n\tT += 0.24 * Math.cos(2 * hdash * d2r);\n\tT += 0.32 * Math.cos((3 * hdash + 6) * d2r);\n\tT -= 0.2 * Math.cos((4 * hdash - 63) * d2r);\n\n\t// SH Hue factor depends on Chroma,\n\t// as well as adjusted hue angle like deltaE94.\n\tlet SH = 1 + 0.015 * Cdash * T;\n\n\t// RT Hue rotation term compensates for rotation of JND ellipses\n\t// and Munsell constant hue lines\n\t// in the medium-high Chroma blue region\n\t// (Hue 225 to 315)\n\tlet Δθ = 30 * Math.exp(-1 * ((hdash - 275) / 25) ** 2);\n\tlet RC = 2 * Math.sqrt(Cdash7 / (Cdash7 + Gfactor));\n\tlet RT = -1 * Math.sin(2 * Δθ * d2r) * RC;\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (kL * SL)) ** 2;\n\tdE += (ΔC / (kC * SC)) ** 2;\n\tdE += (ΔH / (kH * SH)) ** 2;\n\tdE += RT * (ΔC / (kC * SC)) * (ΔH / (kH * SH));\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// Recalculated for consistent reference white\n// see https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-943521484\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoLMS_M = [\n\t[ 0.8190224379967030, 0.3619062600528904, -0.1288737815209879 ],\n\t[ 0.0329836539323885, 0.9292868615863434,  0.0361446663506424 ],\n\t[ 0.0481771893596242, 0.2642395317527308,  0.6335478284694309 ],\n];\n// inverse of XYZtoLMS_M\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoXYZ_M = [\n\t[  1.2268798758459243, -0.5578149944602171,  0.2813910456659647 ],\n\t[ -0.0405757452148008,  1.1122868032803170, -0.0717110580655164 ],\n\t[ -0.0763729366746601, -0.4214933324022432,  1.5869240198367816 ],\n];\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const LMStoLab_M = [\n\t[ 0.2104542683093140,  0.7936177747023054, -0.0040720430116193 ],\n\t[ 1.9779985324311684, -2.4285922420485799,  0.4505937096174110 ],\n\t[ 0.0259040424655478,  0.7827717124575296, -0.8086757549230774 ],\n];\n// LMStoIab_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const LabtoLMS_M = [\n\t[ 1.0000000000000000,  0.3963377773761749,  0.2158037573099136 ],\n\t[ 1.0000000000000000, -0.1055613458156586, -0.0638541728258133 ],\n\t[ 1.0000000000000000, -0.0894841775298119, -1.2914855480194092 ],\n];\n\nexport default new ColorSpace({\n\tid: \"oklab\",\n\tname: \"Oklab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t},\n\n\t// Note that XYZ is relative to D65\n\twhite: \"D65\",\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3(XYZ, XYZtoLMS_M);\n\n\t\t// non-linearity\n\t\tLMS[0] = Math.cbrt(LMS[0]);\n\t\tLMS[1] = Math.cbrt(LMS[1]);\n\t\tLMS[2] = Math.cbrt(LMS[2]);\n\n\t\treturn multiply_v3_m3x3(LMS, LMStoLab_M, LMS);\n\t},\n\ttoBase (OKLab) {\n\t\t// move to LMS cone domain\n\t\tlet LMSg = multiply_v3_m3x3(OKLab, LabtoLMS_M);\n\n\t\t// restore linearity\n\t\tLMSg[0] = LMSg[0] ** 3;\n\t\tLMSg[1] = LMSg[1] ** 3;\n\t\tLMSg[2] = LMSg[2] ** 3;\n\n\t\treturn multiply_v3_m3x3(LMSg, LMStoXYZ_M, LMSg);\n\t},\n\n\tformats: {\n\t\toklab: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in CIE Lab\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK, term by term as root sum of squares\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\nconst ε = 0.000075;\n\n/**\n * Check if a color is in gamut of either its own or another color space\n * @param {ColorTypes} color\n * @param {string | ColorSpace} [space]\n * @param {{ epsilon?: number | undefined }} [param2]\n * @returns {boolean}\n */\nexport default function inGamut (color, space, { epsilon = ε } = {}) {\n\tcolor = getColor(color);\n\n\tif (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tlet coords = color.coords;\n\n\tif (space !== color.space) {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn space.inGamut(coords, { epsilon });\n}\n","/** @import { Coords, PlainColorObject } from \"./types.js\" */\n\n/**\n * @param {PlainColorObject} color\n * @returns {PlainColorObject}\n */\nexport default function clone (color) {\n\treturn {\n\t\tspace: color.space,\n\t\tcoords: /** @type {Coords} */ (color.coords.slice()),\n\t\talpha: color.alpha,\n\t};\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport { isNone } from \"./util.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n/**\n * Euclidean distance of colors in an arbitrary color space\n * @param {ColorTypes} color1\n * @param {ColorTypes} color2\n * @param {string | ColorSpace} space\n * @returns {number}\n */\nexport default function distance (color1, color2, space = \"lab\") {\n\tspace = ColorSpace.get(space);\n\n\t// Assume getColor() is called on color in space.from()\n\tlet coords1 = space.from(color1);\n\tlet coords2 = space.from(color2);\n\n\treturn Math.sqrt(\n\t\tcoords1.reduce((acc, c1, i) => {\n\t\t\tlet c2 = coords2[i];\n\t\t\tif (isNone(c1) || isNone(c2)) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn acc + (c2 - c1) ** 2;\n\t\t}, 0),\n\t);\n}\n","import distance from \"../distance.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function deltaE76 (color, sample) {\n\t// Assume getColor() is called in the distance function\n\treturn distance(color, sample, \"lab\");\n}\n","import lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\nimport { isNone } from \"../util.js\";\n\n// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in Lab\n\n// CMC by the Color Measurement Committee of the\n// Bradford Society of Dyeists and Colorsts, 1994.\n// Uses LCH rather than Lab,\n// with different weights for L, C and H differences\n// A nice increase in accuracy for modest increase in complexity\nconst π = Math.PI;\nconst d2r = π / 180;\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @param {{ l?: number | undefined; c?: number | undefined }} options\n * @returns {number}\n */\nexport default function (color, sample, { l = 2, c = 1 } = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE CMC.\n\n\t// This implementation assumes the parametric\n\t// weighting factors l:c are 2:1\n\t// which is typical for non-textile uses.\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet [, C1, H1] = lch.from(lab, [L1, a1, b1]);\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// let [L1, a1, b1] = color.getAll(lab);\n\t// let C1 = color.get(\"lch.c\");\n\t// let H1 = color.get(\"lch.h\");\n\t// let [L2, a2, b2] = sample.getAll(lab);\n\t// let C2 = sample.get(\"lch.c\");\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\t// we don't need H2 as ΔH is calculated from Δa, Δb and ΔC\n\n\t// Lightness and Chroma differences\n\t// These are (color - sample), unlike deltaE2000\n\tlet ΔL = L1 - L2;\n\tlet ΔC = C1 - C2;\n\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\n\t// weighted Hue difference, less for larger Chroma difference\n\n\tlet H2 = Δa ** 2 + Δb ** 2 - ΔC ** 2;\n\t// due to roundoff error it is possible that, for zero a and b,\n\t// ΔC > Δa + Δb is 0, resulting in attempting\n\t// to take the square root of a negative number\n\n\t// trying instead the equation from Industrial Color Physics\n\t// By Georg A. Klein\n\n\t// let ΔH = ((a1 * b2) - (a2 * b1)) / Math.sqrt(0.5 * ((C2 * C1) + (a2 * a1) + (b2 * b1)));\n\t// console.log({ΔH});\n\t// This gives the same result to 12 decimal places\n\t// except it sometimes NaNs when trying to root a negative number\n\n\t// let ΔH = Math.sqrt(H2); we never actually use the root, it gets squared again!!\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor, depends entirely on L1 not L2\n\tlet SL = 0.511; // linear portion of the Y to L transfer function\n\tif (L1 >= 16) {\n\t\t// cubic portion\n\t\tSL = (0.040975 * L1) / (1 + 0.01765 * L1);\n\t}\n\n\t// SC Chroma factor\n\tlet SC = (0.0638 * C1) / (1 + 0.0131 * C1) + 0.638;\n\n\t// Cross term T for blue non-linearity\n\tlet T;\n\tif (isNone(H1)) {\n\t\tH1 = 0;\n\t}\n\n\tif (H1 >= 164 && H1 <= 345) {\n\t\tT = 0.56 + Math.abs(0.2 * Math.cos((H1 + 168) * d2r));\n\t}\n\telse {\n\t\tT = 0.36 + Math.abs(0.4 * Math.cos((H1 + 35) * d2r));\n\t}\n\t// console.log({T});\n\n\t// SH Hue factor also depends on C1,\n\tlet C4 = Math.pow(C1, 4);\n\tlet F = Math.sqrt(C4 / (C4 + 1900));\n\tlet SH = SC * (F * T + 1 - F);\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (l * SL)) ** 2;\n\tdE += (ΔC / (c * SC)) ** 2;\n\tdE += H2 / SH ** 2;\n\t// dE += (ΔH / SH)  ** 2;\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nconst Yw = 203; // absolute luminance of media white\n\nexport default new ColorSpace({\n\t// Absolute CIE XYZ, with a D65 whitepoint,\n\t// as used in most HDR colorspaces as a starting point.\n\t// SDR spaces are converted per BT.2048\n\t// so that diffuse, media white is 203 cd/m²\n\tid: \"xyz-abs-d65\",\n\tcssId: \"--xyz-abs-d65\",\n\tname: \"Absolute XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 9504.7],\n\t\t\tname: \"Xa\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 10000],\n\t\t\tname: \"Ya\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 10888.3],\n\t\t\tname: \"Za\",\n\t\t},\n\t},\n\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// Make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\treturn XYZ.map(v => v * Yw);\n\t},\n\ttoBase (AbsXYZ) {\n\t\t// Convert to media-white relative XYZ\n\t\treturn AbsXYZ.map(v => v / Yw);\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\nimport { spow } from \"../util.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\nconst b = 1.15;\nconst g = 0.66;\nconst n = 2610 / 2 ** 14;\nconst ninv = 2 ** 14 / 2610;\nconst c1 = 3424 / 2 ** 12;\nconst c2 = 2413 / 2 ** 7;\nconst c3 = 2392 / 2 ** 7;\nconst p = (1.7 * 2523) / 2 ** 5;\nconst pinv = 2 ** 5 / (1.7 * 2523);\nconst d = -0.56;\nconst d0 = 1.6295499532821566e-11;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoCone_M = [\n\t[  0.41478972, 0.579999,  0.0146480 ],\n\t[ -0.2015100,  1.120649,  0.0531008 ],\n\t[ -0.0166008,  0.264800,  0.6684799 ],\n];\n// XYZtoCone_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst ConetoXYZ_M = [\n\t[  1.9242264357876067,  -1.0047923125953657,  0.037651404030618   ],\n\t[  0.35031676209499907,  0.7264811939316552, -0.06538442294808501 ],\n\t[ -0.09098281098284752, -0.3127282905230739,  1.5227665613052603  ],\n];\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst ConetoIab_M = [\n\t[  0.5,       0.5,       0        ],\n\t[  3.524000, -4.066708,  0.542708 ],\n\t[  0.199076,  1.096799, -1.295875 ],\n];\n// ConetoIab_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst IabtoCone_M = [\n\t[ 1,                   0.13860504327153927,   0.05804731615611883 ],\n\t[ 1,                  -0.1386050432715393,   -0.058047316156118904 ],\n\t[ 1,                  -0.09601924202631895,  -0.81189189605603900  ],\n];\n\nexport default new ColorSpace({\n\tid: \"jzazbz\",\n\tname: \"Jzazbz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\taz: {\n\t\t\trefRange: [-0.21, 0.21],\n\t\t},\n\t\tbz: {\n\t\t\trefRange: [-0.21, 0.21],\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// First make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\t// BT.2048 says media white Y=203 at PQ 58\n\n\t\tlet [Xa, Ya, Za] = XYZ;\n\n\t\t// modify X and Y to minimize blue curvature\n\t\tlet Xm = b * Xa - (b - 1) * Za;\n\t\tlet Ym = g * Ya - (g - 1) * Xa;\n\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3([Xm, Ym, Za], XYZtoCone_M);\n\n\t\t// PQ-encode LMS\n\t\tlet PQLMS = /** @type {Vector3} } */ (\n\t\t\tLMS.map(function (val) {\n\t\t\t\tlet num = c1 + c2 * spow(val / 10000, n);\n\t\t\t\tlet denom = 1 + c3 * spow(val / 10000, n);\n\n\t\t\t\treturn spow(num / denom, p);\n\t\t\t})\n\t\t);\n\n\t\t// almost there, calculate Iz az bz\n\t\tlet [Iz, az, bz] = multiply_v3_m3x3(PQLMS, ConetoIab_M);\n\t\t// console.log({Iz, az, bz});\n\n\t\tlet Jz = ((1 + d) * Iz) / (1 + d * Iz) - d0;\n\t\treturn [Jz, az, bz];\n\t},\n\ttoBase (Jzazbz) {\n\t\tlet [Jz, az, bz] = Jzazbz;\n\t\tlet Iz = (Jz + d0) / (1 + d - d * (Jz + d0));\n\n\t\t// bring into LMS cone domain\n\t\tlet PQLMS = multiply_v3_m3x3([Iz, az, bz], IabtoCone_M);\n\n\t\t// convert from PQ-coded to linear-light\n\t\tlet LMS = /** @type {Vector3} } */ (\n\t\t\tPQLMS.map(function (val) {\n\t\t\t\tlet num = c1 - spow(val, pinv);\n\t\t\t\tlet denom = c3 * spow(val, pinv) - c2;\n\t\t\t\tlet x = 10000 * spow(num / denom, ninv);\n\n\t\t\t\treturn x; // luminance relative to diffuse white, [0, 70 or so].\n\t\t\t})\n\t\t);\n\n\t\t// modified abs XYZ\n\t\tlet [Xm, Ym, Za] = multiply_v3_m3x3(LMS, ConetoXYZ_M);\n\n\t\t// un-modify X and Y to get D65 XYZ, relative to media white\n\t\tlet Xa = (Xm + (b - 1) * Za) / b;\n\t\tlet Ya = (Ym + (g - 1) * Xa) / g;\n\t\treturn [Xa, Ya, Za];\n\t},\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#Jzazbz\n\t\tjzazbz: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport Jzazbz from \"./jzazbz.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"jzczhz\",\n\tname: \"JzCzHz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\tcz: {\n\t\t\trefRange: [0, 0.26],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\thz: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Jzazbz,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#JzCzhz\n\t\tjzczhz: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import jzczhz from \"../spaces/jzczhz.js\";\nimport getColor from \"../getColor.js\";\nimport { isNone } from \"../util.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in Lab\n *\n * Uses JzCzHz, which has improved perceptual uniformity\n * and thus a simple Euclidean root-sum of ΔL² ΔC² ΔH²\n * gives good results.\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in JzCzHz.\n\tlet [Jz1, Cz1, Hz1] = jzczhz.from(color);\n\tlet [Jz2, Cz2, Hz2] = jzczhz.from(sample);\n\n\t// Lightness and Chroma differences\n\t// sign does not matter as they are squared.\n\tlet ΔJ = Jz1 - Jz2;\n\tlet ΔC = Cz1 - Cz2;\n\n\t// length of chord for ΔH\n\tif (isNone(Hz1) && isNone(Hz2)) {\n\t\t// both undefined hues\n\t\tHz1 = 0;\n\t\tHz2 = 0;\n\t}\n\telse if (isNone(Hz1)) {\n\t\t// one undefined, set to the defined hue\n\t\tHz1 = Hz2;\n\t}\n\telse if (isNone(Hz2)) {\n\t\tHz2 = Hz1;\n\t}\n\n\tlet Δh = Hz1 - Hz2;\n\tlet ΔH = 2 * Math.sqrt(Cz1 * Cz2) * Math.sin((Δh / 2) * (Math.PI / 180));\n\n\treturn Math.sqrt(ΔJ ** 2 + ΔC ** 2 + ΔH ** 2);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\nconst c1 = 3424 / 4096;\nconst c2 = 2413 / 128;\nconst c3 = 2392 / 128;\nconst m1 = 2610 / 16384;\nconst m2 = 2523 / 32;\nconst im1 = 16384 / 2610;\nconst im2 = 32 / 2523;\n\n// The matrix below includes the 4% crosstalk components\n// and is from the Dolby \"What is ICtCp\" paper\"\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoLMS_M = [\n\t[  0.3592832590121217,  0.6976051147779502, -0.0358915932320290 ],\n\t[ -0.1920808463704993,  1.1004767970374321,  0.0753748658519118 ],\n\t[  0.0070797844607479,  0.0748396662186362,  0.8433265453898765 ],\n];\n// linear-light Rec.2020 to LMS, again with crosstalk\n// rational terms from Jan Fröhlich,\n// Encoding High Dynamic Range andWide Color Gamut Imagery, p.97\n// and ITU-R BT.2124-0 p.2\n/*\nconst Rec2020toLMS_M = [\n\t[ 1688 / 4096,  2146 / 4096,   262 / 4096 ],\n\t[  683 / 4096,  2951 / 4096,   462 / 4096 ],\n\t[   99 / 4096,   309 / 4096,  3688 / 4096 ]\n];\n*/\n// this includes the Ebner LMS coefficients,\n// the rotation, and the scaling to [-0.5,0.5] range\n// rational terms from Fröhlich p.97\n// and ITU-R BT.2124-0 pp.2-3\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoIPT_M = [\n\t[  2048 / 4096,   2048 / 4096,       0      ],\n\t[  6610 / 4096, -13613 / 4096,  7003 / 4096 ],\n\t[ 17933 / 4096, -17390 / 4096,  -543 / 4096 ],\n];\n\n// inverted matrices, calculated from the above\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst IPTtoLMS_M = [\n\t[ 0.9999999999999998,  0.0086090370379328,  0.1110296250030260 ],\n\t[ 0.9999999999999998, -0.0086090370379328, -0.1110296250030259 ],\n\t[ 0.9999999999999998,  0.5600313357106791, -0.3206271749873188 ],\n];\n/*\n// prettier-ignore\nconst LMStoRec2020_M = [\n\t[ 3.4375568932814012112,   -2.5072112125095058195,   0.069654319228104608382],\n\t[-0.79142868665644156125,   1.9838372198740089874,  -0.19240853321756742626 ],\n\t[-0.025646662911506476363, -0.099240248643945566751, 1.1248869115554520431  ]\n];\n*/\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoXYZ_M = [\n\t[  2.0701522183894223, -1.3263473389671563,  0.2066510476294053 ],\n\t[  0.3647385209748072,  0.6805660249472273, -0.0453045459220347 ],\n\t[ -0.0497472075358123, -0.0492609666966131,  1.1880659249923042 ],\n];\n\n// Only the PQ form of ICtCp is implemented here. There is also an HLG form.\n// from Dolby, \"WHAT IS ICTCP?\"\n// https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf\n// and\n// Dolby, \"Perceptual Color Volume\n// Measuring the Distinguishable Colors of HDR and WCG Displays\"\n// https://professional.dolby.com/siteassets/pdfs/dolby-vision-measuring-perceptual-color-volume-v7.1.pdf\nexport default new ColorSpace({\n\tid: \"ictcp\",\n\tname: \"ICTCP\",\n\t// From BT.2100-2 page 7:\n\t// During production, signal values are expected to exceed the\n\t// range E′ = [0.0 : 1.0]. This provides processing headroom and avoids\n\t// signal degradation during cascaded processing. Such values of E′,\n\t// below 0.0 or exceeding 1.0, should not be clipped during production\n\t// and exchange.\n\t// Values below 0.0 should not be clipped in reference displays (even\n\t// though they represent “negative” light) to allow the black level of\n\t// the signal (LB) to be properly set using test signals known as “PLUGE”\n\tcoords: {\n\t\ti: {\n\t\t\trefRange: [0, 1], // Constant luminance,\n\t\t\tname: \"I\",\n\t\t},\n\t\tct: {\n\t\t\trefRange: [-0.5, 0.5], // Full BT.2020 gamut in range [-0.5, 0.5]\n\t\t\tname: \"CT\",\n\t\t},\n\t\tcp: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t\tname: \"CP\",\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3(XYZ, XYZtoLMS_M);\n\n\t\treturn LMStoICtCp(LMS);\n\t},\n\ttoBase (ICtCp) {\n\t\tlet LMS = ICtCptoLMS(ICtCp);\n\n\t\treturn multiply_v3_m3x3(LMS, LMStoXYZ_M);\n\t},\n\n\tformats: {\n\t\tictcp: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n\n/**\n *\n * @param {Vector3} LMS\n * @returns {Vector3}\n */\nfunction LMStoICtCp (LMS) {\n\t// apply the PQ EOTF\n\t// we can't ever be dividing by zero because of the \"1 +\" in the denominator\n\tlet PQLMS = /** @type {Vector3} */ (\n\t\tLMS.map(function (val) {\n\t\t\tlet num = c1 + c2 * (val / 10000) ** m1;\n\t\t\tlet denom = 1 + c3 * (val / 10000) ** m1;\n\n\t\t\treturn (num / denom) ** m2;\n\t\t})\n\t);\n\n\t// LMS to IPT, with rotation for Y'C'bC'r compatibility\n\treturn multiply_v3_m3x3(PQLMS, LMStoIPT_M);\n}\n\n/**\n *\n * @param {Vector3} ICtCp\n * @returns {Vector3}\n */\nfunction ICtCptoLMS (ICtCp) {\n\tlet PQLMS = multiply_v3_m3x3(ICtCp, IPTtoLMS_M);\n\n\t// From BT.2124-0 Annex 2 Conversion 3\n\tlet LMS = /** @type {Vector3} */ (\n\t\tPQLMS.map(function (val) {\n\t\t\tlet num = Math.max(val ** im2 - c1, 0);\n\t\t\tlet denom = c2 - c3 * val ** im2;\n\t\t\treturn 10000 * (num / denom) ** im1;\n\t\t})\n\t);\n\n\treturn LMS;\n}\n","import ictcp from \"../spaces/ictcp.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * Delta E in ICtCp space,\n * which the ITU calls Delta E ITP, which is shorter.\n * Formulae from ITU Rec. ITU-R BT.2124-0\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in ICtCp\n\t// which is simply the Euclidean distance\n\n\tlet [I1, T1, P1] = ictcp.from(color);\n\tlet [I2, T2, P2] = ictcp.from(sample);\n\n\t// the 0.25 factor is to undo the encoding scaling in Ct\n\t// the 720 is so that 1 deltaE = 1 JND\n\t// per  ITU-R BT.2124-0 p.3\n\n\treturn 720 * Math.sqrt((I1 - I2) ** 2 + 0.25 * (T1 - T2) ** 2 + (P1 - P2) ** 2);\n}\n","import oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in CIE Lab\n * The Oklab a and b axes are scaled relative to the L axis, for better uniformity\n * Björn Ottosson said:\n * \"I've recently done some tests with color distance datasets as implemented\n * in Colorio and on both the Combvd dataset and the OSA-UCS dataset a\n * scale factor of slightly more than 2 for a and b would give the best results\n * (2.016 works best for Combvd and 2.045 for the OSA-UCS dataset).\"\n * @see {@link <https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-945714988>}\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK2, term by term as root sum of squares\n\tlet abscale = 2;\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = abscale * (a1 - a2);\n\tlet Δb = abscale * (b1 - b2);\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3, interpolate, copySign, spow, zdiv, bisectLeft } from \"../util.js\";\nimport { constrain } from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport { WHITES } from \"../adapt.js\";\n\n/** @import { Coords, Matrix3x3, Vector3 } from \"../types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"../types.js\").Cam16Object} Cam16Object */\n/** @typedef {import(\"../types.js\").Cam16Input} Cam16Input */\n/** @typedef {import(\"../types.js\").Cam16Environment} Cam16Environment */\n\nconst white = WHITES.D65;\nconst adaptedCoef = 0.42;\nconst adaptedCoefInv = 1 / adaptedCoef;\nconst tau = 2 * Math.PI;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst cat16 = [\n\t[  0.401288,  0.650173, -0.051461 ],\n\t[ -0.250268,  1.204414,  0.045854 ],\n\t[ -0.002079,  0.048952,  0.953127 ],\n];\n\n/** @type {Matrix3x3} */\nconst cat16Inv = [\n\t[1.8620678550872327, -1.0112546305316843, 0.14918677544445175],\n\t[0.38752654323613717, 0.6214474419314753, -0.008973985167612518],\n\t[-0.015841498849333856, -0.03412293802851557, 1.0499644368778496],\n];\n\n/** @type {Matrix3x3} */\nconst m1 = [\n\t[460.0, 451.0, 288.0],\n\t[460.0, -891.0, -261.0],\n\t[460.0, -220.0, -6300.0],\n];\n\nconst surroundMap = {\n\tdark: [0.8, 0.525, 0.8],\n\tdim: [0.9, 0.59, 0.9],\n\taverage: [1, 0.69, 1],\n};\n\nconst hueQuadMap = {\n\t// Red, Yellow, Green, Blue, Red\n\th: [20.14, 90.0, 164.25, 237.53, 380.14],\n\te: [0.8, 0.7, 1.0, 1.2, 0.8],\n\tH: [0.0, 100.0, 200.0, 300.0, 400.0],\n};\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\n\n/**\n * @param {Coords} coords\n * @param {number} fl\n * @returns {[number, number, number]}\n */\nexport function adapt (coords, fl) {\n\tconst temp = /** @type {[number, number, number]} */ (\n\t\tcoords.map(c => {\n\t\t\tconst x = spow(fl * Math.abs(c) * 0.01, adaptedCoef);\n\t\t\treturn (400 * copySign(x, c)) / (x + 27.13);\n\t\t})\n\t);\n\treturn temp;\n}\n\n/**\n * @param {Coords} adapted\n * @param {number} fl\n * @returns {[number, number, number]}\n */\nexport function unadapt (adapted, fl) {\n\tconst constant = (100 / fl) * 27.13 ** adaptedCoefInv;\n\treturn /** @type {[number, number, number]} */ (\n\t\tadapted.map(c => {\n\t\t\tconst cabs = Math.abs(c);\n\t\t\treturn copySign(constant * spow(cabs / (400 - cabs), adaptedCoefInv), c);\n\t\t})\n\t);\n}\n\n/**\n * @param {number} h\n */\nexport function hueQuadrature (h) {\n\tlet hp = constrain(h);\n\tif (hp <= hueQuadMap.h[0]) {\n\t\thp += 360;\n\t}\n\n\tconst i = bisectLeft(hueQuadMap.h, hp) - 1;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\tconst Hi = hueQuadMap.H[i];\n\n\tconst t = (hp - hi) / ei;\n\treturn Hi + (100 * t) / (t + (hii - hp) / eii);\n}\n\n/**\n * @param {number} H\n */\nexport function invHueQuadrature (H) {\n\tlet Hp = ((H % 400) + 400) % 400;\n\tconst i = Math.floor(0.01 * Hp);\n\tHp = Hp % 100;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\n\treturn constrain((Hp * (eii * hi - ei * hii) - 100 * hi * eii) / (Hp * (eii - ei) - 100 * eii));\n}\n\n/**\n * @param {[number, number, number]} refWhite\n * @param {number} adaptingLuminance\n * @param {number} backgroundLuminance\n * @param {keyof typeof surroundMap} surround\n * @param {boolean} discounting\n * @returns {Cam16Environment}\n */\nexport function environment (\n\trefWhite,\n\tadaptingLuminance,\n\tbackgroundLuminance,\n\tsurround,\n\tdiscounting,\n) {\n\tconst env = {};\n\n\tenv.discounting = discounting;\n\tenv.refWhite = refWhite;\n\tenv.surround = surround;\n\tconst xyzW = /** @type {Vector3} */ (\n\t\trefWhite.map(c => {\n\t\t\treturn c * 100;\n\t\t})\n\t);\n\n\t// The average luminance of the environment in `cd/m^2cd/m` (a.k.a. nits)\n\tenv.la = adaptingLuminance;\n\t// The relative luminance of the nearby background\n\tenv.yb = backgroundLuminance;\n\t// Absolute luminance of the reference white.\n\tconst yw = xyzW[1];\n\n\t// Cone response for reference white\n\tconst rgbW = multiply_v3_m3x3(xyzW, cat16);\n\n\t// Surround: dark, dim, and average\n\tlet values = surroundMap[env.surround];\n\tconst f = values[0];\n\tenv.c = values[1];\n\tenv.nc = values[2];\n\n\tconst k = 1 / (5 * env.la + 1);\n\tconst k4 = k ** 4;\n\n\t// Factor of luminance level adaptation\n\tenv.fl = k4 * env.la + 0.1 * (1 - k4) * (1 - k4) * Math.cbrt(5 * env.la);\n\tenv.flRoot = env.fl ** 0.25;\n\n\tenv.n = env.yb / yw;\n\tenv.z = 1.48 + Math.sqrt(env.n);\n\tenv.nbb = 0.725 * env.n ** -0.2;\n\tenv.ncb = env.nbb;\n\n\t// Degree of adaptation calculating if not discounting\n\t// illuminant (assumed eye is fully adapted)\n\tconst d = discounting\n\t\t? 1\n\t\t: Math.max(Math.min(f * (1 - (1 / 3.6) * Math.exp((-env.la - 42) / 92)), 1), 0);\n\tenv.dRgb = /** @type {[number, number, number]} */ (\n\t\trgbW.map(c => {\n\t\t\treturn interpolate(1, yw / c, d);\n\t\t})\n\t);\n\tenv.dRgbInv = /** @type {[number, number, number]} */ (\n\t\tenv.dRgb.map(c => {\n\t\t\treturn 1 / c;\n\t\t})\n\t);\n\n\t// Achromatic response\n\tconst rgbCW = /** @type {[number, number, number]} */ (\n\t\trgbW.map((c, i) => {\n\t\t\treturn c * env.dRgb[i];\n\t\t})\n\t);\n\tconst rgbAW = adapt(rgbCW, env.fl);\n\tenv.aW = env.nbb * (2 * rgbAW[0] + rgbAW[1] + 0.05 * rgbAW[2]);\n\n\t// console.log(env);\n\n\treturn env;\n}\n\n// Pre-calculate everything we can with the viewing conditions\nconst viewingConditions = environment(white, (64 / Math.PI) * 0.2, 20, \"average\", false);\n\n/**\n * @param {Cam16Input} cam16\n * @param {Cam16Environment} env\n * @returns {[number, number, number]}\n */\nexport function fromCam16 (cam16, env) {\n\t// These check ensure one, and only one attribute for a\n\t// given category is provided.\n\t// @ts-expect-error The '^` operator is not allowed for boolean types\n\tif (!((cam16.J !== undefined) ^ (cam16.Q !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'J' or 'Q'\");\n\t}\n\n\t// @ts-expect-error - The '^` operator is not allowed for boolean types\n\tif (!((cam16.C !== undefined) ^ (cam16.M !== undefined) ^ (cam16.s !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'C', 'M' or 's'\");\n\t}\n\n\t// Hue is absolutely required\n\t// @ts-expect-error - The '^` operator is not allowed for boolean types\n\tif (!((cam16.h !== undefined) ^ (cam16.H !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'h' or 'H'\");\n\t}\n\n\t// Black\n\tif (cam16.J === 0.0 || cam16.Q === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Break hue into Cartesian components\n\tlet hRad = 0.0;\n\tif (cam16.h !== undefined) {\n\t\thRad = constrain(cam16.h) * deg2rad;\n\t}\n\telse {\n\t\thRad = invHueQuadrature(cam16.H) * deg2rad;\n\t}\n\n\tconst cosh = Math.cos(hRad);\n\tconst sinh = Math.sin(hRad);\n\n\t// Calculate `Jroot` from one of the lightness derived coordinates.\n\tlet Jroot = 0.0;\n\tif (cam16.J !== undefined) {\n\t\tJroot = spow(cam16.J, 1 / 2) * 0.1;\n\t}\n\telse if (cam16.Q !== undefined) {\n\t\tJroot = (0.25 * env.c * cam16.Q) / ((env.aW + 4) * env.flRoot);\n\t}\n\n\t// Calculate the `t` value from one of the chroma derived coordinates\n\tlet alpha = 0.0;\n\tif (cam16.C !== undefined) {\n\t\talpha = cam16.C / Jroot;\n\t}\n\telse if (cam16.M !== undefined) {\n\t\talpha = cam16.M / env.flRoot / Jroot;\n\t}\n\telse if (cam16.s !== undefined) {\n\t\talpha = (0.0004 * cam16.s ** 2 * (env.aW + 4)) / env.c;\n\t}\n\tconst t = spow(alpha * Math.pow(1.64 - Math.pow(0.29, env.n), -0.73), 10 / 9);\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\t// Achromatic response\n\tconst A = env.aW * spow(Jroot, 2 / env.c / env.z);\n\n\t// Calculate red-green and yellow-blue components\n\tconst p1 = (5e4 / 13) * env.nc * env.ncb * et;\n\tconst p2 = A / env.nbb;\n\tconst r = 23 * (p2 + 0.305) * zdiv(t, 23 * p1 + t * (11 * cosh + 108 * sinh));\n\tconst a = r * cosh;\n\tconst b = r * sinh;\n\n\t// Calculate back from cone response to XYZ\n\tconst rgb_c = unadapt(\n\t\t/** @type {Vector3} */\n\t\t(\n\t\t\tmultiply_v3_m3x3([p2, a, b], m1).map(c => {\n\t\t\t\treturn (c * 1) / 1403;\n\t\t\t})\n\t\t),\n\t\tenv.fl,\n\t);\n\treturn /** @type {Vector3} */ (\n\t\tmultiply_v3_m3x3(\n\t\t\t/** @type {Vector3} */ (\n\t\t\t\trgb_c.map((c, i) => {\n\t\t\t\t\treturn c * env.dRgbInv[i];\n\t\t\t\t})\n\t\t\t),\n\t\t\tcat16Inv,\n\t\t).map(c => {\n\t\t\treturn c / 100;\n\t\t})\n\t);\n}\n\n/**\n * @param {[number, number, number]} xyzd65\n * @param {Cam16Environment} env\n * @returns {Cam16Object}\n */\nexport function toCam16 (xyzd65, env) {\n\t// Cone response\n\tconst xyz100 = /** @type {Vector3} */ (\n\t\txyzd65.map(c => {\n\t\t\treturn c * 100;\n\t\t})\n\t);\n\tconst rgbA = adapt(\n\t\t/** @type {[number, number, number]} */\n\t\t(\n\t\t\tmultiply_v3_m3x3(xyz100, cat16).map((c, i) => {\n\t\t\t\treturn c * env.dRgb[i];\n\t\t\t})\n\t\t),\n\t\tenv.fl,\n\t);\n\n\t// Calculate hue from red-green and yellow-blue components\n\tconst a = rgbA[0] + (-12 * rgbA[1] + rgbA[2]) / 11;\n\tconst b = (rgbA[0] + rgbA[1] - 2 * rgbA[2]) / 9;\n\tconst hRad = ((Math.atan2(b, a) % tau) + tau) % tau;\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\tconst t =\n\t\t(5e4 / 13) *\n\t\tenv.nc *\n\t\tenv.ncb *\n\t\tzdiv(et * Math.sqrt(a ** 2 + b ** 2), rgbA[0] + rgbA[1] + 1.05 * rgbA[2] + 0.305);\n\tconst alpha = spow(t, 0.9) * Math.pow(1.64 - Math.pow(0.29, env.n), 0.73);\n\n\t// Achromatic response\n\tconst A = env.nbb * (2 * rgbA[0] + rgbA[1] + 0.05 * rgbA[2]);\n\n\tconst Jroot = spow(A / env.aW, 0.5 * env.c * env.z);\n\n\t// Lightness\n\tconst J = 100 * spow(Jroot, 2);\n\n\t// Brightness\n\tconst Q = (4 / env.c) * Jroot * (env.aW + 4) * env.flRoot;\n\n\t// Chroma\n\tconst C = alpha * Jroot;\n\n\t// Colorfulness\n\tconst M = C * env.flRoot;\n\n\t// Hue\n\tconst h = constrain(hRad * rad2deg);\n\n\t// Hue quadrature\n\tconst H = hueQuadrature(h);\n\n\t// Saturation\n\tconst s = 50 * spow((env.c * alpha) / (env.aW + 4), 1 / 2);\n\n\t// console.log({J: J, C: C, h: h, s: s, Q: Q, M: M, H: H});\n\n\treturn { J: J, C: C, h: h, s: s, Q: Q, M: M, H: H };\n}\n\n// Provided as a way to directly evaluate the CAM16 model\n// https://observablehq.com/@jrus/cam16: reference implementation\n// https://arxiv.org/pdf/1802.06067.pdf: Nico Schlömer\n// https://onlinelibrary.wiley.com/doi/pdf/10.1002/col.22324: hue quadrature\n// https://www.researchgate.net/publication/318152296_Comprehensive_color_solutions_CAM16_CAT16_and_CAM16-UCS\n// Results compared against: https://github.com/colour-science/colour\nexport default new ColorSpace({\n\tid: \"cam16-jmh\",\n\tcssId: \"--cam16-jmh\",\n\tname: \"CAM16-JMh\",\n\tcoords: {\n\t\tj: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"J\",\n\t\t},\n\t\tm: {\n\t\t\trefRange: [0, 105.0],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\t// If another derivation is created, ε could vary, so we can't hardcode\n\t\tif (this.ε === undefined) {\n\t\t\tthis.ε = Object.values(this.coords)[1].refRange[1] / 100000;\n\t\t}\n\t\tconst cam16 = toCam16(xyz, viewingConditions);\n\t\tconst isAchromatic = Math.abs(cam16.M) < this.ε;\n\t\treturn [cam16.J, isAchromatic ? 0 : cam16.M, isAchromatic ? null : cam16.h];\n\t},\n\ttoBase (cam16) {\n\t\treturn fromCam16({ J: cam16[0], M: cam16[1], h: cam16[2] }, viewingConditions);\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { constrain } from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport { fromCam16, toCam16, environment } from \"./cam16.js\";\nimport { WHITES } from \"../adapt.js\";\n\nconst white = WHITES.D65;\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27; // 29^3/3^3\n\nfunction toLstar (y) {\n\t// Convert XYZ Y to L*\n\n\tconst fy = y > ε ? Math.cbrt(y) : (κ * y + 16) / 116;\n\treturn 116.0 * fy - 16.0;\n}\n\nfunction fromLstar (lstar) {\n\t// Convert L* back to XYZ Y\n\n\treturn lstar > 8 ? Math.pow((lstar + 16) / 116, 3) : lstar / κ;\n}\n\nfunction fromHct (coords, env) {\n\t// Use Newton's method to try and converge as quick as possible or\n\t// converge as close as we can. While the requested precision is achieved\n\t// most of the time, it may not always be achievable. Especially past the\n\t// visible spectrum, the algorithm will likely struggle to get the same\n\t// precision. If, for whatever reason, we cannot achieve the accuracy we\n\t// seek in the allotted iterations, just return the closest we were able to\n\t// get.\n\n\tlet [h, c, t] = coords;\n\tlet xyz = [];\n\tlet j = 0;\n\n\t// Shortcut out for black\n\tif (t === 0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Calculate the Y we need to target\n\tlet y = fromLstar(t);\n\n\t// A better initial guess yields better results. Polynomials come from\n\t// curve fitting the T vs J response.\n\tif (t > 0) {\n\t\tj = 0.00379058511492914 * t ** 2 + 0.608983189401032 * t + 0.9155088574762233;\n\t}\n\telse {\n\t\tj = 9.514440756550361e-6 * t ** 2 + 0.08693057439788597 * t - 21.928975842194614;\n\t}\n\n\t// Threshold of how close is close enough, and max number of attempts.\n\t// More precision and more attempts means more time spent iterating. Higher\n\t// required precision gives more accuracy but also increases the chance of\n\t// not hitting the goal. 2e-12 allows us to convert round trip with\n\t// reasonable accuracy of six decimal places or more.\n\tconst threshold = 2e-12;\n\tconst max_attempts = 15;\n\n\tlet attempt = 0;\n\tlet last = Infinity;\n\tlet best = j;\n\n\t// Try to find a J such that the returned y matches the returned y of the L*\n\twhile (attempt <= max_attempts) {\n\t\txyz = fromCam16({ J: j, C: c, h: h }, env);\n\n\t\t// If we are within range, return XYZ\n\t\t// If we are closer than last time, save the values\n\t\tconst delta = Math.abs(xyz[1] - y);\n\t\tif (delta < last) {\n\t\t\tif (delta <= threshold) {\n\t\t\t\treturn xyz;\n\t\t\t}\n\t\t\tbest = j;\n\t\t\tlast = delta;\n\t\t}\n\n\t\t// f(j_root) = (j ** (1 / 2)) * 0.1\n\t\t// f(j) = ((f(j_root) * 100) ** 2) / j - 1 = 0\n\t\t// f(j_root) = Y = y / 100\n\t\t// f(j) = (y ** 2) / j - 1\n\t\t// f'(j) = (2 * y) / j\n\t\tj = j - ((xyz[1] - y) * j) / (2 * xyz[1]);\n\n\t\tattempt += 1;\n\t}\n\n\t// We could not acquire the precision we desired,\n\t// return our closest attempt.\n\treturn fromCam16({ J: j, C: c, h: h }, env);\n}\n\nfunction toHct (xyz, env) {\n\t// Calculate HCT by taking the L* of CIE LCh D65 and CAM16 chroma and hue.\n\n\tconst t = toLstar(xyz[1]);\n\tif (t === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\tconst cam16 = toCam16(xyz, viewingConditions);\n\treturn [constrain(cam16.h), cam16.C, t];\n}\n\n// Pre-calculate everything we can with the viewing conditions\nexport const viewingConditions = environment(\n\twhite,\n\t(200 / Math.PI) * fromLstar(50.0),\n\tfromLstar(50.0) * 100,\n\t\"average\",\n\tfalse,\n);\n\n// https://material.io/blog/science-of-color-design\n// This is not a port of the material-color-utilities,\n// but instead implements the full color space as described,\n// combining CAM16 JCh and Lab D65. This does not clamp conversion\n// to HCT to specific chroma bands and provides support for wider\n// gamuts than Google currently supports and does so at a greater\n// precision (> 8 bits back to sRGB).\n// This implementation comes from https://github.com/facelessuser/coloraide\n// which is licensed under MIT.\nexport default new ColorSpace({\n\tid: \"hct\",\n\tname: \"HCT\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 145],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\tt: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Tone\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\tif (this.ε === undefined) {\n\t\t\tthis.ε = Object.values(this.coords)[1].refRange[1] / 100000;\n\t\t}\n\t\tlet hct = toHct(xyz, viewingConditions);\n\t\tif (hct[1] < this.ε) {\n\t\t\thct[1] = 0.0;\n\t\t\thct[0] = null;\n\t\t}\n\t\treturn hct;\n\t},\n\ttoBase (hct) {\n\t\treturn fromHct(hct, viewingConditions);\n\t},\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hct\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import hct from \"../spaces/hct.js\";\nimport { viewingConditions } from \"../spaces/hct.js\";\nimport getColor from \"../getColor.js\";\n\n/** @import { Coords } from \"../types.js\" */\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\nconst ucsCoeff = [1.0, 0.007, 0.0228];\n\n/**\n * Convert HCT chroma and hue (CAM16 JMh colorfulness and hue) using UCS logic for a and b.\n * @param {Coords} coords - HCT coordinates.\n * @return {number[]}\n */\nfunction convertUcsAb (coords) {\n\t// We want the distance between the actual color.\n\t// If chroma is negative, it will throw off our calculations.\n\t// Normally, converting back to the base and forward will correct it.\n\t// If we have a negative chroma after this, then we have a color that\n\t// cannot resolve to positive chroma.\n\tif (coords[1] < 0) {\n\t\tcoords = hct.fromBase(hct.toBase(coords));\n\t}\n\n\t// Only in extreme cases (usually outside the visible spectrum)\n\t// can the input value for log become negative.\n\t// Avoid domain error by forcing a zero result via \"max\" if necessary.\n\tconst M =\n\t\tMath.log(Math.max(1 + ucsCoeff[2] * coords[1] * viewingConditions.flRoot, 1.0)) /\n\t\tucsCoeff[2];\n\tconst hrad = coords[0] * deg2rad;\n\tconst a = M * Math.cos(hrad);\n\tconst b = M * Math.sin(hrad);\n\n\treturn [coords[2], a, b];\n}\n\n/**\n * Color distance using HCT.\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\tlet [t1, a1, b1] = convertUcsAb(hct.from(color));\n\tlet [t2, a2, b2] = convertUcsAb(hct.from(sample));\n\n\t// Use simple euclidean distance with a and b using UCS conversion\n\t// and LCh lightness (HCT tone).\n\treturn Math.sqrt((t1 - t2) ** 2 + (a1 - a2) ** 2 + (b1 - b2) ** 2);\n}\n","/**\n * @packageDocumentation\n * This module defines all the builtin deltaE methods.\n */\nimport deltaE76 from \"./deltaE76.js\";\nimport deltaECMC from \"./deltaECMC.js\";\nimport deltaE2000 from \"./deltaE2000.js\";\nimport deltaEJz from \"./deltaEJz.js\";\nimport deltaEITP from \"./deltaEITP.js\";\nimport deltaEOK from \"./deltaEOK.js\";\nimport deltaEOK2 from \"./deltaEOK2.js\";\nimport deltaEHCT from \"./deltaEHCT.js\";\n\nexport { deltaE76, deltaECMC, deltaE2000, deltaEJz, deltaEITP, deltaEOK, deltaEOK2, deltaEHCT };\n\nexport default {\n\tdeltaE76,\n\tdeltaECMC,\n\tdeltaE2000,\n\tdeltaEJz,\n\tdeltaEITP,\n\tdeltaEOK,\n\tdeltaEOK2,\n\tdeltaEHCT,\n};\n\n/** @typedef {keyof typeof import(\"./index.js\").default extends `deltaE${infer Method}` ? Method : string} Methods */\n","import * as util from \"./util.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\nimport deltaE2000 from \"./deltaE/deltaE2000.js\";\nimport deltaEOK from \"./deltaE/deltaEOK.js\";\nimport inGamut from \"./inGamut.js\";\nimport to from \"./to.js\";\nimport get from \"./get.js\";\nimport oklab from \"./spaces/oklab.js\";\nimport set from \"./set.js\";\nimport clone from \"./clone.js\";\nimport getColor from \"./getColor.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\nimport { WHITES } from \"./adapt.js\";\n\n/** @import { ColorTypes, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").ToGamutOptions} ToGamutOptions */\n\n/**\n * Calculate the epsilon to 2 degrees smaller than the specified JND.\n * @param {number} jnd The target \"just noticeable difference\".\n * @returns {number}\n */\nfunction calcEpsilon (jnd) {\n\t// Calculate the epsilon to 2 degrees smaller than the specified JND.\n\n\tconst order = !jnd ? 0 : Math.floor(Math.log10(Math.abs(jnd)));\n\t// Limit to an arbitrary value to ensure value is never too small and causes infinite loops.\n\treturn Math.max(parseFloat(`1e${order - 2}`), 1e-6);\n}\n\nconst GMAPPRESET = {\n\thct: {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 2,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: {},\n\t},\n\t\"hct-tonal\": {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 0,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: { channel: \"hct.t\", min: 0, max: 100 },\n\t},\n};\n\n/**\n * Force coordinates to be in gamut of a certain color space.\n * Mutates the color it is passed.\n * @overload\n * @param {ColorTypes} color\n * @param {ToGamutOptions} [options]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {string} [space]\n * @returns {PlainColorObject}\n */\n/**\n * @param {ColorTypes} color\n * @param {string & Partial<ToGamutOptions> | ToGamutOptions} [space]\n * @returns {PlainColorObject}\n */\nexport default function toGamut (\n\tcolor,\n\t{\n\t\tmethod = defaults.gamut_mapping,\n\t\tspace = undefined,\n\t\tdeltaEMethod = \"\",\n\t\tjnd = 2,\n\t\tblackWhiteClamp = undefined,\n\t} = {},\n) {\n\tcolor = getColor(color);\n\n\tif (util.isString(arguments[1])) {\n\t\tspace = arguments[1];\n\t}\n\telse if (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\n\t// 3 spaces:\n\t// color.space: current color space\n\t// space: space whose gamut we are mapping to\n\t// mapSpace: space with the coord we're reducing\n\n\tif (inGamut(color, space, { epsilon: 0 })) {\n\t\treturn /** @type {PlainColorObject} */ (color);\n\t}\n\n\tlet spaceColor;\n\tif (method === \"css\") {\n\t\tspaceColor = toGamutCSS(color, { space });\n\t}\n\telse {\n\t\tif (method !== \"clip\" && !inGamut(color, space)) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(GMAPPRESET, method)) {\n\t\t\t\t({ method, jnd, deltaEMethod, blackWhiteClamp } = GMAPPRESET[method]);\n\t\t\t}\n\n\t\t\t// Get the correct delta E method\n\t\t\tlet de = deltaE2000;\n\t\t\tif (deltaEMethod !== \"\") {\n\t\t\t\tfor (let m in deltaEMethods) {\n\t\t\t\t\tif (\"deltae\" + deltaEMethod.toLowerCase() === m.toLowerCase()) {\n\t\t\t\t\t\tde = deltaEMethods[m];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (jnd === 0) {\n\t\t\t\tjnd = 1e-16;\n\t\t\t}\n\n\t\t\tlet clipped = toGamut(to(color, space), { method: \"clip\", space });\n\t\t\tif (de(color, clipped) > jnd) {\n\t\t\t\t// Clamp to SDR white and black if required\n\t\t\t\tif (blackWhiteClamp && Object.keys(blackWhiteClamp).length === 3) {\n\t\t\t\t\tlet channelMeta = ColorSpace.resolveCoord(blackWhiteClamp.channel);\n\t\t\t\t\tlet channel = get(to(color, channelMeta.space), channelMeta.id);\n\t\t\t\t\tif (util.isNone(channel)) {\n\t\t\t\t\t\tchannel = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (channel >= blackWhiteClamp.max) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: WHITES[\"D65\"] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t\telse if (channel <= blackWhiteClamp.min) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: [0, 0, 0] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Reduce a coordinate of a certain color space until the color is in gamut\n\t\t\t\tlet coordMeta = ColorSpace.resolveCoord(method);\n\t\t\t\tlet mapSpace = coordMeta.space;\n\t\t\t\tlet coordId = coordMeta.id;\n\n\t\t\t\tlet mappedColor = to(color, mapSpace);\n\t\t\t\t// If we were already in the mapped color space, we need to resolve undefined channels\n\t\t\t\tmappedColor.coords.forEach((c, i) => {\n\t\t\t\t\tif (util.isNone(c)) {\n\t\t\t\t\t\tmappedColor.coords[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet bounds = coordMeta.range || coordMeta.refRange;\n\t\t\t\tlet min = bounds[0];\n\t\t\t\tlet ε = calcEpsilon(jnd);\n\t\t\t\tlet low = min;\n\t\t\t\tlet high = get(mappedColor, coordId);\n\n\t\t\t\twhile (high - low > ε) {\n\t\t\t\t\tlet clipped = clone(mappedColor);\n\t\t\t\t\tclipped = toGamut(clipped, { space, method: \"clip\" });\n\t\t\t\t\tlet deltaE = de(mappedColor, clipped);\n\n\t\t\t\t\tif (deltaE - jnd < ε) {\n\t\t\t\t\t\tlow = get(mappedColor, coordId);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\thigh = get(mappedColor, coordId);\n\t\t\t\t\t}\n\n\t\t\t\t\tset(mappedColor, coordId, (low + high) / 2);\n\t\t\t\t}\n\n\t\t\t\tspaceColor = to(mappedColor, space);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tspaceColor = clipped;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tspaceColor = to(color, space);\n\t\t}\n\n\t\tif (\n\t\t\tmethod === \"clip\" || // Dumb coord clipping\n\t\t\t// finish off smarter gamut mapping with clip to get rid of ε, see #17\n\t\t\t!inGamut(spaceColor, space, { epsilon: 0 })\n\t\t) {\n\t\t\tlet bounds = Object.values(space.coords).map(c => c.range || []);\n\n\t\t\tspaceColor.coords = /** @type {[number, number, number]} */ (\n\t\t\t\tspaceColor.coords.map((c, i) => {\n\t\t\t\t\tlet [min, max] = bounds[i];\n\n\t\t\t\t\tif (min !== undefined) {\n\t\t\t\t\t\tc = Math.max(min, c);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (max !== undefined) {\n\t\t\t\t\t\tc = Math.min(c, max);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn c;\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}\n\n\tif (space !== color.space) {\n\t\tspaceColor = to(spaceColor, color.space);\n\t}\n\n\tcolor.coords = spaceColor.coords;\n\treturn /** @type {PlainColorObject} */ (color);\n}\n\n/** @type {\"color\"} */\ntoGamut.returns = \"color\";\n\n/**\n * The reference colors to be used if lightness is out of the range 0-1 in the\n * `Oklch` space. These are created in the `Oklab` space, as it is used by the\n * DeltaEOK calculation, so it is guaranteed to be imported.\n * @satisfies {Record<string, ColorTypes>}\n */\nconst COLORS = {\n\tWHITE: { space: oklab, coords: [1, 0, 0], alpha: 1 },\n\tBLACK: { space: oklab, coords: [0, 0, 0], alpha: 1 },\n};\n\n/**\n * Given a color `origin`, returns a new color that is in gamut using\n * the CSS Gamut Mapping Algorithm. If `space` is specified, it will be in gamut\n * in `space`, and returned in `space`. Otherwise, it will be in gamut and\n * returned in the color space of `origin`.\n * @param {ColorTypes} origin\n * @param {{ space?: string | ColorSpace | undefined }} param1\n * @returns {PlainColorObject}\n */\nexport function toGamutCSS (origin, { space } = {}) {\n\tconst JND = 0.02;\n\tconst ε = 0.0001;\n\n\torigin = getColor(origin);\n\n\tif (!space) {\n\t\tspace = origin.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tconst oklchSpace = ColorSpace.get(\"oklch\");\n\n\tif (space.isUnbounded) {\n\t\treturn to(origin, space);\n\t}\n\n\tconst origin_OKLCH = to(origin, oklchSpace);\n\tlet L = origin_OKLCH.coords[0];\n\n\t// return media white or black, if lightness is out of range\n\tif (L >= 1) {\n\t\tconst white = to(COLORS.WHITE, space);\n\t\twhite.alpha = origin.alpha;\n\t\treturn to(white, space);\n\t}\n\tif (L <= 0) {\n\t\tconst black = to(COLORS.BLACK, space);\n\t\tblack.alpha = origin.alpha;\n\t\treturn to(black, space);\n\t}\n\n\tif (inGamut(origin_OKLCH, space, { epsilon: 0 })) {\n\t\treturn to(origin_OKLCH, space);\n\t}\n\n\tfunction clip (_color) {\n\t\tconst destColor = to(_color, space);\n\t\tconst spaceCoords = Object.values(/** @type {ColorSpace} */ (space).coords);\n\t\tdestColor.coords = /** @type {[number, number, number]} */ (\n\t\t\tdestColor.coords.map((coord, index) => {\n\t\t\t\tif (\"range\" in spaceCoords[index]) {\n\t\t\t\t\tconst [min, max] = spaceCoords[index].range;\n\t\t\t\t\treturn util.clamp(min, coord, max);\n\t\t\t\t}\n\t\t\t\treturn coord;\n\t\t\t})\n\t\t);\n\t\treturn destColor;\n\t}\n\tlet min = 0;\n\tlet max = origin_OKLCH.coords[1];\n\tlet min_inGamut = true;\n\tlet current = clone(origin_OKLCH);\n\tlet clipped = clip(current);\n\n\tlet E = deltaEOK(clipped, current);\n\tif (E < JND) {\n\t\treturn clipped;\n\t}\n\n\twhile (max - min > ε) {\n\t\tconst chroma = (min + max) / 2;\n\t\tcurrent.coords[1] = chroma;\n\t\tif (min_inGamut && inGamut(current, space, { epsilon: 0 })) {\n\t\t\tmin = chroma;\n\t\t}\n\t\telse {\n\t\t\tclipped = clip(current);\n\t\t\tE = deltaEOK(clipped, current);\n\t\t\tif (E < JND) {\n\t\t\t\tif (JND - E < ε) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmin_inGamut = false;\n\t\t\t\t\tmin = chroma;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmax = chroma;\n\t\t\t}\n\t\t}\n\t}\n\treturn clipped;\n}\n","import getColor from \"./getColor.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport toGamut from \"./toGamut.js\";\n\n/** @import { ColorTypes, PlainColorObject, ToGamutOptions } from \"./types.js\" */\n\n/**\n * Convert to color space and return a new color\n * @param {ColorTypes} color\n * @param {string | ColorSpace} space\n * @param {{ inGamut?: boolean | ToGamutOptions | undefined }} options\n * @returns {PlainColorObject}\n */\nexport default function to (color, space, { inGamut } = {}) {\n\tcolor = getColor(color);\n\tspace = ColorSpace.get(space);\n\n\tlet coords = space.from(color);\n\tlet ret = { space, coords, alpha: color.alpha };\n\n\tif (inGamut) {\n\t\tret = toGamut(ret, inGamut === true ? undefined : inGamut);\n\t}\n\n\treturn ret;\n}\n\n/** @type {\"color\"} */\nto.returns = \"color\";\n","// @ts-nocheck\n\nimport * as util from \"./util.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\nimport getColor from \"./getColor.js\";\nimport to from \"./to.js\";\nimport checkInGamut from \"./inGamut.js\";\nimport toGamut from \"./toGamut.js\";\nimport clone from \"./clone.js\";\n\n/** @import { ColorTypes, ParseOptions, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").SerializeOptions} SerializeOptions */\n\n/**\n * Generic toString() method, outputs a color(spaceId ...coords) function, a functional syntax, or custom formats defined by the color space\n * @param {ColorTypes} color\n * @param {SerializeOptions & Record<string, any>} options\n * @returns {string}\n */\nexport default function serialize (color, options = {}) {\n\tlet {\n\t\tprecision = defaults.precision,\n\t\tformat,\n\t\tinGamut = true,\n\t\tcoords: coordFormat,\n\t\talpha: alphaFormat,\n\t\tcommas,\n\t} = options;\n\tlet ret;\n\n\tlet colorWithMeta = /** @type {PlainColorObject & ParseOptions} */ (getColor(color));\n\n\tlet formatId = format;\n\tlet parseMeta = colorWithMeta.parseMeta;\n\n\tif (parseMeta && !format) {\n\t\tif (parseMeta.format.canSerialize()) {\n\t\t\tformat = parseMeta.format;\n\t\t\tformatId = parseMeta.formatId;\n\t\t}\n\n\t\tcoordFormat ??= parseMeta.types;\n\t\talphaFormat ??= parseMeta.alphaType;\n\t\tcommas ??= parseMeta.commas;\n\t}\n\n\tif (formatId) {\n\t\t// A format is explicitly specified\n\t\tformat = colorWithMeta.space.getFormat(format) ?? ColorSpace.findFormat(formatId);\n\t}\n\n\tif (!format) {\n\t\t// No format specified, or format not found\n\t\tformat = colorWithMeta.space.getFormat(\"default\") ?? ColorSpace.DEFAULT_FORMAT;\n\t\tformatId = format.name;\n\t}\n\n\tif (format && format.space && format.space !== colorWithMeta.space) {\n\t\t// Format specified belongs to a different color space,\n\t\t// need to convert to it first\n\t\tcolorWithMeta = to(colorWithMeta, format.space);\n\t}\n\n\t// The assignment to coords and inGamut needs to stay in the order they are now\n\t// The order of the assignment was changed as a workaround for a bug in Next.js\n\t// See this issue for details: https://github.com/color-js/color.js/issues/260\n\n\tlet coords = colorWithMeta.coords.slice(); // clone so we can manipulate it\n\n\tinGamut ||= format.toGamut;\n\n\tif (inGamut && !checkInGamut(colorWithMeta)) {\n\t\t// FIXME what happens if the color contains none values?\n\t\tcoords = toGamut(clone(colorWithMeta), inGamut === true ? undefined : inGamut).coords;\n\t}\n\n\tif (format.type === \"custom\") {\n\t\tif (format.serialize) {\n\t\t\tret = format.serialize(coords, colorWithMeta.alpha, options);\n\t\t}\n\t\telse {\n\t\t\tthrow new TypeError(\n\t\t\t\t`format ${formatId} can only be used to parse colors, not for serialization`,\n\t\t\t);\n\t\t}\n\t}\n\telse {\n\t\t// Functional syntax\n\t\tlet name = format.name || \"color\";\n\n\t\tlet args = format.serializeCoords(coords, precision, coordFormat);\n\n\t\tif (name === \"color\") {\n\t\t\t// If output is a color() function, add colorspace id as first argument\n\t\t\tlet cssId =\n\t\t\t\tformat.id || format.ids?.[0] || colorWithMeta.space.cssId || colorWithMeta.space.id;\n\t\t\targs.unshift(cssId);\n\t\t}\n\n\t\t// Serialize alpha?\n\t\t/** @type {string | number} */\n\t\tlet alpha = colorWithMeta.alpha;\n\n\t\tif (alphaFormat !== undefined && !(typeof alphaFormat === \"object\")) {\n\t\t\talphaFormat =\n\t\t\t\ttypeof alphaFormat === \"string\" ? { type: alphaFormat } : { include: alphaFormat };\n\t\t}\n\n\t\tlet alphaType = alphaFormat?.type ?? \"<number>\";\n\t\tlet serializeAlpha =\n\t\t\talphaFormat?.include === true ||\n\t\t\tformat.alpha === true ||\n\t\t\t(alphaFormat?.include !== false && format.alpha !== false && alpha < 1);\n\t\tlet strAlpha = \"\";\n\n\t\tcommas ??= format.commas;\n\n\t\tif (serializeAlpha) {\n\t\t\tif (precision !== null) {\n\t\t\t\tlet unit;\n\n\t\t\t\tif (alphaType === \"<percentage>\") {\n\t\t\t\t\tunit = \"%\";\n\t\t\t\t\talpha *= 100;\n\t\t\t\t}\n\n\t\t\t\talpha = util.serializeNumber(alpha, { precision, unit });\n\t\t\t}\n\n\t\t\tstrAlpha = `${commas ? \",\" : \" /\"} ${alpha}`;\n\t\t}\n\n\t\tret = `${name}(${args.join(commas ? \", \" : \" \")}${strAlpha})`;\n\t}\n\n\treturn ret;\n}\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of linear-light rec2020 values to CIE XYZ\n// using  D65 (no chromatic adaptation)\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// 0 is actually calculated as  4.994106574466076e-17\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.6369580483012914, 0.14461690358620832,  0.1688809751641721  ],\n\t[ 0.2627002120112671, 0.6779980715188708,   0.05930171646986196 ],\n\t[ 0.000000000000000,  0.028072693049087428, 1.060985057710791   ],\n];\n\n// from ITU-R BT.2124-0 Annex 2 p.3\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  1.716651187971268,  -0.355670783776392, -0.253366281373660  ],\n\t[ -0.666684351832489,   1.616481236634939,  0.0157685458139111 ],\n\t[  0.017639857445311,  -0.042770613257809,  0.942103121235474  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"rec2020-linear\",\n\tcssId: \"--rec2020-linear\",\n\tname: \"Linear REC.2020\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n// import sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"rec2020\",\n\tname: \"REC.2020\",\n\tbase: REC2020Linear,\n\t//  Reference electro-optical transfer function from Rec. ITU-R BT.1886 Annex 1\n\t//  with b (black lift) = 0 and a (user gain) = 1\n\t//  defined over the extended range, not clamped\n\ttoBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\t\t\treturn sign * Math.pow(abs, 2.4);\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\t\t\treturn sign * Math.pow(abs, 1 / 2.4);\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[0.4865709486482162, 0.26566769316909306, 0.1982172852343625],\n\t[0.2289745640697488, 0.6917385218365064,  0.079286914093745],\n\t[0.0000000000000000, 0.04511338185890264, 1.043944368900976],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[ 2.493496911941425,   -0.9313836179191239, -0.40271078445071684],\n\t[-0.8294889695615747,   1.7626640603183463,  0.023624685841943577],\n\t[ 0.03584583024378447, -0.07617238926804182, 0.9568845240076872],\n];\n\nexport default new RGBColorSpace({\n\tid: \"p3-linear\",\n\tcssId: \"display-p3-linear\",\n\tname: \"Linear P3\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// This is the linear-light version of sRGB\n// as used for example in SVG filters\n// or in Canvas\n\n// This matrix was calculated directly from the RGB and white chromaticities\n// when rounded to 8 decimal places, it agrees completely with the official matrix\n// see https://github.com/w3c/csswg-drafts/issues/5922\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.41239079926595934, 0.357584339383878,   0.1804807884018343  ],\n\t[ 0.21263900587151027, 0.715168678767756,   0.07219231536073371 ],\n\t[ 0.01933081871559182, 0.11919477979462598, 0.9505321522496607  ],\n];\n\n// This matrix is the inverse of the above;\n// again it agrees with the official definition when rounded to 8 decimal places\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const fromXYZ_M = [\n\t[  3.2409699419045226,  -1.537383177570094,   -0.4986107602930034  ],\n\t[ -0.9692436362808796,   1.8759675015077202,   0.04155505740717559 ],\n\t[  0.05563007969699366, -0.20397695888897652,  1.0569715142428786  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"srgb-linear\",\n\tname: \"Linear sRGB\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","// To produce: Visit https://www.w3.org/TR/css-color-4/#named-colors\n// and run in the console:\n// copy($$(\"tr\", $(\".named-color-table tbody\")).map(tr => `\"${tr.cells[2].textContent.trim()}\": [${tr.cells[4].textContent.trim().split(/\\s+/).map(c => c === \"0\"? \"0\" : c === \"255\"? \"1\" : c + \" / 255\").join(\", \")}]`).join(\",\\n\"))\n\n/** List of CSS color keywords\n *  Note that this does not include currentColor, transparent,\n *  or system colors\n *\n *  @type {Record<string, [number, number, number]>}\n */\nexport default {\n\taliceblue: [240 / 255, 248 / 255, 1],\n\tantiquewhite: [250 / 255, 235 / 255, 215 / 255],\n\taqua: [0, 1, 1],\n\taquamarine: [127 / 255, 1, 212 / 255],\n\tazure: [240 / 255, 1, 1],\n\tbeige: [245 / 255, 245 / 255, 220 / 255],\n\tbisque: [1, 228 / 255, 196 / 255],\n\tblack: [0, 0, 0],\n\tblanchedalmond: [1, 235 / 255, 205 / 255],\n\tblue: [0, 0, 1],\n\tblueviolet: [138 / 255, 43 / 255, 226 / 255],\n\tbrown: [165 / 255, 42 / 255, 42 / 255],\n\tburlywood: [222 / 255, 184 / 255, 135 / 255],\n\tcadetblue: [95 / 255, 158 / 255, 160 / 255],\n\tchartreuse: [127 / 255, 1, 0],\n\tchocolate: [210 / 255, 105 / 255, 30 / 255],\n\tcoral: [1, 127 / 255, 80 / 255],\n\tcornflowerblue: [100 / 255, 149 / 255, 237 / 255],\n\tcornsilk: [1, 248 / 255, 220 / 255],\n\tcrimson: [220 / 255, 20 / 255, 60 / 255],\n\tcyan: [0, 1, 1],\n\tdarkblue: [0, 0, 139 / 255],\n\tdarkcyan: [0, 139 / 255, 139 / 255],\n\tdarkgoldenrod: [184 / 255, 134 / 255, 11 / 255],\n\tdarkgray: [169 / 255, 169 / 255, 169 / 255],\n\tdarkgreen: [0, 100 / 255, 0],\n\tdarkgrey: [169 / 255, 169 / 255, 169 / 255],\n\tdarkkhaki: [189 / 255, 183 / 255, 107 / 255],\n\tdarkmagenta: [139 / 255, 0, 139 / 255],\n\tdarkolivegreen: [85 / 255, 107 / 255, 47 / 255],\n\tdarkorange: [1, 140 / 255, 0],\n\tdarkorchid: [153 / 255, 50 / 255, 204 / 255],\n\tdarkred: [139 / 255, 0, 0],\n\tdarksalmon: [233 / 255, 150 / 255, 122 / 255],\n\tdarkseagreen: [143 / 255, 188 / 255, 143 / 255],\n\tdarkslateblue: [72 / 255, 61 / 255, 139 / 255],\n\tdarkslategray: [47 / 255, 79 / 255, 79 / 255],\n\tdarkslategrey: [47 / 255, 79 / 255, 79 / 255],\n\tdarkturquoise: [0, 206 / 255, 209 / 255],\n\tdarkviolet: [148 / 255, 0, 211 / 255],\n\tdeeppink: [1, 20 / 255, 147 / 255],\n\tdeepskyblue: [0, 191 / 255, 1],\n\tdimgray: [105 / 255, 105 / 255, 105 / 255],\n\tdimgrey: [105 / 255, 105 / 255, 105 / 255],\n\tdodgerblue: [30 / 255, 144 / 255, 1],\n\tfirebrick: [178 / 255, 34 / 255, 34 / 255],\n\tfloralwhite: [1, 250 / 255, 240 / 255],\n\tforestgreen: [34 / 255, 139 / 255, 34 / 255],\n\tfuchsia: [1, 0, 1],\n\tgainsboro: [220 / 255, 220 / 255, 220 / 255],\n\tghostwhite: [248 / 255, 248 / 255, 1],\n\tgold: [1, 215 / 255, 0],\n\tgoldenrod: [218 / 255, 165 / 255, 32 / 255],\n\tgray: [128 / 255, 128 / 255, 128 / 255],\n\tgreen: [0, 128 / 255, 0],\n\tgreenyellow: [173 / 255, 1, 47 / 255],\n\tgrey: [128 / 255, 128 / 255, 128 / 255],\n\thoneydew: [240 / 255, 1, 240 / 255],\n\thotpink: [1, 105 / 255, 180 / 255],\n\tindianred: [205 / 255, 92 / 255, 92 / 255],\n\tindigo: [75 / 255, 0, 130 / 255],\n\tivory: [1, 1, 240 / 255],\n\tkhaki: [240 / 255, 230 / 255, 140 / 255],\n\tlavender: [230 / 255, 230 / 255, 250 / 255],\n\tlavenderblush: [1, 240 / 255, 245 / 255],\n\tlawngreen: [124 / 255, 252 / 255, 0],\n\tlemonchiffon: [1, 250 / 255, 205 / 255],\n\tlightblue: [173 / 255, 216 / 255, 230 / 255],\n\tlightcoral: [240 / 255, 128 / 255, 128 / 255],\n\tlightcyan: [224 / 255, 1, 1],\n\tlightgoldenrodyellow: [250 / 255, 250 / 255, 210 / 255],\n\tlightgray: [211 / 255, 211 / 255, 211 / 255],\n\tlightgreen: [144 / 255, 238 / 255, 144 / 255],\n\tlightgrey: [211 / 255, 211 / 255, 211 / 255],\n\tlightpink: [1, 182 / 255, 193 / 255],\n\tlightsalmon: [1, 160 / 255, 122 / 255],\n\tlightseagreen: [32 / 255, 178 / 255, 170 / 255],\n\tlightskyblue: [135 / 255, 206 / 255, 250 / 255],\n\tlightslategray: [119 / 255, 136 / 255, 153 / 255],\n\tlightslategrey: [119 / 255, 136 / 255, 153 / 255],\n\tlightsteelblue: [176 / 255, 196 / 255, 222 / 255],\n\tlightyellow: [1, 1, 224 / 255],\n\tlime: [0, 1, 0],\n\tlimegreen: [50 / 255, 205 / 255, 50 / 255],\n\tlinen: [250 / 255, 240 / 255, 230 / 255],\n\tmagenta: [1, 0, 1],\n\tmaroon: [128 / 255, 0, 0],\n\tmediumaquamarine: [102 / 255, 205 / 255, 170 / 255],\n\tmediumblue: [0, 0, 205 / 255],\n\tmediumorchid: [186 / 255, 85 / 255, 211 / 255],\n\tmediumpurple: [147 / 255, 112 / 255, 219 / 255],\n\tmediumseagreen: [60 / 255, 179 / 255, 113 / 255],\n\tmediumslateblue: [123 / 255, 104 / 255, 238 / 255],\n\tmediumspringgreen: [0, 250 / 255, 154 / 255],\n\tmediumturquoise: [72 / 255, 209 / 255, 204 / 255],\n\tmediumvioletred: [199 / 255, 21 / 255, 133 / 255],\n\tmidnightblue: [25 / 255, 25 / 255, 112 / 255],\n\tmintcream: [245 / 255, 1, 250 / 255],\n\tmistyrose: [1, 228 / 255, 225 / 255],\n\tmoccasin: [1, 228 / 255, 181 / 255],\n\tnavajowhite: [1, 222 / 255, 173 / 255],\n\tnavy: [0, 0, 128 / 255],\n\toldlace: [253 / 255, 245 / 255, 230 / 255],\n\tolive: [128 / 255, 128 / 255, 0],\n\tolivedrab: [107 / 255, 142 / 255, 35 / 255],\n\torange: [1, 165 / 255, 0],\n\torangered: [1, 69 / 255, 0],\n\torchid: [218 / 255, 112 / 255, 214 / 255],\n\tpalegoldenrod: [238 / 255, 232 / 255, 170 / 255],\n\tpalegreen: [152 / 255, 251 / 255, 152 / 255],\n\tpaleturquoise: [175 / 255, 238 / 255, 238 / 255],\n\tpalevioletred: [219 / 255, 112 / 255, 147 / 255],\n\tpapayawhip: [1, 239 / 255, 213 / 255],\n\tpeachpuff: [1, 218 / 255, 185 / 255],\n\tperu: [205 / 255, 133 / 255, 63 / 255],\n\tpink: [1, 192 / 255, 203 / 255],\n\tplum: [221 / 255, 160 / 255, 221 / 255],\n\tpowderblue: [176 / 255, 224 / 255, 230 / 255],\n\tpurple: [128 / 255, 0, 128 / 255],\n\trebeccapurple: [102 / 255, 51 / 255, 153 / 255],\n\tred: [1, 0, 0],\n\trosybrown: [188 / 255, 143 / 255, 143 / 255],\n\troyalblue: [65 / 255, 105 / 255, 225 / 255],\n\tsaddlebrown: [139 / 255, 69 / 255, 19 / 255],\n\tsalmon: [250 / 255, 128 / 255, 114 / 255],\n\tsandybrown: [244 / 255, 164 / 255, 96 / 255],\n\tseagreen: [46 / 255, 139 / 255, 87 / 255],\n\tseashell: [1, 245 / 255, 238 / 255],\n\tsienna: [160 / 255, 82 / 255, 45 / 255],\n\tsilver: [192 / 255, 192 / 255, 192 / 255],\n\tskyblue: [135 / 255, 206 / 255, 235 / 255],\n\tslateblue: [106 / 255, 90 / 255, 205 / 255],\n\tslategray: [112 / 255, 128 / 255, 144 / 255],\n\tslategrey: [112 / 255, 128 / 255, 144 / 255],\n\tsnow: [1, 250 / 255, 250 / 255],\n\tspringgreen: [0, 1, 127 / 255],\n\tsteelblue: [70 / 255, 130 / 255, 180 / 255],\n\ttan: [210 / 255, 180 / 255, 140 / 255],\n\tteal: [0, 128 / 255, 128 / 255],\n\tthistle: [216 / 255, 191 / 255, 216 / 255],\n\ttomato: [1, 99 / 255, 71 / 255],\n\tturquoise: [64 / 255, 224 / 255, 208 / 255],\n\tviolet: [238 / 255, 130 / 255, 238 / 255],\n\twheat: [245 / 255, 222 / 255, 179 / 255],\n\twhite: [1, 1, 1],\n\twhitesmoke: [245 / 255, 245 / 255, 245 / 255],\n\tyellow: [1, 1, 0],\n\tyellowgreen: [154 / 255, 205 / 255, 50 / 255],\n};\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport sRGBLinear from \"./srgb-linear.js\";\nimport KEYWORDS from \"../keywords.js\";\n\n/** @import { Coords } from \"../types.js\" */\n\nlet coordGrammar = Array(3).fill(\"<percentage> | <number>[0, 255]\");\nlet coordGrammarNumber = Array(3).fill(\"<number>[0, 255]\");\n\nexport default new RGBColorSpace({\n\tid: \"srgb\",\n\tname: \"sRGB\",\n\tbase: sRGBLinear,\n\tfromBase: rgb => {\n\t\t// convert an array of linear-light sRGB values in the range 0.0-1.0\n\t\t// to gamma corrected form\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs > 0.0031308) {\n\t\t\t\treturn sign * (1.055 * abs ** (1 / 2.4) - 0.055);\n\t\t\t}\n\n\t\t\treturn 12.92 * val;\n\t\t});\n\t},\n\ttoBase: rgb => {\n\t\t// convert an array of sRGB values in the range 0.0 - 1.0\n\t\t// to linear light (un-companded) form.\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs <= 0.04045) {\n\t\t\t\treturn val / 12.92;\n\t\t\t}\n\n\t\t\treturn sign * ((abs + 0.055) / 1.055) ** 2.4;\n\t\t});\n\t},\n\tformats: {\n\t\trgb: {\n\t\t\tcoords: coordGrammar,\n\t\t},\n\t\trgb_number: {\n\t\t\tname: \"rgb\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t\talpha: false,\n\t\t},\n\t\tcolor: {\n\t\t\t/* use defaults */\n\t\t},\n\t\trgba: {\n\t\t\tcoords: coordGrammar,\n\t\t\tcommas: true,\n\t\t\talpha: true,\n\t\t},\n\t\trgba_number: {\n\t\t\tname: \"rgba\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t},\n\t\thex: {\n\t\t\ttype: \"custom\",\n\t\t\ttoGamut: true,\n\t\t\ttest: str => /^#(([a-f0-9]{2}){3,4}|[a-f0-9]{3,4})$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tif (str.length <= 5) {\n\t\t\t\t\t// #rgb or #rgba, duplicate digits\n\t\t\t\t\tstr = str.replace(/[a-f0-9]/gi, \"$&$&\");\n\t\t\t\t}\n\n\t\t\t\t/** @type {number[]} */\n\t\t\t\tlet rgba = [];\n\t\t\t\t// @ts-expect-error Type 'void' is not assignable to type 'string'\n\t\t\t\tstr.replace(/[a-f0-9]{2}/gi, component => {\n\t\t\t\t\trgba.push(parseInt(component, 16) / 255);\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tspaceId: \"srgb\",\n\t\t\t\t\tcoords: /** @type {Coords} */ (rgba.slice(0, 3)),\n\t\t\t\t\talpha: /** @type {number} */ (rgba.slice(3)[0]),\n\t\t\t\t};\n\t\t\t},\n\t\t\tserialize: (\n\t\t\t\tcoords,\n\t\t\t\talpha,\n\t\t\t\t{\n\t\t\t\t\tcollapse = true, // collapse to 3-4 digit hex when possible?\n\t\t\t\t\talpha: alphaFormat,\n\t\t\t\t} = {},\n\t\t\t) => {\n\t\t\t\tif ((alphaFormat !== false && alpha < 1) || alphaFormat === true) {\n\t\t\t\t\tcoords.push(alpha);\n\t\t\t\t}\n\n\t\t\t\tcoords = /** @type {[number, number, number]} */ (\n\t\t\t\t\tcoords.map(c => Math.round(c * 255))\n\t\t\t\t);\n\n\t\t\t\tlet collapsible = collapse && coords.every(c => c % 17 === 0);\n\n\t\t\t\tlet hex = coords\n\t\t\t\t\t.map(c => {\n\t\t\t\t\t\tif (collapsible) {\n\t\t\t\t\t\t\treturn (c / 17).toString(16);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn c.toString(16).padStart(2, \"0\");\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\");\n\n\t\t\t\treturn \"#\" + hex;\n\t\t\t},\n\t\t},\n\t\tkeyword: {\n\t\t\ttype: \"custom\",\n\t\t\ttest: str => /^[a-z]+$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tstr = str.toLowerCase();\n\t\t\t\tlet ret = { spaceId: \"srgb\", coords: null, alpha: 1 };\n\n\t\t\t\tif (str === \"transparent\") {\n\t\t\t\t\tret.coords = KEYWORDS.black;\n\t\t\t\t\tret.alpha = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tret.coords = KEYWORDS[str];\n\t\t\t\t}\n\n\t\t\t\tif (ret.coords) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport P3Linear from \"./p3-linear.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"p3\",\n\tcssId: \"display-p3\",\n\tname: \"P3\",\n\tbase: P3Linear,\n\t// Gamma encoding/decoding is the same as sRGB\n\tfromBase: sRGB.fromBase,\n\ttoBase: sRGB.toBase,\n});\n","import { isNone, skipNone } from \"./util.js\";\nimport defaults from \"./defaults.js\";\nimport to from \"./to.js\";\nimport serialize from \"./serialize.js\";\nimport clone from \"./clone.js\";\nimport getColor from \"./getColor.js\";\nimport REC2020 from \"./spaces/rec2020.js\";\nimport P3 from \"./spaces/p3.js\";\nimport Lab from \"./spaces/lab.js\";\nimport sRGB from \"./spaces/srgb.js\";\n\n/** @import ColorSpace from \"./ColorSpace.js\" */\n/** @import { ColorTypes, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Display} Display */\n\n// Default space for CSS output. Code in Color.js makes this wider if there's a DOM available\ndefaults.display_space = sRGB;\n\nlet supportsNone;\n\nif (typeof CSS !== \"undefined\" && CSS.supports) {\n\t// Find widest supported color space for CSS\n\tfor (let space of [Lab, REC2020, P3]) {\n\t\tlet coords = space.getMinCoords();\n\t\tlet color = { space, coords, alpha: 1 };\n\t\tlet str = serialize(color);\n\n\t\tif (CSS.supports(\"color\", str)) {\n\t\t\tdefaults.display_space = space;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\n/**\n * Returns a serialization of the color that can actually be displayed in the browser.\n * If the default serialization can be displayed, it is returned.\n * Otherwise, the color is converted to Lab, REC2020, or P3, whichever is the widest supported.\n * In Node.js, this is basically equivalent to `serialize()` but returns a `String` object instead.\n * @param {ColorTypes} color\n * @param {{ space?: string | ColorSpace | undefined } & Record<string, any>} param1\n * Options to be passed to `serialize()`\n * @returns {Display} String object containing the serialized color\n * with a color property containing the converted color (or the original, if no conversion was necessary)\n */\nexport default function display (color, { space = defaults.display_space, ...options } = {}) {\n\tcolor = getColor(color);\n\n\tlet ret = /** @type {Display} */ (serialize(color, options));\n\n\tif (\n\t\ttypeof CSS === \"undefined\" ||\n\t\tCSS.supports(\"color\", /** @type {string} */ (ret)) ||\n\t\t!defaults.display_space\n\t) {\n\t\tret = /** @type {Display} */ (new String(ret));\n\t\tret.color = /** @type {PlainColorObject} */ (color);\n\t}\n\telse {\n\t\t// If we're here, what we were about to output is not supported\n\t\tlet fallbackColor = /** @type {PlainColorObject} */ (color);\n\n\t\t// First, check if the culprit is none values\n\t\tlet hasNone = color.coords.some(isNone) || isNone(color.alpha);\n\n\t\tif (hasNone) {\n\t\t\t// Does the browser support none values?\n\t\t\tif (!(supportsNone ??= CSS.supports(\"color\", \"hsl(none 50% 50%)\"))) {\n\t\t\t\t// Nope, try again without none\n\t\t\t\tfallbackColor = clone(/** @type {PlainColorObject} */ (color));\n\t\t\t\tfallbackColor.coords = /** @type {[number, number, number]} */ (\n\t\t\t\t\tfallbackColor.coords.map(skipNone)\n\t\t\t\t);\n\t\t\t\tfallbackColor.alpha = skipNone(fallbackColor.alpha);\n\n\t\t\t\t// @ts-expect-error This is set to the correct type later\n\t\t\t\tret = serialize(fallbackColor, options);\n\n\t\t\t\tif (CSS.supports(\"color\", /** @type {string} */ (ret))) {\n\t\t\t\t\t// We're done, now it's supported\n\t\t\t\t\tret = /** @type {Display} */ (new String(ret));\n\t\t\t\t\tret.color = fallbackColor;\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If we're here, the color function is not supported\n\t\t// Fall back to fallback space\n\t\tfallbackColor = to(fallbackColor, space);\n\t\tret = /** @type {Display} */ (new String(serialize(fallbackColor, options)));\n\t\tret.color = fallbackColor;\n\t}\n\n\treturn ret;\n}\n","import getColor from \"./getColor.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport to from \"./to.js\";\nimport { adjust } from \"./angles.js\";\nimport { isNone } from \"./util.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").DeltasReturn} DeltasReturn */\n\n/**\n * Get color differences per-component, on any color space\n * @param {ColorTypes} c1\n * @param {ColorTypes} c2\n * @param {object} options\n * @param {string | ColorSpace} [options.space=c1.space] - The color space to use for the delta calculation. Defaults to the color space of the first color.\n * @param {Parameters<typeof adjust>[0]} [options.hue=\"shorter\"] - How to handle hue differences. Same as hue interpolation option.\n * @returns {DeltasReturn}\n */\nexport default function deltas (c1, c2, { space, hue = \"shorter\" } = {}) {\n\tc1 = getColor(c1);\n\tspace ||= c1.space;\n\tspace = ColorSpace.get(space);\n\tlet spaceCoords = Object.values(space.coords);\n\n\t[c1, c2] = [c1, c2].map(c => to(c, space));\n\tlet [coords1, coords2] = [c1, c2].map(c => c.coords);\n\n\tlet coords = /** @type {[number, number, number]} */ (\n\t\tcoords1.map((coord1, i) => {\n\t\t\tlet coordMeta = spaceCoords[i];\n\t\t\tlet coord2 = coords2[i];\n\n\t\t\tif (coordMeta.type === \"angle\") {\n\t\t\t\t[coord1, coord2] = adjust(hue, [coord1, coord2]);\n\t\t\t}\n\n\t\t\treturn subtractCoords(coord1, coord2);\n\t\t})\n\t);\n\n\tlet alpha = subtractCoords(c1.alpha, c2.alpha);\n\n\treturn { space: /** @type {ColorSpace} */ (space), coords, alpha };\n}\n\nfunction subtractCoords (c1, c2) {\n\tif (isNone(c1) || isNone(c2)) {\n\t\treturn c1 === c2 ? null : 0;\n\t}\n\n\treturn c1 - c2;\n}\n","/**\n * Relative luminance\n */\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport xyz_d65 from \"./spaces/xyz-d65.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n/**\n *\n * @param {ColorTypes} color\n * @returns {number}\n */\nexport function getLuminance (color) {\n\t// Assume getColor() is called on color in get()\n\treturn get(color, [xyz_d65, \"y\"]);\n}\n\n/**\n * @param {ColorTypes} color\n * @param {number | ((coord: number) => number)} value\n */\nexport function setLuminance (color, value) {\n\t// Assume getColor() is called on color in set()\n\tset(color, [xyz_d65, \"y\"], value);\n}\n\n/**\n * @param {typeof import(\"./color.js\").default} Color\n */\nexport function register (Color) {\n\tObject.defineProperty(Color.prototype, \"luminance\", {\n\t\tget () {\n\t\t\treturn getLuminance(this);\n\t\t},\n\t\tset (value) {\n\t\t\tsetLuminance(this, value);\n\t\t},\n\t});\n}\n","// WCAG 2.0 contrast https://www.w3.org/TR/WCAG20-TECHS/G18.html\n// Simple contrast, with fixed 5% viewing flare contribution\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastWCAG21 (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn (Y1 + 0.05) / (Y2 + 0.05);\n}\n","// APCA 0.0.98G\n// https://github.com/Myndex/apca-w3\n// see also https://github.com/w3c/silver/issues/643\n\nimport getColor from \"../getColor.js\";\nimport to from \"../to.js\";\nimport { isNone } from \"../util.js\";\n\n// exponents\nconst normBG = 0.56;\nconst normTXT = 0.57;\nconst revTXT = 0.62;\nconst revBG = 0.65;\n\n// clamps\nconst blkThrs = 0.022;\nconst blkClmp = 1.414;\nconst loClip = 0.1;\nconst deltaYmin = 0.0005;\n\n// scalers\n// see https://github.com/w3c/silver/issues/645\nconst scaleBoW = 1.14;\nconst loBoWoffset = 0.027;\nconst scaleWoB = 1.14;\nconst loWoBoffset = 0.027;\n\nfunction fclamp (Y) {\n\tif (Y >= blkThrs) {\n\t\treturn Y;\n\t}\n\treturn Y + (blkThrs - Y) ** blkClmp;\n}\n\nfunction linearize (val) {\n\tlet sign = val < 0 ? -1 : 1;\n\tlet abs = Math.abs(val);\n\treturn sign * Math.pow(abs, 2.4);\n}\n\n/**\n * Not symmetric, requires a foreground (text) color, and a background color\n * @param {import(\"../types.js\").ColorTypes} background\n * @param {import(\"../types.js\").ColorTypes} foreground\n * @returns {number}\n */\nexport default function contrastAPCA (background, foreground) {\n\tforeground = getColor(foreground);\n\tbackground = getColor(background);\n\n\tlet S;\n\tlet C;\n\tlet Sapc;\n\n\t// Myndex as-published, assumes sRGB inputs\n\tlet R, G, B;\n\n\tforeground = to(foreground, \"srgb\");\n\t// Should these be clamped to in-gamut values?\n\n\t// Calculates \"screen luminance\" with non-standard simple gamma EOTF\n\t// weights should be from CSS Color 4, not the ones here which are via Myndex and copied from Lindbloom\n\t[R, G, B] = foreground.coords.map(c => {\n\t\treturn isNone(c) ? 0 : c;\n\t});\n\tlet lumTxt = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.072175;\n\n\tbackground = to(background, \"srgb\");\n\t[R, G, B] = background.coords.map(c => {\n\t\treturn isNone(c) ? 0 : c;\n\t});\n\tlet lumBg = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.072175;\n\n\t// toe clamping of very dark values to account for flare\n\tlet Ytxt = fclamp(lumTxt);\n\tlet Ybg = fclamp(lumBg);\n\n\t// are we \"Black on White\" (dark on light), or light on dark?\n\tlet BoW = Ybg > Ytxt;\n\n\t// why is this a delta, when Y is not perceptually uniform?\n\t// Answer: it is a noise gate, see\n\t// https://github.com/LeaVerou/color.js/issues/208\n\tif (Math.abs(Ybg - Ytxt) < deltaYmin) {\n\t\tC = 0;\n\t}\n\telse {\n\t\tif (BoW) {\n\t\t\t// dark text on light background\n\t\t\tS = Ybg ** normBG - Ytxt ** normTXT;\n\t\t\tC = S * scaleBoW;\n\t\t}\n\t\telse {\n\t\t\t// light text on dark background\n\t\t\tS = Ybg ** revBG - Ytxt ** revTXT;\n\t\t\tC = S * scaleWoB;\n\t\t}\n\t}\n\tif (Math.abs(C) < loClip) {\n\t\tSapc = 0;\n\t}\n\telse if (C > 0) {\n\t\t// not clear whether Woffset is loBoWoffset or loWoBoffset\n\t\t// but they have the same value\n\t\tSapc = C - loBoWoffset;\n\t}\n\telse {\n\t\tSapc = C + loBoWoffset;\n\t}\n\n\treturn Sapc * 100;\n}\n","// Michelson  luminance contrast\n// the relation between the spread and the sum of the two luminances\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastMichelson (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\tlet denom = Y1 + Y2;\n\treturn denom === 0 ? 0 : (Y1 - Y2) / denom;\n}\n","// Weber luminance contrast\n// The difference between the two luminances divided by the lower luminance\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n// the darkest sRGB color above black is #000001 and this produces\n// a plain Weber contrast of ~45647.\n// So, setting the divide-by-zero result at 50000 is a reasonable\n// max clamp for the plain Weber\nconst max = 50000;\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastWeber (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn Y2 === 0 ? max : (Y1 - Y2) / Y2;\n}\n","// CIE Lightness difference, as used by Google Material Design\n// Google HCT Tone is the same as CIE Lightness\n// https://material.io/blog/science-of-color-design\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab from \"../spaces/lab.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastLstar (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet L1 = get(color1, [lab, \"l\"]);\n\tlet L2 = get(color2, [lab, \"l\"]);\n\n\treturn Math.abs(L1 - L2);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27; // 29^3/3^3\n\nlet white = WHITES.D65;\n\nexport default new ColorSpace({\n\tid: \"lab-d65\",\n\tname: \"Lab D65\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D65, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d65,\n\t// Convert D65-adapted XYZ to Lab\n\t//  CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// compute xyz, which is XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\n\t\t// now compute f\n\t\tlet f = xyz.map(value => (value > ε ? Math.cbrt(value) : (κ * value + 16) / 116));\n\n\t\treturn [\n\t\t\t116 * f[1] - 16, // L\n\t\t\t500 * (f[0] - f[1]), // a\n\t\t\t200 * (f[1] - f[2]), // b\n\t\t];\n\t},\n\t// Convert Lab to D65-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet f = [];\n\t\tf[1] = (Lab[0] + 16) / 116;\n\t\tf[0] = Lab[1] / 500 + f[1];\n\t\tf[2] = f[1] - Lab[2] / 200;\n\n\t\t// compute xyz\n\t\tlet xyz = [\n\t\t\tf[0] > ε3 ? Math.pow(f[0], 3) : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8 ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2] > ε3 ? Math.pow(f[2], 3) : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\t\"lab-d65\": {\n\t\t\tcoords: [\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","// Delta Phi Star perceptual lightness contrast\n// See https://github.com/Myndex/deltaphistar\n// The (difference between two Lstars each raised to phi) raised to (1/phi)\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab_d65 from \"../spaces/lab-d65.js\";\n\nconst phi = Math.pow(5, 0.5) * 0.5 + 0.5; // Math.phi can be used if Math.js\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastDeltaPhi (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Lstr1 = get(color1, [lab_d65, \"l\"]);\n\tlet Lstr2 = get(color2, [lab_d65, \"l\"]);\n\n\tlet deltaPhiStar = Math.abs(Math.pow(Lstr1, phi) - Math.pow(Lstr2, phi));\n\n\tlet contrast = Math.pow(deltaPhiStar, 1 / phi) * Math.SQRT2 - 40;\n\n\treturn contrast < 7.5 ? 0.0 : contrast;\n}\n","import xyz_d65 from \"./spaces/xyz-d65.js\";\nimport getAll from \"./getAll.js\";\n\n/** @import Color, { ColorTypes } from \"./color.js\" */\n\n// Chromaticity coordinates\n/**\n * @param {ColorTypes} color\n * @returns {[number, number]}\n */\nexport function uv (color) {\n\t// Assumes getAll() calls getColor() on color\n\tlet [X, Y, Z] = getAll(color, xyz_d65);\n\tlet denom = X + 15 * Y + 3 * Z;\n\treturn [(4 * X) / denom, (9 * Y) / denom];\n}\n\n/**\n * @param {ColorTypes} color\n * @returns {[number, number]}\n */\nexport function xy (color) {\n\t// Assumes getAll() calls getColor() on color\n\tlet [X, Y, Z] = getAll(color, xyz_d65);\n\tlet sum = X + Y + Z;\n\treturn [X / sum, Y / sum];\n}\n\n/**\n * @param {typeof Color} Color\n */\nexport function register (Color) {\n\t// no setters, as lightness information is lost\n\t// when converting color to chromaticity\n\tObject.defineProperty(Color.prototype, \"uv\", {\n\t\tget () {\n\t\t\treturn uv(this);\n\t\t},\n\t});\n\n\tObject.defineProperty(Color.prototype, \"xy\", {\n\t\tget () {\n\t\t\treturn xy(this);\n\t\t},\n\t});\n}\n","import defaults from \"./defaults.js\";\nimport { isString } from \"./util.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Methods} Methods */\n\n/**\n *\n * @param {ColorTypes} c1\n * @param {ColorTypes} c2\n * @param {Methods | ({ method?: Methods | undefined } & Record<string, any>)} [o]\n * deltaE method to use as well as any other options to pass to the deltaE function\n * @returns {number}\n * @throws {TypeError} Unknown or unspecified method\n */\nexport default function deltaE (c1, c2, o = {}) {\n\tif (isString(o)) {\n\t\to = { method: o };\n\t}\n\n\tlet { method = defaults.deltaE, ...rest } = o;\n\n\tfor (let m in deltaEMethods) {\n\t\tif (\"deltae\" + method.toLowerCase() === m.toLowerCase()) {\n\t\t\treturn deltaEMethods[m](c1, c2, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown deltaE method: ${method}`);\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport set from \"./set.js\";\n\n/** @import { ColorTypes, PlainColorObject, Ref } from \"./types.js\" */\n\n/**\n * @param {ColorTypes} color\n * @param {number} amount\n * @returns {PlainColorObject}\n */\nexport function lighten (color, amount = 0.25) {\n\tlet space = ColorSpace.get(\"oklch\", \"lch\");\n\tlet /** @type {Ref} */ lightness = [space, \"l\"];\n\treturn set(color, lightness, l => l * (1 + amount));\n}\n\n/**\n * @param {ColorTypes} color\n * @param {number} amount\n * @returns {PlainColorObject}\n */\nexport function darken (color, amount = 0.25) {\n\tlet space = ColorSpace.get(\"oklch\", \"lch\");\n\tlet /** @type {Ref} */ lightness = [space, \"l\"];\n\treturn set(color, lightness, l => l * (1 - amount));\n}\n\n/** @type {\"color\"} */\nlighten.returns = \"color\";\n\n/** @type {\"color\"} */\ndarken.returns = \"color\";\n","/**\n * Functions related to color interpolation\n */\nimport ColorSpace from \"./ColorSpace.js\";\nimport { type, interpolate, isNone } from \"./util.js\";\nimport getColor from \"./getColor.js\";\nimport clone from \"./clone.js\";\nimport to from \"./to.js\";\nimport toGamut from \"./toGamut.js\";\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport defaults from \"./defaults.js\";\nimport * as angles from \"./angles.js\";\nimport deltaE from \"./deltaE.js\";\n\n/** @import { ColorTypes, PlainColorObject, Ref } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").MixOptions} MixOptions */\n/** @typedef {import(\"./types.js\").Range} Range */\n/** @typedef {import(\"./types.js\").RangeOptions} RangeOptions */\n/** @typedef {import(\"./types.js\").StepsOptions} StepsOptions */\n\n/**\n * Return an intermediate color between two colors\n * @overload\n * @param {ColorTypes} c1\n * @param {ColorTypes} c2\n * @param {MixOptions} [options]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} c1\n * @param {ColorTypes} c2\n * @param {number} [p=0.5]\n * @param {MixOptions} [options]\n * @returns {PlainColorObject}\n */\nexport function mix (c1, c2, p, o = {}) {\n\t[c1, c2] = [getColor(c1), getColor(c2)];\n\n\tif (type(p) === \"object\") {\n\t\t[p, o] = [0.5, p];\n\t}\n\n\tlet r = range(c1, c2, o);\n\treturn r(p ?? 0.5); // why not give p a default value like we do for options? Overloading doesn't work, and TS complains\n}\n\n/**\n * Get an array of discrete steps\n * @overload\n * @param {ColorTypes} c1\n * @param {ColorTypes} c2\n * @param {StepsOptions} [options]\n * @returns {PlainColorObject[]}\n */\n/**\n * @overload\n * @param {Range} range\n * @param {StepsOptions} [options]\n * @returns {PlainColorObject[]}\n */\nexport function steps (c1, c2, options = {}) {\n\tlet colorRange;\n\n\tif (isRange(c1)) {\n\t\t// Tweaking existing range\n\t\t[colorRange, options] = [c1, c2];\n\t\t[c1, c2] = colorRange.rangeArgs.colors;\n\t}\n\n\tlet { maxDeltaE, deltaEMethod, steps = 2, maxSteps = 1000, ...rangeOptions } = options;\n\n\tif (!colorRange) {\n\t\t[c1, c2] = [getColor(c1), getColor(c2)];\n\t\tcolorRange = range(c1, c2, rangeOptions);\n\t}\n\n\tlet totalDelta = deltaE(c1, c2);\n\tlet actualSteps =\n\t\tmaxDeltaE > 0 ? Math.max(steps, Math.ceil(totalDelta / maxDeltaE) + 1) : steps;\n\tlet ret = [];\n\n\tif (maxSteps !== undefined) {\n\t\tactualSteps = Math.min(actualSteps, maxSteps);\n\t}\n\n\tif (actualSteps === 1) {\n\t\tret = [{ p: 0.5, color: colorRange(0.5) }];\n\t}\n\telse {\n\t\tlet step = 1 / (actualSteps - 1);\n\t\tret = Array.from({ length: actualSteps }, (_, i) => {\n\t\t\tlet p = i * step;\n\t\t\treturn { p, color: colorRange(p) };\n\t\t});\n\t}\n\n\tif (maxDeltaE > 0) {\n\t\t// Iterate over all stops and find max deltaE\n\t\tlet maxDelta = ret.reduce((acc, cur, i) => {\n\t\t\tif (i === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tlet ΔΕ = deltaE(cur.color, ret[i - 1].color, deltaEMethod);\n\t\t\treturn Math.max(acc, ΔΕ);\n\t\t}, 0);\n\n\t\twhile (maxDelta > maxDeltaE) {\n\t\t\t// Insert intermediate stops and measure maxDelta again\n\t\t\t// We need to do this for all pairs, otherwise the midpoint shifts\n\t\t\tmaxDelta = 0;\n\n\t\t\tfor (let i = 1; i < ret.length && ret.length < maxSteps; i++) {\n\t\t\t\tlet prev = ret[i - 1];\n\t\t\t\tlet cur = ret[i];\n\n\t\t\t\tlet p = (cur.p + prev.p) / 2;\n\t\t\t\tlet color = colorRange(p);\n\t\t\t\tmaxDelta = Math.max(maxDelta, deltaE(color, prev.color), deltaE(color, cur.color));\n\t\t\t\tret.splice(i, 0, { p, color: colorRange(p) });\n\t\t\t\ti++;\n\t\t\t}\n\t\t}\n\t}\n\n\tret = ret.map(a => a.color);\n\n\treturn ret;\n}\n\n/**\n * Creates a function that accepts a number and returns a color.\n * For numbers in the range 0 to 1, the function interpolates;\n * for numbers outside that range, the function extrapolates\n * (and thus may not return the results you expect)\n * @overload\n * @param {Range} range\n * @param {RangeOptions} [options]\n * @returns {Range}\n */\n/**\n * @overload\n * @param {ColorTypes} color1\n * @param {ColorTypes} color2\n * @param {RangeOptions & Record<string, any>} [options]\n * @returns {Range}\n */\nexport function range (color1, color2, options = {}) {\n\tif (isRange(color1)) {\n\t\t// Tweaking existing range\n\t\tlet [r, options] = [color1, color2];\n\n\t\treturn range(...r.rangeArgs.colors, { ...r.rangeArgs.options, ...options });\n\t}\n\n\tlet { space, outputSpace, progression, premultiplied } = options;\n\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\t// Make sure we're working on copies of these colors\n\tcolor1 = clone(color1);\n\tcolor2 = clone(color2);\n\n\tlet rangeArgs = { colors: [color1, color2], options };\n\n\tif (space) {\n\t\tspace = ColorSpace.get(space);\n\t}\n\telse {\n\t\tspace = ColorSpace.registry[defaults.interpolationSpace] || color1.space;\n\t}\n\n\toutputSpace = outputSpace ? ColorSpace.get(outputSpace) : space;\n\n\tcolor1 = to(color1, space);\n\tcolor2 = to(color2, space);\n\n\t// Gamut map to avoid areas of flat color\n\tcolor1 = toGamut(color1);\n\tcolor2 = toGamut(color2);\n\n\t// Handle hue interpolation\n\t// See https://github.com/w3c/csswg-drafts/issues/4735#issuecomment-635741840\n\tif (space.coords.h && space.coords.h.type === \"angle\") {\n\t\tlet arc = (options.hue = options.hue || \"shorter\");\n\n\t\tlet /** @type {Ref} */ hue = [space, \"h\"];\n\t\tlet [θ1, θ2] = [get(color1, hue), get(color2, hue)];\n\t\t// Undefined hues must be evaluated before hue fix-up to properly\n\t\t// calculate hue arcs between undefined and defined hues.\n\t\t// See https://github.com/w3c/csswg-drafts/issues/9436#issuecomment-1746957545\n\t\tif (isNone(θ1) && !isNone(θ2)) {\n\t\t\tθ1 = θ2;\n\t\t}\n\t\telse if (isNone(θ2) && !isNone(θ1)) {\n\t\t\tθ2 = θ1;\n\t\t}\n\t\t[θ1, θ2] = angles.adjust(arc, [θ1, θ2]);\n\t\tset(color1, hue, θ1);\n\t\tset(color2, hue, θ2);\n\t}\n\n\tif (premultiplied) {\n\t\t// not coping with polar spaces yet\n\t\tcolor1.coords = /** @type {[number, number, number]} */ (\n\t\t\tcolor1.coords.map(c => c * color1.alpha)\n\t\t);\n\t\tcolor2.coords = /** @type {[number, number, number]} */ (\n\t\t\tcolor2.coords.map(c => c * color2.alpha)\n\t\t);\n\t}\n\n\treturn Object.assign(\n\t\tp => {\n\t\t\tp = progression ? progression(p) : p;\n\t\t\tlet coords = color1.coords.map((start, i) => {\n\t\t\t\tlet end = color2.coords[i];\n\t\t\t\treturn interpolate(start, end, p);\n\t\t\t});\n\n\t\t\tlet alpha = interpolate(color1.alpha, color2.alpha, p);\n\t\t\tlet ret = { space, coords, alpha };\n\n\t\t\tif (premultiplied) {\n\t\t\t\t// undo premultiplication\n\t\t\t\tret.coords = ret.coords.map(c => c / alpha);\n\t\t\t}\n\n\t\t\tif (outputSpace !== space) {\n\t\t\t\tret = to(ret, outputSpace);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\t\t{\n\t\t\trangeArgs,\n\t\t},\n\t);\n}\n\n/**\n * @param {any} val\n * @returns {val is Range}\n */\nexport function isRange (val) {\n\treturn type(val) === \"function\" && !!val.rangeArgs;\n}\n\ndefaults.interpolationSpace = \"lab\";\n\n/**\n * @param {typeof import(\"./color.js\").default} Color\n */\nexport function register (Color) {\n\tColor.defineFunction(\"mix\", mix, { returns: \"color\" });\n\tColor.defineFunction(\"range\", range, { returns: \"function<color>\" });\n\tColor.defineFunction(\"steps\", steps, { returns: \"array<color>\" });\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new ColorSpace({\n\tid: \"hsl\",\n\tname: \"HSL\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\n\t// Adapted from https://drafts.csswg.org/css-color-4/better-rgbToHsl.js\n\tfromBase: rgb => {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, l] = [null, 0, (min + max) / 2];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\ts = l === 0 || l === 1 ? 0 : (max - l) / Math.min(l, 1 - l);\n\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\t// Very out of gamut colors can produce negative saturation\n\t\t// If so, just rotate the hue by 180 and use a positive saturation\n\t\t// see https://github.com/w3c/csswg-drafts/issues/9222\n\t\tif (s < 0) {\n\t\t\th += 180;\n\t\t\ts = Math.abs(s);\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, l * 100];\n\t},\n\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative\n\ttoBase: hsl => {\n\t\tlet [h, s, l] = hsl;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tl /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 30) % 12;\n\t\t\tlet a = s * Math.min(l, 1 - l);\n\t\t\treturn l - a * Math.max(-1, Math.min(k - 3, 9 - k, 1));\n\t\t}\n\n\t\treturn [f(0), f(8), f(4)];\n\t},\n\n\tformats: {\n\t\thsl: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t\thsla: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t\tcommas: true,\n\t\t\talpha: true,\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport sRGB from \"./srgb.js\";\n\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hsv\",\n\tname: \"HSV\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tv: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Value\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\t// https://en.wikipedia.org/wiki/HSL_and_HSV#Formal_derivation\n\tfromBase (rgb) {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, v] = [null, 0, max];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\tif (v) {\n\t\t\ts = d / v;\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, v * 100];\n\t},\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSV_to_RGB_alternative\n\ttoBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tv /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 60) % 6;\n\t\t\treturn v - v * s * Math.max(0, Math.min(k, 4 - k, 1));\n\t\t}\n\n\t\treturn [f(5), f(3), f(1)];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport HSV from \"./hsv.js\";\n\n// The Hue, Whiteness Blackness (HWB) colorspace\n// See https://drafts.csswg.org/css-color-4/#the-hwb-notation\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hwb\",\n\tname: \"HWB\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tw: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Whiteness\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Blackness\",\n\t\t},\n\t},\n\n\tbase: HSV,\n\tfromBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\n\t\treturn [h, (v * (100 - s)) / 100, 100 - v];\n\t},\n\ttoBase (hwb) {\n\t\tlet [h, w, b] = hwb;\n\n\t\t// Now convert percentages to [0..1]\n\t\tw /= 100;\n\t\tb /= 100;\n\n\t\t// Achromatic check (white plus black >= 1)\n\t\tlet sum = w + b;\n\t\tif (sum >= 1) {\n\t\t\tlet gray = w / sum;\n\t\t\treturn [h, 0, gray * 100];\n\t\t}\n\n\t\tlet v = 1 - b;\n\t\tlet s = v === 0 ? 0 : 1 - w / v;\n\t\treturn [h, s * 100, v * 100];\n\t},\n\n\tformats: {\n\t\thwb: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of linear-light a98-rgb values to CIE XYZ\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// has greater numerical precision than section 4.3.5.3 of\n// https://www.adobe.com/digitalimag/pdfs/AdobeRGB1998.pdf\n// but the values below were calculated from first principles\n// from the chromaticity coordinates of R G B W\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.5766690429101305,   0.1855582379065463,   0.1882286462349947  ],\n\t[ 0.29734497525053605,  0.6273635662554661,   0.07529145849399788 ],\n\t[ 0.02703136138641234,  0.07068885253582723,  0.9913375368376388  ],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  2.0415879038107465,    -0.5650069742788596,   -0.34473135077832956 ],\n\t[ -0.9692436362808795,     1.8759675015077202,    0.04155505740717557 ],\n\t[  0.013444280632031142,  -0.11836239223101838,   1.0151749943912054  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb-linear\",\n\tcssId: \"--a98-rgb-linear\",\n\tname: \"Linear Adobe® 98 RGB compatible\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport A98Linear from \"./a98rgb-linear.js\";\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb\",\n\tcssId: \"a98-rgb\",\n\tname: \"Adobe® 98 RGB compatible\",\n\tbase: A98Linear,\n\ttoBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 563 / 256) * Math.sign(val)),\n\tfromBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 256 / 563) * Math.sign(val)),\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport XYZ_D50 from \"./xyz-d50.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of  prophoto-rgb values to CIE XYZ\n// using  D50 (so no chromatic adaptation needed afterwards)\n// matrix cannot be expressed in rational form, but is calculated to 64 bit accuracy\n// see https://github.com/w3c/csswg-drafts/issues/7675\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.79776664490064230,  0.13518129740053308,  0.03134773412839220 ],\n\t[ 0.28807482881940130,  0.71183523424187300,  0.00008993693872564 ],\n\t[ 0.00000000000000000,  0.00000000000000000,  0.82510460251046020 ],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  1.34578688164715830, -0.25557208737979464, -0.05110186497554526 ],\n\t[ -0.54463070512490190,  1.50824774284514680,  0.02052744743642139 ],\n\t[  0.00000000000000000,  0.00000000000000000,  1.21196754563894520 ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"prophoto-linear\",\n\tcssId: \"--prophoto-rgb-linear\",\n\tname: \"Linear ProPhoto\",\n\twhite: \"D50\",\n\tbase: XYZ_D50,\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport ProPhotoLinear from \"./prophoto-linear.js\";\n\nconst Et = 1 / 512;\nconst Et2 = 16 / 512;\n\nexport default new RGBColorSpace({\n\tid: \"prophoto\",\n\tcssId: \"prophoto-rgb\",\n\tname: \"ProPhoto\",\n\tbase: ProPhotoLinear,\n\ttoBase (RGB) {\n\t\t// Transfer curve is gamma 1.8 with a small linear portion\n\t\treturn RGB.map(v => {\n\t\t\tlet sign = v < 0 ? -1 : 1;\n\t\t\tlet abs = v * sign;\n\n\t\t\tif (abs < Et2) {\n\t\t\t\treturn v / 16;\n\t\t\t}\n\n\t\t\treturn sign * abs ** 1.8;\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(v => {\n\t\t\tlet sign = v < 0 ? -1 : 1;\n\t\t\tlet abs = v * sign;\n\n\t\t\tif (abs >= Et) {\n\t\t\t\treturn sign * abs ** (1 / 1.8);\n\t\t\t}\n\n\t\t\treturn 16 * v;\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n// import sRGB from \"./srgb.js\";\n\nconst α = 1.09929682680944;\nconst β = 0.018053968510807;\n\nexport default new RGBColorSpace({\n\tid: \"--rec2020-oetf\",\n\tname: \"REC.2020_Scene_Referred\",\n\tbase: REC2020Linear,\n\treferred: \"scene\",\n\t// Non-linear transfer function from Rec. ITU-R BT.2020-2 table 4\n\ttoBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs < β * 4.5) {\n\t\t\t\treturn val / 4.5;\n\t\t\t}\n\n\t\t\treturn sign * Math.pow((abs + α - 1) / α, 1 / 0.45);\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs >= β) {\n\t\t\t\treturn sign * (α * Math.pow(abs, 0.45) - (α - 1));\n\t\t\t}\n\n\t\t\treturn 4.5 * val;\n\t\t});\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport OKLab from \"./oklab.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"oklch\",\n\tname: \"OkLCh\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 0.4],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\n\tbase: OKLab,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\toklch: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","// Okhsl class.\n//\n// ---- License ----\n//\n// Copyright (c) 2021 Björn Ottosson\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy of\n// this software and associated documentation files (the \"Software\"), to deal in\n// the Software without restriction, including without limitation the rights to\n// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n// of the Software, and to permit persons to whom the Software is furnished to do\n// so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\nimport ColorSpace from \"../ColorSpace.js\";\nimport Oklab from \"./oklab.js\";\nimport { LabtoLMS_M } from \"./oklab.js\";\nimport { spow, multiply_v3_m3x3 } from \"../util.js\";\nimport { constrain } from \"../angles.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"../types.js\").OKCoeff} OKCoeff */\n\nexport const tau = 2 * Math.PI;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const toLMS = [\n\t[0.4122214694707629, 0.5363325372617349, 0.0514459932675022],\n\t[0.2119034958178251, 0.6806995506452344, 0.1073969535369405],\n\t[0.0883024591900564, 0.2817188391361215, 0.6299787016738222],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const toSRGBLinear = [\n\t[ 4.0767416360759583, -3.3077115392580629,  0.2309699031821043],\n\t[-1.2684379732850315,  2.6097573492876882, -0.3413193760026570],\n\t[-0.0041960761386756, -0.7034186179359362,  1.7076146940746117],\n];\n\n/** @type {OKCoeff} */\nexport const RGBCoeff = [\n\t// Red\n\t[\n\t\t// Limit\n\t\t[-1.8817031, -0.80936501],\n\t\t// `Kn` coefficients\n\t\t[1.19086277, 1.76576728, 0.59662641, 0.75515197, 0.56771245],\n\t],\n\t// Green\n\t[\n\t\t// Limit\n\t\t[1.8144408, -1.19445267],\n\t\t// `Kn` coefficients\n\t\t[0.73956515, -0.45954404, 0.08285427, 0.12541073, -0.14503204],\n\t],\n\t// Blue\n\t[\n\t\t// Limit\n\t\t[0.13110758, 1.81333971],\n\t\t// `Kn` coefficients\n\t\t[1.35733652, -0.00915799, -1.1513021, -0.50559606, 0.00692167],\n\t],\n];\n\nconst floatMax = Number.MAX_VALUE;\nconst K1 = 0.206;\nconst K2 = 0.03;\nconst K3 = (1.0 + K1) / (1.0 + K2);\n\nfunction vdot (a, b) {\n\t// Dot two vectors\n\n\tlet l = a.length;\n\tif (l !== b.length) {\n\t\tthrow new Error(`Vectors of size ${l} and ${b.length} are not aligned`);\n\t}\n\n\tlet s = 0.0;\n\ta.forEach((c, i) => {\n\t\ts += c * b[i];\n\t});\n\n\treturn s;\n}\n\n/**\n * Toe function for L_r\n * @param {number} x\n */\nexport function toe (x) {\n\treturn 0.5 * (K3 * x - K1 + Math.sqrt((K3 * x - K1) * (K3 * x - K1) + 4 * K2 * K3 * x));\n}\n\n/**\n * Inverse toe function for L_r\n * @param {number} x\n */\nexport function toeInv (x) {\n\treturn (x ** 2 + K1 * x) / (K3 * (x + K2));\n}\n\n/**\n * @param {readonly [number, number]} cusp\n * @returns {[number, number]}\n */\nexport function toSt (cusp) {\n\t// To ST.\n\n\tlet [l, c] = cusp;\n\treturn [c / l, c / (1 - l)];\n}\n\nfunction getStMid (a, b) {\n\t// Returns a smooth approximation of the location of the cusp.\n\t//\n\t// This polynomial was created by an optimization process.\n\t// It has been designed so that S_mid < S_max and T_mid < T_max.\n\n\t// prettier-ignore\n\tlet s = 0.11516993 + 1.0 / (\n\t\t7.44778970 + 4.15901240 * b +\n\t\ta * (\n\t\t\t-2.19557347 + 1.75198401 * b +\n\t\t\ta * (\n\t\t\t\t-2.13704948 - 10.02301043 * b +\n\t\t\t\ta * (\n\t\t\t\t\t-4.24894561 + 5.38770819 * b + 4.69891013 * a\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t);\n\n\t// prettier-ignore\n\tlet t = 0.11239642 + 1.0 / (\n\t\t1.61320320 - 0.68124379 * b +\n\t\ta * (\n\t\t\t0.40370612 + 0.90148123 * b +\n\t\t\ta * (\n\t\t\t\t-0.27087943 + 0.61223990 * b +\n\t\t\t\ta * (\n\t\t\t\t\t0.00299215 - 0.45399568 * b - 0.14661872 * a\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t);\n\n\treturn [s, t];\n}\n\n/**\n * @param {Vector3} lab\n * @param {Matrix3x3} lmsToRgb\n */\nexport function oklabToLinearRGB (lab, lmsToRgb) {\n\t// Convert from Oklab to linear RGB.\n\t//\n\t// Can be any gamut as long as `lmsToRgb` is a matrix\n\t// that transform the LMS values to the linear RGB space.\n\n\tlet lms = multiply_v3_m3x3(lab, LabtoLMS_M);\n\n\tlms[0] = lms[0] ** 3;\n\tlms[1] = lms[1] ** 3;\n\tlms[2] = lms[2] ** 3;\n\n\treturn multiply_v3_m3x3(lms, lmsToRgb, lms);\n}\n\n/**\n * @param {number} a\n * @param {number} b\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @returns {[number, number]}\n * @todo Could probably make these types more specific/better-documented if desired\n */\nexport function findCusp (a, b, lmsToRgb, okCoeff) {\n\t// Finds L_cusp and C_cusp for a given hue.\n\t//\n\t// `a` and `b` must be normalized so `a^2 + b^2 == 1`.\n\n\t// First, find the maximum saturation (saturation `S = C/L`)\n\tlet sCusp = computeMaxSaturation(a, b, lmsToRgb, okCoeff);\n\n\t// Convert to linear RGB to find the first point where at least one of r, g or b >= 1:\n\tlet rgb = oklabToLinearRGB([1, sCusp * a, sCusp * b], lmsToRgb);\n\tlet lCusp = spow(1.0 / Math.max(...rgb), 1 / 3);\n\tlet cCusp = lCusp * sCusp;\n\n\treturn [lCusp, cCusp];\n}\n\n/**\n * @param {number} a\n * @param {number} b\n * @param {number} l1\n * @param {number} c1\n * @param {number} l0\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @param {[number, number]} cusp\n * @returns {Number}\n * @todo Could probably make these types more specific/better-documented if desired\n */\nexport function findGamutIntersection (a, b, l1, c1, l0, lmsToRgb, okCoeff, cusp) {\n\t// Finds intersection of the line.\n\t//\n\t// Defined by the following:\n\t//\n\t// ```\n\t// L = L0 * (1 - t) + t * L1\n\t// C = t * C1\n\t// ```\n\t//\n\t// `a` and `b` must be normalized so `a^2 + b^2 == 1`.\n\n\tlet t;\n\n\tif (cusp === undefined) {\n\t\tcusp = findCusp(a, b, lmsToRgb, okCoeff);\n\t}\n\n\t// Find the intersection for upper and lower half separately\n\tif ((l1 - l0) * cusp[1] - (cusp[0] - l0) * c1 <= 0.0) {\n\t\t// Lower half\n\t\tt = (cusp[1] * l0) / (c1 * cusp[0] + cusp[1] * (l0 - l1));\n\t}\n\telse {\n\t\t// Upper half\n\n\t\t// First intersect with triangle\n\t\tt = (cusp[1] * (l0 - 1.0)) / (c1 * (cusp[0] - 1.0) + cusp[1] * (l0 - l1));\n\n\t\t// Then one step Halley's method\n\t\tlet dl = l1 - l0;\n\t\tlet dc = c1;\n\n\t\tlet kl = vdot(LabtoLMS_M[0].slice(1), [a, b]);\n\t\tlet km = vdot(LabtoLMS_M[1].slice(1), [a, b]);\n\t\tlet ks = vdot(LabtoLMS_M[2].slice(1), [a, b]);\n\n\t\tlet ldt_ = dl + dc * kl;\n\t\tlet mdt_ = dl + dc * km;\n\t\tlet sdt_ = dl + dc * ks;\n\n\t\t// If higher accuracy is required, 2 or 3 iterations of the following block can be used:\n\t\tlet L = l0 * (1.0 - t) + t * l1;\n\t\tlet C = t * c1;\n\n\t\tlet l_ = L + C * kl;\n\t\tlet m_ = L + C * km;\n\t\tlet s_ = L + C * ks;\n\n\t\tlet l = l_ ** 3;\n\t\tlet m = m_ ** 3;\n\t\tlet s = s_ ** 3;\n\n\t\tlet ldt = 3 * ldt_ * l_ ** 2;\n\t\tlet mdt = 3 * mdt_ * m_ ** 2;\n\t\tlet sdt = 3 * sdt_ * s_ ** 2;\n\n\t\tlet ldt2 = 6 * ldt_ ** 2 * l_;\n\t\tlet mdt2 = 6 * mdt_ ** 2 * m_;\n\t\tlet sdt2 = 6 * sdt_ ** 2 * s_;\n\n\t\tlet r_ = vdot(lmsToRgb[0], [l, m, s]) - 1;\n\t\tlet r1 = vdot(lmsToRgb[0], [ldt, mdt, sdt]);\n\t\tlet r2 = vdot(lmsToRgb[0], [ldt2, mdt2, sdt2]);\n\n\t\tlet ur = r1 / (r1 * r1 - 0.5 * r_ * r2);\n\t\tlet tr = -r_ * ur;\n\n\t\tlet g_ = vdot(lmsToRgb[1], [l, m, s]) - 1;\n\t\tlet g1 = vdot(lmsToRgb[1], [ldt, mdt, sdt]);\n\t\tlet g2 = vdot(lmsToRgb[1], [ldt2, mdt2, sdt2]);\n\n\t\tlet ug = g1 / (g1 * g1 - 0.5 * g_ * g2);\n\t\tlet tg = -g_ * ug;\n\n\t\tlet b_ = vdot(lmsToRgb[2], [l, m, s]) - 1;\n\t\tlet b1 = vdot(lmsToRgb[2], [ldt, mdt, sdt]);\n\t\tlet b2 = vdot(lmsToRgb[2], [ldt2, mdt2, sdt2]);\n\n\t\tlet ub = b1 / (b1 * b1 - 0.5 * b_ * b2);\n\t\tlet tb = -b_ * ub;\n\n\t\ttr = ur >= 0.0 ? tr : floatMax;\n\t\ttg = ug >= 0.0 ? tg : floatMax;\n\t\ttb = ub >= 0.0 ? tb : floatMax;\n\n\t\tt += Math.min(tr, Math.min(tg, tb));\n\t}\n\n\treturn t;\n}\n\nfunction getCs (lab, lmsToRgb, okCoeff) {\n\t// Get Cs\n\n\tlet [l, a, b] = lab;\n\n\tlet cusp = findCusp(a, b, lmsToRgb, okCoeff);\n\n\tlet cMax = findGamutIntersection(a, b, l, 1, l, lmsToRgb, okCoeff, cusp);\n\tlet stMax = toSt(cusp);\n\n\t// Scale factor to compensate for the curved part of gamut shape:\n\tlet k = cMax / Math.min(l * stMax[0], (1 - l) * stMax[1]);\n\n\tlet stMid = getStMid(a, b);\n\n\t// Use a soft minimum function, instead of a sharp triangle shape to get a smooth value for chroma.\n\tlet ca = l * stMid[0];\n\tlet cb = (1.0 - l) * stMid[1];\n\tlet cMid = 0.9 * k * Math.sqrt(Math.sqrt(1.0 / (1.0 / ca ** 4 + 1.0 / cb ** 4)));\n\n\t// For `C_0`, the shape is independent of hue, so `ST` are constant.\n\t// Values picked to roughly be the average values of `ST`.\n\tca = l * 0.4;\n\tcb = (1.0 - l) * 0.8;\n\n\t// Use a soft minimum function, instead of a sharp triangle shape to get a smooth value for chroma.\n\tlet c0 = Math.sqrt(1.0 / (1.0 / ca ** 2 + 1.0 / cb ** 2));\n\n\treturn [c0, cMid, cMax];\n}\n\nfunction computeMaxSaturation (a, b, lmsToRgb, okCoeff) {\n\t// Finds the maximum saturation possible for a given hue that fits in RGB.\n\t//\n\t// Saturation here is defined as `S = C/L`.\n\t// `a` and `b` must be normalized so `a^2 + b^2 == 1`.\n\n\t// Max saturation will be when one of r, g or b goes below zero.\n\n\t// Select different coefficients depending on which component goes below zero first.\n\n\tlet k0, k1, k2, k3, k4, wl, wm, ws;\n\n\tif (vdot(okCoeff[0][0], [a, b]) > 1) {\n\t\t// Red component\n\t\t[k0, k1, k2, k3, k4] = okCoeff[0][1];\n\t\t[wl, wm, ws] = lmsToRgb[0];\n\t}\n\telse if (vdot(okCoeff[1][0], [a, b]) > 1) {\n\t\t// Green component\n\t\t[k0, k1, k2, k3, k4] = okCoeff[1][1];\n\t\t[wl, wm, ws] = lmsToRgb[1];\n\t}\n\telse {\n\t\t// Blue component\n\t\t[k0, k1, k2, k3, k4] = okCoeff[2][1];\n\t\t[wl, wm, ws] = lmsToRgb[2];\n\t}\n\n\t// Approximate max saturation using a polynomial:\n\tlet sat = k0 + k1 * a + k2 * b + k3 * a ** 2 + k4 * a * b;\n\n\t// Do one step Halley's method to get closer.\n\t// This gives an error less than 10e6, except for some blue hues where the `dS/dh` is close to infinite.\n\t// This should be sufficient for most applications, otherwise do two/three steps.\n\n\tlet kl = vdot(LabtoLMS_M[0].slice(1), [a, b]);\n\tlet km = vdot(LabtoLMS_M[1].slice(1), [a, b]);\n\tlet ks = vdot(LabtoLMS_M[2].slice(1), [a, b]);\n\n\tlet l_ = 1.0 + sat * kl;\n\tlet m_ = 1.0 + sat * km;\n\tlet s_ = 1.0 + sat * ks;\n\n\tlet l = l_ ** 3;\n\tlet m = m_ ** 3;\n\tlet s = s_ ** 3;\n\n\tlet lds = 3.0 * kl * l_ ** 2;\n\tlet mds = 3.0 * km * m_ ** 2;\n\tlet sds = 3.0 * ks * s_ ** 2;\n\n\tlet lds2 = 6.0 * kl ** 2 * l_;\n\tlet mds2 = 6.0 * km ** 2 * m_;\n\tlet sds2 = 6.0 * ks ** 2 * s_;\n\n\tlet f = wl * l + wm * m + ws * s;\n\tlet f1 = wl * lds + wm * mds + ws * sds;\n\tlet f2 = wl * lds2 + wm * mds2 + ws * sds2;\n\n\tsat = sat - (f * f1) / (f1 ** 2 - 0.5 * f * f2);\n\n\treturn sat;\n}\n\nfunction okhslToOklab (hsl, lmsToRgb, okCoeff) {\n\t// Convert Okhsl to Oklab.\n\n\tlet [h, s, l] = hsl;\n\tlet L = toeInv(l);\n\tlet a = null;\n\tlet b = null;\n\th = constrain(h) / 360.0;\n\n\tif (L !== 0.0 && L !== 1.0 && s !== 0) {\n\t\tlet a_ = Math.cos(tau * h);\n\t\tlet b_ = Math.sin(tau * h);\n\n\t\tlet [c0, cMid, cMax] = getCs([L, a_, b_], lmsToRgb, okCoeff);\n\n\t\t// Interpolate the three values for C so that:\n\t\t// ```\n\t\t// At s=0: dC/ds = C_0, C=0\n\t\t// At s=0.8: C=C_mid\n\t\t// At s=1.0: C=C_max\n\t\t// ```\n\n\t\tlet mid = 0.8;\n\t\tlet midInv = 1.25;\n\t\tlet t, k0, k1, k2;\n\n\t\tif (s < mid) {\n\t\t\tt = midInv * s;\n\t\t\tk0 = 0.0;\n\t\t\tk1 = mid * c0;\n\t\t\tk2 = 1.0 - k1 / cMid;\n\t\t}\n\t\telse {\n\t\t\tt = 5 * (s - 0.8);\n\t\t\tk0 = cMid;\n\t\t\tk1 = (0.2 * cMid ** 2 * 1.25 ** 2) / c0;\n\t\t\tk2 = 1.0 - k1 / (cMax - cMid);\n\t\t}\n\n\t\tlet c = k0 + (t * k1) / (1.0 - k2 * t);\n\n\t\ta = c * a_;\n\t\tb = c * b_;\n\t}\n\n\treturn [L, a, b];\n}\n\nfunction oklabToOkhsl (lab, lmsToRgb, okCoeff) {\n\t// Oklab to Okhsl.\n\n\t// Epsilon for lightness should approach close to 32 bit lightness\n\t// Epsilon for saturation just needs to be sufficiently close when denoting achromatic\n\tlet εL = 1e-7;\n\tlet εS = 1e-4;\n\tlet L = lab[0];\n\tlet s = 0.0;\n\tlet l = toe(L);\n\n\tlet c = Math.sqrt(lab[1] ** 2 + lab[2] ** 2);\n\tlet h = 0.5 + Math.atan2(-lab[2], -lab[1]) / tau;\n\n\tif (l !== 0.0 && l !== 1.0 && c !== 0) {\n\t\tlet a_ = lab[1] / c;\n\t\tlet b_ = lab[2] / c;\n\n\t\tlet [c0, cMid, cMax] = getCs([L, a_, b_], lmsToRgb, okCoeff);\n\n\t\tlet mid = 0.8;\n\t\tlet midInv = 1.25;\n\t\tlet k0, k1, k2, t;\n\n\t\tif (c < cMid) {\n\t\t\tk1 = mid * c0;\n\t\t\tk2 = 1.0 - k1 / cMid;\n\n\t\t\tt = c / (k1 + k2 * c);\n\t\t\ts = t * mid;\n\t\t}\n\t\telse {\n\t\t\tk0 = cMid;\n\t\t\tk1 = (0.2 * cMid ** 2 * midInv ** 2) / c0;\n\t\t\tk2 = 1.0 - k1 / (cMax - cMid);\n\n\t\t\tt = (c - k0) / (k1 + k2 * (c - k0));\n\t\t\ts = mid + 0.2 * t;\n\t\t}\n\t}\n\n\tconst achromatic = Math.abs(s) < εS;\n\tif (achromatic || l === 0.0 || Math.abs(1 - l) < εL) {\n\t\th = null;\n\t\t// Due to floating point imprecision near lightness of 1, we can end up\n\t\t// with really high around white, this is to provide consistency as\n\t\t// saturation can be really high for white due this imprecision.\n\t\tif (!achromatic) {\n\t\t\ts = 0.0;\n\t\t}\n\t}\n\telse {\n\t\th = constrain(h * 360);\n\t}\n\n\treturn [h, s, l];\n}\n\nexport default new ColorSpace({\n\tid: \"okhsl\",\n\tname: \"Okhsl\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: Oklab,\n\tgamutSpace: \"self\",\n\n\t// Convert Oklab to Okhsl\n\tfromBase (lab) {\n\t\treturn oklabToOkhsl(lab, toSRGBLinear, RGBCoeff);\n\t},\n\n\t// Convert Okhsl to Oklab\n\ttoBase (hsl) {\n\t\treturn okhslToOklab(hsl, toSRGBLinear, RGBCoeff);\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--okhsl\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport OKLab from \"./oklab.js\";\nimport { toe, toeInv } from \"./okhsl.js\";\n\nexport default new ColorSpace({\n\tid: \"oklrab\",\n\tname: \"Oklrab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t},\n\n\t// Note that XYZ is relative to D65\n\twhite: \"D65\",\n\n\tbase: OKLab,\n\tfromBase (oklab) {\n\t\treturn [toe(oklab[0]), oklab[1], oklab[2]];\n\t},\n\ttoBase (oklrab) {\n\t\treturn [toeInv(oklrab[0]), oklrab[1], oklrab[2]];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>[-1,1]\",\n\t\t\t\t\"<number> | <percentage>[-1,1]\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport OKLrab from \"./oklrab.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"oklrch\",\n\tname: \"Oklrch\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 0.4],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\n\tbase: OKLrab,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\tcolor: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>[0,1]\",\n\t\t\t\t\"<number> | <angle>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","// Okhsv class.\n//\n// ---- License ----\n//\n// Copyright (c) 2021 Björn Ottosson\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy of\n// this software and associated documentation files (the \"Software\"), to deal in\n// the Software without restriction, including without limitation the rights to\n// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n// of the Software, and to permit persons to whom the Software is furnished to do\n// so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\nimport ColorSpace from \"../ColorSpace.js\";\nimport Oklab from \"./oklab.js\";\nimport { spow, multiply_v3_m3x3 } from \"../util.js\";\nimport { constrain } from \"../angles.js\";\nimport {\n\ttau,\n\ttoe,\n\ttoeInv,\n\tfindCusp,\n\ttoSt,\n\toklabToLinearRGB,\n\ttoSRGBLinear,\n\tRGBCoeff,\n} from \"./okhsl.js\";\n\n/** @import { Coords, Matrix3x3, OKCoeff, Vector3 } from \"../types.js\" */\n\n/**\n *\n * @param {Vector3} hsv\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @returns {Coords}\n */\nfunction okhsvToOklab (hsv, lmsToRgb, okCoeff) {\n\t// Convert from Okhsv to Oklab.\"\"\"\n\n\tlet [h, s, v] = hsv;\n\th = constrain(h) / 360.0;\n\n\tlet l = toeInv(v);\n\tlet a = null;\n\tlet b = null;\n\n\t// Avoid processing gray or colors with undefined hues\n\tif (l !== 0.0 && s !== 0.0) {\n\t\tlet a_ = Math.cos(tau * h);\n\t\tlet b_ = Math.sin(tau * h);\n\n\t\tlet cusp = findCusp(a_, b_, lmsToRgb, okCoeff);\n\t\tlet [sMax, tMax] = toSt(cusp);\n\t\tlet s0 = 0.5;\n\t\tlet k = 1 - s0 / sMax;\n\n\t\t// first we compute L and V as if the gamut is a perfect triangle:\n\n\t\t// L, C when v==1:\n\t\tlet lv = 1 - (s * s0) / (s0 + tMax - tMax * k * s);\n\t\tlet cv = (s * tMax * s0) / (s0 + tMax - tMax * k * s);\n\n\t\tl = v * lv;\n\t\tlet c = v * cv;\n\n\t\t// then we compensate for both toe and the curved top part of the triangle:\n\t\tlet lvt = toeInv(lv);\n\t\tlet cvt = (cv * lvt) / lv;\n\n\t\tlet lNew = toeInv(l);\n\t\tc = (c * lNew) / l;\n\t\tl = lNew;\n\n\t\t// RGB scale\n\t\tlet [rs, gs, bs] = oklabToLinearRGB([lvt, a_ * cvt, b_ * cvt], lmsToRgb);\n\t\tlet scaleL = spow(1.0 / Math.max(Math.max(rs, gs), Math.max(bs, 0.0)), 1 / 3);\n\n\t\tl = l * scaleL;\n\t\tc = c * scaleL;\n\n\t\ta = c * a_;\n\t\tb = c * b_;\n\t}\n\n\treturn [l, a, b];\n}\n\n/**\n *\n * @param {Vector3} lab\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @returns {Coords}\n */\nfunction oklabToOkhsv (lab, lmsToRgb, okCoeff) {\n\t// Oklab to Okhsv.\n\n\t// Epsilon for saturation just needs to be sufficiently close when denoting achromatic\n\tlet ε = 1e-4;\n\tlet l = lab[0];\n\tlet s = 0.0;\n\tlet v = toe(l);\n\tlet c = Math.sqrt(lab[1] ** 2 + lab[2] ** 2);\n\tlet h = 0.5 + Math.atan2(-lab[2], -lab[1]) / tau;\n\n\tif (l !== 0.0 && l !== 1 && c !== 0.0) {\n\t\tlet a_ = lab[1] / c;\n\t\tlet b_ = lab[2] / c;\n\n\t\tlet cusp = findCusp(a_, b_, lmsToRgb, okCoeff);\n\t\tlet [sMax, tMax] = toSt(cusp);\n\t\tlet s0 = 0.5;\n\t\tlet k = 1 - s0 / sMax;\n\n\t\t// first we find `L_v`, `C_v`, `L_vt` and `C_vt`\n\t\tlet t = tMax / (c + l * tMax);\n\t\tlet lv = t * l;\n\t\tlet cv = t * c;\n\n\t\tlet lvt = toeInv(lv);\n\t\tlet cvt = (cv * lvt) / lv;\n\n\t\t// we can then use these to invert the step that compensates\n\t\t// for the toe and the curved top part of the triangle:\n\t\tlet [rs, gs, bs] = oklabToLinearRGB([lvt, a_ * cvt, b_ * cvt], lmsToRgb);\n\t\tlet scaleL = spow(1.0 / Math.max(Math.max(rs, gs), Math.max(bs, 0.0)), 1 / 3);\n\n\t\tl = l / scaleL;\n\t\tc = c / scaleL;\n\n\t\tc = (c * toe(l)) / l;\n\t\tl = toe(l);\n\n\t\t// we can now compute v and s:\n\t\tv = l / lv;\n\t\ts = ((s0 + tMax) * cv) / (tMax * s0 + tMax * k * cv);\n\t}\n\n\tif (Math.abs(s) < ε || v === 0.0) {\n\t\th = null;\n\t}\n\telse {\n\t\th = constrain(h * 360);\n\t}\n\n\treturn [h, s, v];\n}\n\nexport default new ColorSpace({\n\tid: \"okhsv\",\n\tname: \"Okhsv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tv: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Value\",\n\t\t},\n\t},\n\n\tbase: Oklab,\n\tgamutSpace: \"self\",\n\n\t// Convert Oklab to Okhsl\n\tfromBase (lab) {\n\t\treturn oklabToOkhsv(lab, toSRGBLinear, RGBCoeff);\n\t},\n\n\t// Convert Okhsl to Oklab\n\ttoBase (hsl) {\n\t\treturn okhsvToOklab(hsl, toSRGBLinear, RGBCoeff);\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--okhsv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport { uv } from \"../chromaticity.js\";\nimport { isNone, skipNone } from \"../util.js\";\n\nlet white = WHITES.D65;\n\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27; // 29^3/3^3\nconst [U_PRIME_WHITE, V_PRIME_WHITE] = uv({ space: xyz_d65, coords: white });\n\nexport default new ColorSpace({\n\tid: \"luv\",\n\tname: \"Luv\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\t// Reference ranges from https://facelessuser.github.io/coloraide/colors/luv/\n\t\tu: {\n\t\t\trefRange: [-215, 215],\n\t\t},\n\t\tv: {\n\t\t\trefRange: [-215, 215],\n\t\t},\n\t},\n\n\twhite: white,\n\tbase: xyz_d65,\n\n\t// Convert D65-adapted XYZ to Luv\n\t// https://en.wikipedia.org/wiki/CIELUV#The_forward_transformation\n\tfromBase (XYZ) {\n\t\tlet xyz = /** @type {[number, number, number]} */ ([\n\t\t\tskipNone(XYZ[0]),\n\t\t\tskipNone(XYZ[1]),\n\t\t\tskipNone(XYZ[2]),\n\t\t]);\n\t\tlet y = xyz[1];\n\n\t\tlet [up, vp] = uv({ space: xyz_d65, coords: xyz });\n\n\t\t// Protect against XYZ of [0, 0, 0]\n\t\tif (!Number.isFinite(up) || !Number.isFinite(vp)) {\n\t\t\treturn [0, 0, 0];\n\t\t}\n\n\t\tlet L = y <= ε ? κ * y : 116 * Math.cbrt(y) - 16;\n\t\treturn [L, 13 * L * (up - U_PRIME_WHITE), 13 * L * (vp - V_PRIME_WHITE)];\n\t},\n\n\t// Convert Luv to D65-adapted XYZ\n\t// https://en.wikipedia.org/wiki/CIELUV#The_reverse_transformation\n\ttoBase (Luv) {\n\t\tlet [L, u, v] = Luv;\n\n\t\t// Protect against division by zero and none Lightness\n\t\tif (L === 0 || isNone(L)) {\n\t\t\treturn [0, 0, 0];\n\t\t}\n\n\t\tu = skipNone(u);\n\t\tv = skipNone(v);\n\n\t\tlet up = u / (13 * L) + U_PRIME_WHITE;\n\t\tlet vp = v / (13 * L) + V_PRIME_WHITE;\n\n\t\tlet y = L <= 8 ? L / κ : Math.pow((L + 16) / 116, 3);\n\n\t\treturn [y * ((9 * up) / (4 * vp)), y, y * ((12 - 3 * up - 20 * vp) / (4 * vp))];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--luv\",\n\t\t\tcoords: [\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport Luv from \"./luv.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"lchuv\",\n\tname: \"LChuv\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 220],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Luv,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--lchuv\",\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","/*\nAdapted from: https://github.com/hsluv/hsluv-javascript/blob/14b49e6cf9a9137916096b8487a5372626b57ba4/src/hsluv.ts\n\nCopyright (c) 2012-2022 Alexei Boronine\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nimport ColorSpace from \"../ColorSpace.js\";\nimport LCHuv from \"./lchuv.js\";\nimport sRGB from \"./srgb.js\";\nimport { fromXYZ_M } from \"./srgb-linear.js\";\nimport { skipNone } from \"../util.js\";\n\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27; // 29^3/3^3\n\nconst m_r0 = fromXYZ_M[0][0];\nconst m_r1 = fromXYZ_M[0][1];\nconst m_r2 = fromXYZ_M[0][2];\nconst m_g0 = fromXYZ_M[1][0];\nconst m_g1 = fromXYZ_M[1][1];\nconst m_g2 = fromXYZ_M[1][2];\nconst m_b0 = fromXYZ_M[2][0];\nconst m_b1 = fromXYZ_M[2][1];\nconst m_b2 = fromXYZ_M[2][2];\n\nfunction distanceFromOriginAngle (slope, intercept, angle) {\n\tconst d = intercept / (Math.sin(angle) - slope * Math.cos(angle));\n\treturn d < 0 ? Infinity : d;\n}\n\n/**\n * @param {number} l\n */\nexport function calculateBoundingLines (l) {\n\tconst sub1 = Math.pow(l + 16, 3) / 1560896;\n\tconst sub2 = sub1 > ε ? sub1 : l / κ;\n\tconst s1r = sub2 * (284517 * m_r0 - 94839 * m_r2);\n\tconst s2r = sub2 * (838422 * m_r2 + 769860 * m_r1 + 731718 * m_r0);\n\tconst s3r = sub2 * (632260 * m_r2 - 126452 * m_r1);\n\tconst s1g = sub2 * (284517 * m_g0 - 94839 * m_g2);\n\tconst s2g = sub2 * (838422 * m_g2 + 769860 * m_g1 + 731718 * m_g0);\n\tconst s3g = sub2 * (632260 * m_g2 - 126452 * m_g1);\n\tconst s1b = sub2 * (284517 * m_b0 - 94839 * m_b2);\n\tconst s2b = sub2 * (838422 * m_b2 + 769860 * m_b1 + 731718 * m_b0);\n\tconst s3b = sub2 * (632260 * m_b2 - 126452 * m_b1);\n\n\treturn {\n\t\tr0s: s1r / s3r,\n\t\tr0i: (s2r * l) / s3r,\n\t\tr1s: s1r / (s3r + 126452),\n\t\tr1i: ((s2r - 769860) * l) / (s3r + 126452),\n\t\tg0s: s1g / s3g,\n\t\tg0i: (s2g * l) / s3g,\n\t\tg1s: s1g / (s3g + 126452),\n\t\tg1i: ((s2g - 769860) * l) / (s3g + 126452),\n\t\tb0s: s1b / s3b,\n\t\tb0i: (s2b * l) / s3b,\n\t\tb1s: s1b / (s3b + 126452),\n\t\tb1i: ((s2b - 769860) * l) / (s3b + 126452),\n\t};\n}\n\nfunction calcMaxChromaHsluv (lines, h) {\n\tconst hueRad = (h / 360) * Math.PI * 2;\n\tconst r0 = distanceFromOriginAngle(lines.r0s, lines.r0i, hueRad);\n\tconst r1 = distanceFromOriginAngle(lines.r1s, lines.r1i, hueRad);\n\tconst g0 = distanceFromOriginAngle(lines.g0s, lines.g0i, hueRad);\n\tconst g1 = distanceFromOriginAngle(lines.g1s, lines.g1i, hueRad);\n\tconst b0 = distanceFromOriginAngle(lines.b0s, lines.b0i, hueRad);\n\tconst b1 = distanceFromOriginAngle(lines.b1s, lines.b1i, hueRad);\n\n\treturn Math.min(r0, r1, g0, g1, b0, b1);\n}\n\nexport default new ColorSpace({\n\tid: \"hsluv\",\n\tname: \"HSLuv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: LCHuv,\n\tgamutSpace: sRGB,\n\n\t// Convert LCHuv to HSLuv\n\tfromBase (lch) {\n\t\tlet [l, c, h] = [skipNone(lch[0]), skipNone(lch[1]), skipNone(lch[2])];\n\t\tlet s;\n\n\t\tif (l > 99.9999999) {\n\t\t\ts = 0;\n\t\t\tl = 100;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\ts = 0;\n\t\t\tl = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHsluv(lines, h);\n\t\t\ts = (c / max) * 100;\n\t\t}\n\n\t\treturn [h, s, l];\n\t},\n\n\t// Convert HSLuv to LCHuv\n\ttoBase (hsl) {\n\t\tlet [h, s, l] = [skipNone(hsl[0]), skipNone(hsl[1]), skipNone(hsl[2])];\n\t\tlet c;\n\n\t\tif (l > 99.9999999) {\n\t\t\tl = 100;\n\t\t\tc = 0;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\tl = 0;\n\t\t\tc = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHsluv(lines, h);\n\t\t\tc = (max / 100) * s;\n\t\t}\n\n\t\treturn [l, c, h];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsluv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","/*\nAdapted from: https://github.com/hsluv/hsluv-javascript/blob/14b49e6cf9a9137916096b8487a5372626b57ba4/src/hsluv.ts\n\nCopyright (c) 2012-2022 Alexei Boronine\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nimport ColorSpace from \"../ColorSpace.js\";\nimport LCHuv from \"./lchuv.js\";\nimport { fromXYZ_M } from \"./srgb-linear.js\";\nimport { skipNone } from \"../util.js\";\nimport { calculateBoundingLines } from \"./hsluv.js\";\n\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27; // 29^3/3^3\n\nconst m_r0 = fromXYZ_M[0][0];\nconst m_r1 = fromXYZ_M[0][1];\nconst m_r2 = fromXYZ_M[0][2];\nconst m_g0 = fromXYZ_M[1][0];\nconst m_g1 = fromXYZ_M[1][1];\nconst m_g2 = fromXYZ_M[1][2];\nconst m_b0 = fromXYZ_M[2][0];\nconst m_b1 = fromXYZ_M[2][1];\nconst m_b2 = fromXYZ_M[2][2];\n\nfunction distanceFromOrigin (slope, intercept) {\n\treturn Math.abs(intercept) / Math.sqrt(Math.pow(slope, 2) + 1);\n}\n\nfunction calcMaxChromaHpluv (lines) {\n\tlet r0 = distanceFromOrigin(lines.r0s, lines.r0i);\n\tlet r1 = distanceFromOrigin(lines.r1s, lines.r1i);\n\tlet g0 = distanceFromOrigin(lines.g0s, lines.g0i);\n\tlet g1 = distanceFromOrigin(lines.g1s, lines.g1i);\n\tlet b0 = distanceFromOrigin(lines.b0s, lines.b0i);\n\tlet b1 = distanceFromOrigin(lines.b1s, lines.b1i);\n\n\treturn Math.min(r0, r1, g0, g1, b0, b1);\n}\n\nexport default new ColorSpace({\n\tid: \"hpluv\",\n\tname: \"HPLuv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: LCHuv,\n\tgamutSpace: \"self\",\n\n\t// Convert LCHuv to HPLuv\n\tfromBase (lch) {\n\t\tlet [l, c, h] = [skipNone(lch[0]), skipNone(lch[1]), skipNone(lch[2])];\n\t\tlet s;\n\n\t\tif (l > 99.9999999) {\n\t\t\ts = 0;\n\t\t\tl = 100;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\ts = 0;\n\t\t\tl = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHpluv(lines);\n\t\t\ts = (c / max) * 100;\n\t\t}\n\t\treturn [h, s, l];\n\t},\n\n\t// Convert HPLuv to LCHuv\n\ttoBase (hsl) {\n\t\tlet [h, s, l] = [skipNone(hsl[0]), skipNone(hsl[1]), skipNone(hsl[2])];\n\t\tlet c;\n\n\t\tif (l > 99.9999999) {\n\t\t\tl = 100;\n\t\t\tc = 0;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\tl = 0;\n\t\t\tc = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHpluv(lines);\n\t\t\tc = (max / 100) * s;\n\t\t}\n\n\t\treturn [l, c, h];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hpluv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport REC_2020_Linear from \"./rec2020-linear.js\";\n\nexport default new RGBColorSpace({\n\tid: \"rec2100-linear\",\n\tname: \"Linear REC.2100\",\n\twhite: \"D65\",\n\ttoBase: REC_2020_Linear.toBase,\n\tfromBase: REC_2020_Linear.fromBase,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport REC_2100_Linear from \"./rec2100-linear.js\";\n\nconst Yw = 203; // absolute luminance of media white, cd/m²\nconst n = 2610 / 2 ** 14;\nconst ninv = 2 ** 14 / 2610;\nconst m = 2523 / 2 ** 5;\nconst minv = 2 ** 5 / 2523;\nconst c1 = 3424 / 2 ** 12;\nconst c2 = 2413 / 2 ** 7;\nconst c3 = 2392 / 2 ** 7;\n\nexport default new RGBColorSpace({\n\tid: \"rec2100pq\",\n\tcssId: \"rec2100-pq\",\n\tname: \"REC.2100-PQ\",\n\tbase: REC_2100_Linear,\n\ttoBase (RGB) {\n\t\t// given PQ encoded component in range [0, 1]\n\t\t// return media-white relative linear-light\n\t\treturn RGB.map(function (val) {\n\t\t\tlet x = (Math.max(val ** minv - c1, 0) / (c2 - c3 * val ** minv)) ** ninv;\n\t\t\treturn (x * 10000) / Yw; // luminance relative to diffuse white, [0, 70 or so].\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\t// given media-white relative linear-light\n\t\t// returnPQ encoded component in range [0, 1]\n\t\treturn RGB.map(function (val) {\n\t\t\tlet x = Math.max((val * Yw) / 10000, 0); // absolute luminance of peak white is 10,000 cd/m².\n\t\t\tlet num = c1 + c2 * x ** n;\n\t\t\tlet denom = 1 + c3 * x ** n;\n\n\t\t\treturn (num / denom) ** m;\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport REC_2100_Linear from \"./rec2100-linear.js\";\nimport { spow } from \"../util.js\";\n\nconst a = 0.17883277;\nconst b = 0.28466892; // 1 - (4 * a)\nconst c = 0.55991073; // 0.5 - a * Math.log(4 *a)\n\nconst scale = 3.7743; // Place 18% grey at HLG 0.38, so media white at 0.75\n\nexport default new RGBColorSpace({\n\tid: \"rec2100hlg\",\n\tcssId: \"rec2100-hlg\",\n\tname: \"REC.2100-HLG\",\n\treferred: \"scene\",\n\n\tbase: REC_2100_Linear,\n\ttoBase (RGB) {\n\t\t// given HLG encoded component in range [0, 1]\n\t\t// return media-white relative linear-light\n\t\treturn RGB.map(function (val) {\n\t\t\t// first the HLG EOTF\n\t\t\t// ITU-R BT.2390-10 p.30 section\n\t\t\t// 6.3 The hybrid log-gamma electro-optical transfer function (EOTF)\n\t\t\t// Then scale by 3 so media white is 1.0\n\t\t\tif (val <= 0.5) {\n\t\t\t\treturn (val ** 2 / 3) * scale;\n\t\t\t}\n\t\t\treturn ((Math.exp((val - c) / a) + b) / 12) * scale;\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\t// given media-white relative linear-light\n\t\t// where diffuse white is 1.0,\n\t\t// return HLG encoded component in range [0, 1]\n\t\treturn RGB.map(function (val) {\n\t\t\t// first scale to put linear-light media white at 1/3\n\t\t\tval /= scale;\n\t\t\t// now the HLG OETF\n\t\t\t// ITU-R BT.2390-10 p.23\n\t\t\t// 6.1 The hybrid log-gamma opto-electronic transfer function (OETF)\n\t\t\tif (val <= 1 / 12) {\n\t\t\t\treturn spow(3 * val, 0.5);\n\t\t\t}\n\t\t\treturn a * Math.log(12 * val - b) + c;\n\t\t});\n\t},\n});\n","import hooks from \"./hooks.js\";\nimport { multiplyMatrices } from \"./util.js\";\nimport { WHITES } from \"./adapt.js\";\n\n/** @import { White } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").CAT} CAT */\n\n/** @type {Record<string, CAT>} */\nexport const CATs = {};\n\nhooks.add(\"chromatic-adaptation-start\", env => {\n\tif (env.options.method) {\n\t\tenv.M = adapt(env.W1, env.W2, env.options.method);\n\t}\n});\n\nhooks.add(\"chromatic-adaptation-end\", env => {\n\tif (!env.M) {\n\t\tenv.M = adapt(env.W1, env.W2, env.options.method);\n\t}\n});\n\nexport function defineCAT (/** @type {CAT} */ { id, toCone_M, fromCone_M }) {\n\t// Use id, toCone_M, fromCone_M like variables\n\tCATs[id] = arguments[0];\n}\n\n/**\n *\n * @param {White} W1\n * @param {White} W2\n * @param {string} id\n * @returns {number[][]}\n */\nexport function adapt (W1, W2, id = \"Bradford\") {\n\t// adapt from a source whitepoint or illuminant W1\n\t// to a destination whitepoint or illuminant W2,\n\t// using the given chromatic adaptation transform (CAT)\n\t// debugger;\n\tlet method = CATs[id];\n\n\tlet [ρs, γs, βs] = multiplyMatrices(method.toCone_M, W1);\n\tlet [ρd, γd, βd] = multiplyMatrices(method.toCone_M, W2);\n\n\t// all practical illuminants have non-zero XYZ so no division by zero can occur below\n\t// prettier-ignore\n\tlet scale = [\n\t\t[ρd / ρs,  0,        0      ],\n\t\t[0,        γd / γs,  0      ],\n\t\t[0,        0,        βd / βs],\n\t];\n\t// console.log({scale});\n\n\tlet scaled_cone_M = multiplyMatrices(scale, method.toCone_M);\n\tlet adapt_M = multiplyMatrices(method.fromCone_M, scaled_cone_M);\n\t// console.log({scaled_cone_M, adapt_M});\n\treturn adapt_M;\n}\n\n// prettier-ignore\ndefineCAT({\n\tid: \"von Kries\",\n\ttoCone_M: [\n\t\t[  0.4002400,  0.7076000, -0.0808100 ],\n\t\t[ -0.2263000,  1.1653200,  0.0457000 ],\n\t\t[  0.0000000,  0.0000000,  0.9182200 ],\n\t],\n\tfromCone_M: [\n\t\t[ 1.8599363874558397, -1.1293816185800916,   0.21989740959619328     ],\n\t\t[ 0.3611914362417676,  0.6388124632850422,  -0.000006370596838649899 ],\n\t\t[ 0,                   0,                    1.0890636230968613      ],\n\t],\n});\n\n// prettier-ignore\ndefineCAT({\n\tid: \"Bradford\",\n\t// Convert an array of XYZ values in the range 0.0 - 1.0\n\t// to cone fundamentals\n\ttoCone_M: [\n\t\t[  0.8951000,  0.2664000, -0.1614000 ],\n\t\t[ -0.7502000,  1.7135000,  0.0367000 ],\n\t\t[  0.0389000, -0.0685000,  1.0296000 ],\n\t],\n\t// and back\n\tfromCone_M: [\n\t\t[  0.9869929054667121, -0.14705425642099013, 0.15996265166373122  ],\n\t\t[  0.4323052697233945,  0.5183602715367774,  0.049291228212855594 ],\n\t\t[ -0.00852866457517732, 0.04004282165408486, 0.96848669578755     ],\n\t],\n});\n\n// prettier-ignore\ndefineCAT({\n\tid: \"CAT02\",\n\t// with complete chromatic adaptation to W2, so D = 1.0\n\ttoCone_M: [\n\t\t[  0.7328000,  0.4296000, -0.1624000 ],\n\t\t[ -0.7036000,  1.6975000,  0.0061000 ],\n\t\t[  0.0030000,  0.0136000,  0.9834000 ],\n\t],\n\tfromCone_M: [\n\t\t[  1.0961238208355142,   -0.27886900021828726, 0.18274517938277307 ],\n\t\t[  0.4543690419753592,    0.4735331543074117,  0.07209780371722911 ],\n\t\t[ -0.009627608738429355, -0.00569803121611342, 1.0153256399545427  ],\n\t],\n});\n\n// prettier-ignore\ndefineCAT({\n\tid: \"CAT16\",\n\ttoCone_M: [\n\t\t[  0.401288,  0.650173, -0.051461 ],\n\t\t[ -0.250268,  1.204414,  0.045854 ],\n\t\t[ -0.002079,  0.048952,  0.953127 ],\n\t],\n\t// the extra precision is needed to avoid roundtripping errors\n\tfromCone_M: [\n\t\t[  1.862067855087233,   -1.0112546305316845,  0.14918677544445172  ],\n\t\t[  0.3875265432361372,   0.6214474419314753, -0.008973985167612521 ],\n\t\t[ -0.01584149884933386, -0.03412293802851557, 1.0499644368778496   ],\n\t],\n});\n\n// prettier-ignore\nObject.assign(WHITES, {\n\t// whitepoint values from ASTM E308-01 with 10nm spacing, 1931 2 degree observer\n\t// all normalized to Y (luminance) = 1.00000\n\t// Illuminant A is a tungsten electric light, giving a very warm, orange light.\n\tA:   [1.09850, 1.00000, 0.35585],\n\n\t// Illuminant C was an early approximation to daylight: illuminant A with a blue filter.\n\tC:   [0.98074, 1.000000, 1.18232],\n\n\t// The daylight series of illuminants simulate natural daylight.\n\t// The color temperature (in degrees Kelvin/100) ranges from\n\t// cool, overcast daylight (D50) to bright, direct sunlight (D65).\n\tD55: [0.95682, 1.00000, 0.92149],\n\tD75: [0.94972, 1.00000, 1.22638],\n\n\t// Equal-energy illuminant, used in two-stage CAT16\n\tE:   [1.00000, 1.00000, 1.00000],\n\n\t// The F series of illuminants represent fluorescent lights\n\tF2:  [0.99186, 1.00000, 0.67393],\n\tF7:  [0.95041, 1.00000, 1.08747],\n\tF11: [1.00962, 1.00000, 0.64350],\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport \"../CATs.js\"; // because of the funky whitepoint\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// The ACES whitepoint\n// see TB-2018-001 Derivation of the ACES White Point CIE Chromaticity Coordinates\n// also https://github.com/ampas/aces-dev/blob/master/documents/python/TB-2018-001/aces_wp.py\n// Similar to D60\nWHITES.ACES = [0.32168 / 0.33767, 1.0, (1.0 - 0.32168 - 0.33767) / 0.33767];\n\n// convert an array of linear-light ACEScc values to CIE XYZ\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[  0.6624541811085053,   0.13400420645643313,  0.1561876870049078  ],\n\t[  0.27222871678091454,  0.6740817658111484,   0.05368951740793705 ],\n\t[ -0.005574649490394108, 0.004060733528982826, 1.0103391003129971  ],\n];\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  1.6410233796943257,   -0.32480329418479,    -0.23642469523761225  ],\n\t[ -0.6636628587229829,    1.6153315916573379,   0.016756347685530137 ],\n\t[  0.011721894328375376, -0.008284441996237409, 0.9883948585390215   ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"acescg\",\n\tcssId: \"--acescg\",\n\tname: \"ACEScg\",\n\n\t// ACEScg – A scene-referred, linear-light encoding of ACES Data\n\t// https://docs.acescentral.com/specifications/acescg/\n\t// uses the AP1 primaries, see section 4.3.1 Color primaries\n\tcoords: {\n\t\tr: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Red\",\n\t\t},\n\t\tg: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Green\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Blue\",\n\t\t},\n\t},\n\n\treferred: \"scene\",\n\n\twhite: WHITES.ACES,\n\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n\n// export default Color;\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport \"../CATs.js\"; // because of the funky whitepoint\nimport ACEScg from \"./acescg.js\";\n\nconst ε = 2 ** -16;\n\n// the smallest value which, in the 32bit IEEE 754 float encoding,\n// decodes as a non-negative value\nconst ACES_min_nonzero = -0.35828683;\n\n// brightest encoded value, decodes to 65504\nconst ACES_cc_max = (Math.log2(65504) + 9.72) / 17.52; // 1.468\n\nexport default new RGBColorSpace({\n\tid: \"acescc\",\n\tcssId: \"--acescc\",\n\tname: \"ACEScc\",\n\t// see S-2014-003 ACEScc – A Logarithmic Encoding of ACES Data\n\t// https://docs.acescentral.com/specifications/acescc/\n\t// uses the AP1 primaries, see section 4.3.1 Color primaries\n\n\t// Appendix A: \"Very small ACES scene referred values below 7 1/4 stops\n\t// below 18% middle gray are encoded as negative ACEScc values.\n\t// These values should be preserved per the encoding in Section 4.4\n\t// so that all positive ACES values are maintained.\"\n\tcoords: {\n\t\tr: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Red\",\n\t\t},\n\t\tg: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Green\",\n\t\t},\n\t\tb: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Blue\",\n\t\t},\n\t},\n\treferred: \"scene\",\n\n\tbase: ACEScg,\n\t// from section 4.4.2 Decoding Function\n\ttoBase (RGB) {\n\t\tconst low = (9.72 - 15) / 17.52; // -0.3014\n\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val <= low) {\n\t\t\t\treturn (2 ** (val * 17.52 - 9.72) - ε) * 2; // very low values, below -0.3014\n\t\t\t}\n\t\t\telse if (val < ACES_cc_max) {\n\t\t\t\treturn 2 ** (val * 17.52 - 9.72);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// val >= ACES_cc_max\n\t\t\t\treturn 65504;\n\t\t\t}\n\t\t});\n\t},\n\n\t// Non-linear encoding function from S-2014-003, section 4.4.1 Encoding Function\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val <= 0) {\n\t\t\t\treturn (Math.log2(ε) + 9.72) / 17.52; // -0.3584\n\t\t\t}\n\t\t\telse if (val < ε) {\n\t\t\t\treturn (Math.log2(ε + val * 0.5) + 9.72) / 17.52;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// val >= ε\n\t\t\t\treturn (Math.log2(val) + 9.72) / 17.52;\n\t\t\t}\n\t\t});\n\t},\n\t// encoded media white (rgb 1,1,1) => linear  [ 222.861, 222.861, 222.861 ]\n\t// encoded media black (rgb 0,0,0) => linear [ 0.0011857, 0.0011857, 0.0011857]\n});\n","import getColor from \"./getColor.js\";\n// import defaults from \"./defaults.js\";\nimport { isString } from \"./util.js\";\nimport * as contrastAlgorithms from \"./contrast/index.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Algorithms} Algorithms */\n\n/**\n *\n * @param {ColorTypes} background\n * @param {ColorTypes} foreground\n * @param {Algorithms | ({ algorithm: Algorithms } & Record<string, any>)} o\n * Algorithm to use as well as any other options to pass to the contrast function\n * @returns {number}\n * @throws {TypeError} Unknown or unspecified algorithm\n */\nexport default function contrast (background, foreground, o) {\n\tif (isString(o)) {\n\t\to = { algorithm: o };\n\t}\n\n\tlet { algorithm, ...rest } = o || {};\n\n\tif (!algorithm) {\n\t\tlet algorithms = Object.keys(contrastAlgorithms)\n\t\t\t.map(a => a.replace(/^contrast/, \"\"))\n\t\t\t.join(\", \");\n\t\tthrow new TypeError(\n\t\t\t`contrast() function needs a contrast algorithm. Please specify one of: ${algorithms}`,\n\t\t);\n\t}\n\n\tbackground = getColor(background);\n\tforeground = getColor(foreground);\n\n\tfor (let a in contrastAlgorithms) {\n\t\tif (\"contrast\" + algorithm.toLowerCase() === a.toLowerCase()) {\n\t\t\treturn contrastAlgorithms[a](background, foreground, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown contrast algorithm: ${algorithm}`);\n}\n","import getColor from \"./getColor.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n/**\n * @param {ColorTypes} color1\n * @param {ColorTypes} color2\n * @returns {boolean}\n */\nexport default function equals (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\treturn (\n\t\tcolor1.space === color2.space &&\n\t\tcolor1.alpha === color2.alpha &&\n\t\tcolor1.coords.every((c, i) => c === color2.coords[i])\n\t);\n}\n","import { isString } from \"./util.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").TryColorOptions} TryColorOptions */\n\n/**\n * Resolves a color reference (object or string) to a plain color object, or `null` if resolution fails.\n * Can resolve more complex CSS colors (e.g. relative colors, `calc()`, CSS variables, `color-mix()`, etc.) through the DOM.\n *\n * @overload\n * @param {ColorTypes} color\n * @param {TryColorOptions} [options]\n * @returns {PlainColorObject | null}\n */\n/**\n * @overload\n * @param {ColorTypes[]} color\n * @param {TryColorOptions} [options]\n * @returns {(PlainColorObject | null)[]}\n */\nexport default function tryColor (color, options = {}) {\n\tif (Array.isArray(color)) {\n\t\treturn color.map(c => tryColor(c, options));\n\t}\n\n\tlet { cssProperty = \"background-color\", element, ...getColorOptions } = options;\n\tlet error = null;\n\ttry {\n\t\treturn getColor(color, getColorOptions);\n\t}\n\tcatch (e) {\n\t\terror = e;\n\t}\n\n\tlet { CSS, getComputedStyle } = globalThis;\n\tif (isString(color) && element && CSS && getComputedStyle) {\n\t\t// Try resolving the color using the DOM, if supported in CSS\n\t\tif (CSS.supports(cssProperty, color)) {\n\t\t\tlet previousValue = element.style[cssProperty];\n\n\t\t\tif (color !== previousValue) {\n\t\t\t\telement.style[cssProperty] = color;\n\t\t\t}\n\n\t\t\tlet computedColor = getComputedStyle(element).getPropertyValue(cssProperty);\n\n\t\t\tif (color !== previousValue) {\n\t\t\t\telement.style[cssProperty] = previousValue;\n\t\t\t}\n\n\t\t\tif (computedColor !== color) {\n\t\t\t\t// getComputedStyle() changed the color, try again\n\t\t\t\ttry {\n\t\t\t\t\treturn getColor(computedColor, getColorOptions);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\terror = e;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Still not resolved\n\t\t\t\terror = {\n\t\t\t\t\tmessage: \"Color value is a valid CSS color, but it could not be resolved :(\",\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// If we're here, we failed to resolve the color\n\tif (options.errorMeta) {\n\t\toptions.errorMeta.error = error;\n\t}\n\n\treturn null;\n}\n"],"names":["multiplyMatrices","A","B","AM","BM","m","length","aVec","bVec","Array","isArray","map","x","p","BM_cols","_","i","product","row","col","ret","c","dot3","a","b","multiply_v3_m3x3","input","matrix","out","y","z","isString","str","type","o","Object","prototype","toString","call","match","toLowerCase","serializeNumber","n","precision","unit","isNone","toPrecision","skipNone","integer","digits","Math","log10","abs","multiplier","floor","interpolate","start","end","isNaN","mapRange","from","to","value","interpolateInv","clamp","min","val","max","copySign","sign","spow","base","exp","zdiv","d","isInstance","arg","constructor","targetName","name","proto","getPrototypeOf","constructorName","Type","coordMeta","coordRange","range","this","refRange","params","trim","TypeError","groups","computedRange","percentageRange","resolve","number","fromRange","toRange","serialize","scale","get","instance","Symbol","Format","spaceCoords","coords","id","alpha","format","space","assign","values","push","types","split","serializeCoords","coerceCoords","entries","providedType","find","coordName","raw","canSerialize","parse","args","Hooks","add","callback","first","arguments","forEach","run","env","context","hooks","WHITES","D50","D65","getWhite","adapt","W1","W2","XYZ","options","M","defaults","gamut_mapping","deltaE","verbose","globalThis","process","NODE_ENV","warn","msg","console","String","color","parsed","parts","regex","function","argMeta","lastAlpha","separators","replace","singleArgument","$0","rawArg","meta","unitValue","unitless","Number","slice","units","test","NaN","parseArgument","startsWith","commas","includes","rawName","rawArgs","parseFunction","parseMeta","shift","alternateId","substring","ids","ColorSpace","findFormat","didYouMean","registryId","registry","cssId","formats","formatId","pop","alphaType","coordCount","spaceId","spaceloop","all","formatObject","getFormat","undefined","deg","grad","rad","PI","turn","RegExp","keys","join","getColor","aliases","fromBase","toBase","white","gamutSpace","isPolar","isUnbounded","inGamut","referred","defineProperty","getPath","reverse","writable","enumerable","configurable","epsilon","equals","every","coord","connectionSpace","connectionSpaceIndex","myPath","path","otherPath","Error","getMinCoords","static","Set","register","alias","alternatives","filters","spaces","matches","filterIds","some","resolveCoord","ref","workingSpace","coordType","coordId","index","normalizedCoord","s","xyz_d65","RGBColorSpace","r","g","XYZ_D65","toXYZ_M","fromXYZ_M","rgb","xyz","super","getAll","prop","setAll","set","object","returns","XYZ_D50","ε","ε3","κ","lab","l","xyz_d50","f","cbrt","Lab","L","pow","constrain","angle","adjust","arc","angles","a1","a2","none1","util.isNone","none2","angleDiff","lch","h","extent","isAchromatic","constrainAngle","atan2","sqrt","C","cos","sin","Gfactor","π","r2d","d2r","pow7","x2","deltaE2000","sample","kL","kC","kH","L1","b1","C1","L2","b2","C2","C7","G","adash1","adash2","Cdash1","Cdash2","h1","h2","hdiff","hsum","habs","hdash","Ldash","Cdash","Cdash7","lsq","SL","SC","T","SH","RC","dE","XYZtoLMS_M","LMStoXYZ_M","LMStoLab_M","LabtoLMS_M","Oklab","LMS","OKLab","LMSg","oklab","deltaEOK","clone","distance","color1","color2","coords1","coords2","reduce","acc","c1","c2","deltaE76","deltaECMC","H1","H2","C4","F","XYZ_Abs_D65","v","AbsXYZ","ninv","c3","pinv","d0","XYZtoCone_M","ConetoXYZ_M","ConetoIab_M","IabtoCone_M","Jzazbz","jz","az","bz","Xa","Ya","Za","PQLMS","num","denom","Iz","Jz","Xm","Ym","jzazbz","jzczhz","cz","hz","deltaEJz","Jz1","Cz1","Hz1","Jz2","Cz2","Hz2","m1","m2","im1","im2","LMStoIPT_M","IPTtoLMS_M","ictcp","ct","cp","LMStoICtCp","ICtCp","ICtCptoLMS","deltaEITP","I1","T1","P1","I2","T2","P2","deltaEOK2","adaptedCoefInv","tau","cat16","cat16Inv","surroundMap","dark","dim","average","hueQuadMap","e","H","rad2deg","deg2rad","fl","temp","environment","refWhite","adaptingLuminance","backgroundLuminance","surround","discounting","xyzW","la","yb","yw","rgbW","nc","k4","flRoot","nbb","ncb","dRgb","dRgbInv","rgbCW","rgbAW","aW","viewingConditions","fromCam16","cam16","J","Q","hRad","Hp","hi","hii","ei","eii","invHueQuadrature","cosh","sinh","Jroot","t","et","p1","p2","rgb_c","adapted","constant","cabs","unadapt","toCam16","xyzd65","xyz100","rgbA","hp","arr","lo","mid","bisectLeft","hueQuadrature","j","fromLstar","lstar","toHct","hct","attempt","last","Infinity","delta","fromHct","ucsCoeff","convertUcsAb","log","hrad","deltaEHCT","t1","t2","deltaEMethods","GMAPPRESET","method","jnd","deltaEMethod","blackWhiteClamp","channel","toGamut","util.isString","spaceColor","toGamutCSS","hasOwnProperty","de","clipped","channelMeta","mapSpace","mappedColor","order","parseFloat","calcEpsilon","low","high","bounds","COLORS","WHITE","BLACK","origin","JND","oklchSpace","origin_OKLCH","black","clip","_color","destColor","util.clamp","min_inGamut","current","E","chroma","coordFormat","alphaFormat","colorWithMeta","DEFAULT_FORMAT","checkInGamut","unshift","include","serializeAlpha","strAlpha","util.serializeNumber","REC_2020_Linear","REC2020","REC2020Linear","RGB","P3Linear","sRGBLinear","KEYWORDS","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellow","yellowgreen","coordGrammar","fill","coordGrammarNumber","sRGB","rgb_number","rgba","rgba_number","hex","component","parseInt","collapse","round","collapsible","padStart","keyword","P3","supportsNone","display_space","CSS","supports","subtractCoords","getLuminance","contrastWCAG21","Y1","Y2","fclamp","Y","linearize","contrastAPCA","background","foreground","S","Sapc","R","lumTxt","lumBg","Ytxt","Ybg","BoW","contrastMichelson","contrastWeber","contrastLstar","lab_d65","phi","contrastDeltaPhi","Lstr1","Lstr2","deltaPhiStar","contrast","SQRT2","uv","X","Z","rest","lighten","amount","darken","isRange","rangeArgs","colors","outputSpace","progression","premultiplied","interpolationSpace","hue","angles.adjust","hsl","k","hsla","HSV","hsv","hwb","w","sum","A98Linear","a98rgb","ProPhotoLinear","Et","prophoto","rec2020Oetf","oklch","toSRGBLinear","RGBCoeff","floatMax","MAX_VALUE","K1","K2","K3","vdot","toe","toeInv","toSt","cusp","oklabToLinearRGB","lmsToRgb","lms","findCusp","okCoeff","sCusp","k0","k1","k2","k3","wl","wm","ws","sat","kl","km","ks","l_","m_","s_","f1","computeMaxSaturation","lCusp","getCs","cMax","l1","l0","dl","dc","ldt_","mdt_","sdt_","ldt","mdt","sdt","ldt2","mdt2","sdt2","r_","r1","ur","tr","g_","g1","ug","tg","b_","ub","tb","findGamutIntersection","stMax","stMid","getStMid","ca","cb","cMid","okhsl","a_","c0","midInv","achromatic","oklabToOkhsl","okhslToOklab","OKLrab","oklrab","oklrch","okhsv","sMax","tMax","s0","lv","cv","lvt","cvt","rs","gs","bs","scaleL","oklabToOkhsv","lNew","okhsvToOklab","U_PRIME_WHITE","V_PRIME_WHITE","Luv","u","up","vp","isFinite","LCHuv","m_r0","m_r1","m_r2","m_g0","m_g1","m_g2","m_b0","m_b1","m_b2","distanceFromOriginAngle","slope","intercept","calculateBoundingLines","sub1","sub2","s1r","s2r","s3r","s1g","s2g","s3g","s1b","s2b","s3b","r0s","r0i","r1s","r1i","g0s","g0i","g1s","g1i","b0s","b0i","b1s","b1i","calcMaxChromaHsluv","lines","hueRad","r0","g0","b0","hsluv","distanceFromOrigin","calcMaxChromaHpluv","hpluv","REC_2100_Linear","minv","rec2100Pq","rec2100Hlg","CATs","defineCAT","toCone_M","fromCone_M","scaled_cone_M","D55","D75","F2","F7","F11","ACES","ACEScg","ACES_min_nonzero","ACES_cc_max","log2","acescc","algorithm","algorithms","contrastAlgorithms","coord1","coord2","fallbackColor","colorRange","maxDeltaE","steps","maxSteps","rangeOptions","totalDelta","actualSteps","ceil","step","maxDelta","cur","prev","splice","tryColor","cssProperty","element","getColorOptions","error","getComputedStyle","previousValue","style","computedColor","getPropertyValue","message","errorMeta"],"mappings":"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"}