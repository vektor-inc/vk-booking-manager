{
  "version": 3,
  "sources": ["../../src/stylelint-plugins/no-unknown-ds-tokens.mjs"],
  "sourcesContent": ["import stylelint from 'stylelint';\nimport tokenList from '../prebuilt/js/design-tokens.mjs';\n\nconst DS_TOKEN_PREFIX = 'wpds-';\n\n/**\n * Extracts all unique CSS custom properties (variables) from a given CSS value string,\n * including those in fallback positions, optionally filtering by a specific prefix.\n *\n * @param {string} value       - The CSS value string to search for variables.\n * @param {string} [prefix=''] - Optional prefix to filter variables (e.g., 'wpds-').\n * @return {Set<string>} A Set of unique matched CSS variable names (e.g., Set { '--wpds-token' }).\n *\n * @example\n * extractCSSVariables(\n *   'border: 1px solid var(--wpds-border-color, var(--wpds-border-fallback)); ' +\n *   'color: var(--wpds-color-fg, black); ' +\n *   'background: var(--unrelated-bg);',\n *   'wpds'\n * );\n * // \u2192 Set { '--wpds-border-color', '--wpds-border-fallback', '--wpds-color-fg' }\n */\nfunction extractCSSVariables( value, prefix = '' ) {\n\tconst regex = /--[\\w-]+/g;\n\t/** @type {Set<string>} */\n\tconst variables = new Set();\n\n\tlet match;\n\twhile ( ( match = regex.exec( value ) ) !== null ) {\n\t\tconst variableName = match[ 0 ];\n\t\tif ( variableName.startsWith( `--${ prefix }` ) ) {\n\t\t\tvariables.add( variableName );\n\t\t}\n\t}\n\n\treturn variables;\n}\n\nconst knownTokens = new Set( tokenList );\nconst wpdsTokensRegex = new RegExp( `[^\\\\w]--${ DS_TOKEN_PREFIX }`, 'i' );\n\nconst {\n\tcreatePlugin,\n\tutils: { report, ruleMessages, validateOptions },\n} = stylelint;\n\nconst ruleName = 'plugin-wpds/no-unknown-ds-tokens';\n\nconst messages = ruleMessages( ruleName, {\n\trejected: ( tokenNames ) =>\n\t\t`The following CSS variables are not valid Design System tokens: ${ tokenNames }`,\n} );\n\n/** @type {import('stylelint').Rule} */\nconst ruleFunction = ( primary ) => {\n\treturn ( root, result ) => {\n\t\tconst validOptions = validateOptions( result, ruleName, {\n\t\t\tactual: primary,\n\t\t\tpossible: [ true ],\n\t\t} );\n\n\t\tif ( ! validOptions ) {\n\t\t\treturn;\n\t\t}\n\n\t\troot.walkDecls( ( ruleNode ) => {\n\t\t\tconst { value } = ruleNode;\n\t\t\t// Early match for WPDS tokens to avoid unnecessary processing.\n\t\t\tif ( wpdsTokensRegex.test( value ) ) {\n\t\t\t\tconst usedTokens = extractCSSVariables(\n\t\t\t\t\tvalue,\n\t\t\t\t\tDS_TOKEN_PREFIX\n\t\t\t\t);\n\t\t\t\tconst unknownTokens = new Set(\n\t\t\t\t\t[ ...usedTokens ].filter(\n\t\t\t\t\t\t( token ) => ! knownTokens.has( token )\n\t\t\t\t\t)\n\t\t\t\t);\n\n\t\t\t\tif ( unknownTokens.size > 0 ) {\n\t\t\t\t\treport( {\n\t\t\t\t\t\tmessage: messages.rejected(\n\t\t\t\t\t\t\tArray.from( unknownTokens )\n\t\t\t\t\t\t\t\t.map( ( token ) => `'${ token }'` )\n\t\t\t\t\t\t\t\t.join( ', ' )\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnode: ruleNode,\n\t\t\t\t\t\tresult,\n\t\t\t\t\t\truleName,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t};\n};\n\nruleFunction.ruleName = ruleName;\nruleFunction.messages = messages;\n\n/** @type {import('stylelint').Plugin} */\nexport default createPlugin( ruleName, ruleFunction );\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAsB;AACtB,2BAAsB;AAEtB,IAAM,kBAAkB;AAmBxB,SAAS,oBAAqB,OAAO,SAAS,IAAK;AAClD,QAAM,QAAQ;AAEd,QAAM,YAAY,oBAAI,IAAI;AAE1B,MAAI;AACJ,UAAU,QAAQ,MAAM,KAAM,KAAM,OAAQ,MAAO;AAClD,UAAM,eAAe,MAAO,CAAE;AAC9B,QAAK,aAAa,WAAY,KAAM,MAAO,EAAG,GAAI;AACjD,gBAAU,IAAK,YAAa;AAAA,IAC7B;AAAA,EACD;AAEA,SAAO;AACR;AAEA,IAAM,cAAc,IAAI,IAAK,qBAAAA,OAAU;AACvC,IAAM,kBAAkB,IAAI,OAAQ,WAAY,eAAgB,IAAI,GAAI;AAExE,IAAM;AAAA,EACL;AAAA,EACA,OAAO,EAAE,QAAQ,cAAc,gBAAgB;AAChD,IAAI,iBAAAC;AAEJ,IAAM,WAAW;AAEjB,IAAM,WAAW,aAAc,UAAU;AAAA,EACxC,UAAU,CAAE,eACX,mEAAoE,UAAW;AACjF,CAAE;AAGF,IAAM,eAAe,CAAE,YAAa;AACnC,SAAO,CAAE,MAAM,WAAY;AAC1B,UAAM,eAAe,gBAAiB,QAAQ,UAAU;AAAA,MACvD,QAAQ;AAAA,MACR,UAAU,CAAE,IAAK;AAAA,IAClB,CAAE;AAEF,QAAK,CAAE,cAAe;AACrB;AAAA,IACD;AAEA,SAAK,UAAW,CAAE,aAAc;AAC/B,YAAM,EAAE,MAAM,IAAI;AAElB,UAAK,gBAAgB,KAAM,KAAM,GAAI;AACpC,cAAM,aAAa;AAAA,UAClB;AAAA,UACA;AAAA,QACD;AACA,cAAM,gBAAgB,IAAI;AAAA,UACzB,CAAE,GAAG,UAAW,EAAE;AAAA,YACjB,CAAE,UAAW,CAAE,YAAY,IAAK,KAAM;AAAA,UACvC;AAAA,QACD;AAEA,YAAK,cAAc,OAAO,GAAI;AAC7B,iBAAQ;AAAA,YACP,SAAS,SAAS;AAAA,cACjB,MAAM,KAAM,aAAc,EACxB,IAAK,CAAE,UAAW,IAAK,KAAM,GAAI,EACjC,KAAM,IAAK;AAAA,YACd;AAAA,YACA,MAAM;AAAA,YACN;AAAA,YACA;AAAA,UACD,CAAE;AAAA,QACH;AAAA,MACD;AAAA,IACD,CAAE;AAAA,EACH;AACD;AAEA,aAAa,WAAW;AACxB,aAAa,WAAW;AAGxB,IAAO,+BAAQ,aAAc,UAAU,YAAa;",
  "names": ["tokenList", "stylelint"]
}
